(function(g){var window=this;'use strict';var Iqv=function(n){var q=new g.ty("und",new g.FB("Default","und",!0));q.captionTracks=n.captionTracks;return q},k9w=function(n){return new g.aR(function(q,w){var X=n.length,P=[];
if(X)for(var R=function(e,f){X--;P[e]=f;X==0&&q(P)},c=function(e){w(e)},k,r=0;r<n.length;r++)k=n[r],g.BGh(k,g.r0(R,r),c);
else q(P)})},l6=function(n){this.N=n},G8=function(){l6.apply(this,arguments)},rzt=function(){G8.apply(this,arguments)},jMh=function(){G8.apply(this,arguments)},sMi=function(){G8.apply(this,arguments)},eKG=function(){G8.apply(this,arguments)},fqt=function(){G8.apply(this,arguments)},O8G=function(){G8.apply(this,arguments)},i8B=function(){l6.apply(this,arguments)},H80=function(){G8.apply(this,arguments)},UQl=function(){G8.apply(this,arguments)},t5l=function(){G8.apply(this,arguments)},dQG=function(){G8.apply(this,
arguments)},g6B=function(){G8.apply(this,arguments)},mQD=function(){G8.apply(this,arguments)},yzf=function(){G8.apply(this,arguments)},aqi=function(){G8.apply(this,arguments)},V5h=function(){G8.apply(this,arguments)},prB=function(){G8.apply(this,arguments)},TKt=function(){G8.apply(this,arguments)},Foz=function(){G8.apply(this,arguments)},$Qz=function(){l6.apply(this,arguments)},v6D=function(){G8.apply(this,arguments)},LoD=function(){G8.apply(this,arguments)},M5l=function(){G8.apply(this,arguments)},
xQt=function(){G8.apply(this,arguments)},DQG=function(){G8.apply(this,arguments)},hK0=function(){G8.apply(this,arguments)},lqj=function(){G8.apply(this,arguments)},G9t=function(){G8.apply(this,arguments)},CAf=function(){G8.apply(this,arguments)},E6w=function(){l6.apply(this,arguments)},o6t=function(){l6.apply(this,arguments)},b8f=function(){l6.apply(this,arguments)},AzD=function(){G8.apply(this,arguments)},YnG=function(){G8.apply(this,arguments)},KoB=function(){G8.apply(this,arguments)},Snv=function(){G8.apply(this,
arguments)},ux5=function(){G8.apply(this,arguments)},BK5=function(){G8.apply(this,arguments)},QMB=function(){G8.apply(this,arguments)},Z8L=function(){G8.apply(this,arguments)},Jz5=function(){G8.apply(this,arguments)},zKf=function(){G8.apply(this,arguments)},Woh=function(){G8.apply(this,arguments)},NKz=function(){G8.apply(this,arguments)},nLw=function(){G8.apply(this,arguments)},qAj=function(){G8.apply(this,arguments)},wfi=function(){G8.apply(this,arguments)},XfD=function(){G8.apply(this,arguments)},
PI5=function(){G8.apply(this,arguments)},RaD=function(){G8.apply(this,arguments)},cQh=function(){G8.apply(this,arguments)},Idi=function(){G8.apply(this,arguments)},khD=function(){G8.apply(this,arguments)},rQB=function(){G8.apply(this,arguments)},jYL=function(){G8.apply(this,arguments)},sYB=function(){G8.apply(this,arguments)},eaB=function(){G8.apply(this,arguments)},fdf=function(){G8.apply(this,arguments)},Ovv=function(){G8.apply(this,arguments)},ivL=function(){l6.apply(this,arguments)},HvL=function(){G8.apply(this,
arguments)},UWh=function(){G8.apply(this,arguments)},tEz=function(){G8.apply(this,arguments)},dWG=function(){G8.apply(this,arguments)},gLG=function(){G8.apply(this,arguments)},mWv=function(){G8.apply(this,arguments)},yQL=function(){G8.apply(this,arguments)},adL=function(){G8.apply(this,arguments)},VEi=function(){G8.apply(this,arguments)},pf5=function(){G8.apply(this,arguments)},Tm0=function(){G8.apply(this,arguments)},Fph=function(){G8.apply(this,arguments)},$WL=function(){G8.apply(this,arguments)},
vLD=function(){G8.apply(this,arguments)},Lpv=function(){G8.apply(this,arguments)},MEt=function(){G8.apply(this,arguments)},xWl=function(){G8.apply(this,arguments)},DWf=function(){G8.apply(this,arguments)},hat=function(){G8.apply(this,arguments)},ldf=function(){G8.apply(this,arguments)},Ghl=function(){G8.apply(this,arguments)},CIG=function(){G8.apply(this,arguments)},ELh=function(){G8.apply(this,arguments)},oL5=function(){G8.apply(this,arguments)},bvv=function(){G8.apply(this,arguments)},AQw=function(){G8.apply(this,
arguments)},YAL=function(){G8.apply(this,arguments)},Kpw=function(){G8.apply(this,arguments)},SAL=function(){G8.apply(this,arguments)},uQh=function(){G8.apply(this,arguments)},Bmv=function(){G8.apply(this,arguments)},QYG=function(){G8.apply(this,arguments)},Zvh=function(){G8.apply(this,arguments)},JQL=function(n){n=n.key||n.id;
if(!n)throw Error("Entity key is missing");return n},zaw=function(){if(C3)return C3();
var n={};C3=g.Qc("PersistentEntityStoreDb",{PG:(n.EntityStore={kd:1},n.EntityAssociationStore={kd:2},n),shared:!1,upgrade:function(q,w){w(1)&&g.v3(g.a4(q,"EntityStore",{keyPath:"key"}),"entityType","entityType");w(2)&&(q=g.a4(q,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.v3(q,"byParentEntityKey","parentEntityKey"),g.v3(q,"byChildEntityKey","childEntityKey"))},
version:3});return C3()},Wpz=function(n){return g.CW(zaw(),n)},Nmj=function(n){return g.CW((0,g.lov)(),n)},E1=function(n){this.token=n},o3=function(n,q){q=q===void 0?{}:q;
g.b4.call(this,g.GNh[n],Object.assign({},{name:"PESEncoderError",type:n},q));this.type=n;this.level="WARNING";Object.setPrototypeOf(this,o3.prototype)},npi=function(n){return new o3("WRONG_DATA_TYPE",{oT:n})},qzh=function(n){return n instanceof Error?new o3("UNKNOWN_ENCODE_ERROR",{originalMessage:n.message}):new o3("UNKNOWN_ENCODE_ERROR")},wyh=function(n){return n instanceof Error?new o3("UNKNOWN_DECODE_ERROR",{originalMessage:n.message}):new o3("UNKNOWN_DECODE_ERROR")},XyB=function(n,q){n=n instanceof
o3?n:q(n);
g.pC(n);throw n;},PHv=function(){},Rqi=function(n,q,w){try{return n.C(q,w)}catch(X){XyB(X,qzh)}},cjz=function(n){n=(new TextEncoder).encode(n).subarray(0,16);
var q=new Uint8Array(16);q.set(n);return q},b6=function(n){this.N=n},kH0=function(n){var q=IPi[n];
if(q)return q;g.TQ(new g.b4("Entity model not found.",{entityType:n}))},rjv=function(n,q){this.N=n;
this.X=q;this.C={}},sRB=function(n,q){a:{n=jRG(n.X,q.version);
try{var w=n.X(q.data,q.key);break a}catch(X){XyB(X,wyh)}w=void 0}return w},Ap=function(n,q,w){return n.N.objectStore("EntityStore").get(q).then(function(X){if(X){if(w&&X.entityType!==w)throw Error("Incorrect entity type");
return sRB(n,X)}})},YP=function(n,q,w){return w?(w=w.map(function(X){return Ap(n,X,q)}),g.UY.all(w)):n.N.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(q)).then(function(X){return X.map(function(P){return sRB(n,P)})})},S1=function(n,q,w){var X=JQL(q),P=jRG(n.X,1),R=Object.assign({},q);
return n.N.objectStore("EntityStore").get(X).then(function(c){if(c){if(c.entityType!==w)throw Error("Incorrect entity type");R.entityMetadata||(c=sRB(n,c),R.entityMetadata=c.entityMetadata)}}).then(function(){var c={key:X,
entityType:w,data:Rqi(P,R,X),version:1};return g.UY.all([g.Tn(n.N.objectStore("EntityStore"),c),eqL(n,R,w)])}).then(function(){K3(n,X,w);
return X})},fPG=function(n,q,w){q=q.map(function(X){return S1(n,X,w)});
return g.UY.all(q)},u6=function(n,q,w){if(w==null?0:w.qn){var X=new Set;
return OE0(n,q,X).then(function(){for(var R=[],c=g.a(X),k=c.next();!k.done;k=c.next())R.push(u6(n,k.value));return g.UY.all(R).then(function(){})})}var P=g.Sy(q).entityType;
return g.UY.all([n.N.objectStore("EntityStore").delete(q),iE5(n,q)]).then(function(){K3(n,q,P)})},HEv=function(n,q){return g.Da(n.N.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(q)},function(w){return g.UY.all([w.delete(),
iE5(n,w.cursor.primaryKey)]).then(function(){K3(n,w.cursor.primaryKey,q);return g.MU(w)})})},Unh=function(n,q,w,X){var P=jRG(n.X,1);
return Ap(n,q,X).then(function(R){if(R){R=g.ND(R,w);var c={key:q,entityType:X,data:Rqi(P,R,q),version:1};return g.UY.all([g.Tn(n.N.objectStore("EntityStore"),c),eqL(n,R,X)])}}).then(function(){K3(n,q,X);
return q})},K3=function(n,q,w){var X=n.C[w];
X||(X=new Set,n.C[w]=X);X.add(q)},tXB=function(n,q,w){var X=JQL(q);
w=kH0(w);if(!w)return g.UY.resolve([]);w=new w(q);n=n.N.objectStore("EntityAssociationStore");q=[];w=g.a(w.X());for(var P=w.next();!P.done;P=w.next())q.push(g.Tn(n,{parentEntityKey:X,childEntityKey:P.value}));return g.UY.all(q).then(function(R){return R.map(function(c){return c[1]})})},iE5=function(n,q){return n.N.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(q))},eqL=function(n,q,w){var X=JQL(q);
return iE5(n,X).then(function(){return tXB(n,q,w)})},OE0=function(n,q,w){if(w.has(q))return g.UY.resolve(void 0);
w.add(q);return dnD(n,q).then(function(X){return n.N.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(q)).then(function(){return X})}).then(function(X){var P=g.UY.resolve(void 0);
X=g.a(X);for(var R=X.next(),c={};!R.done;c={qJ:void 0},R=X.next())c.qJ=R.value,P=P.then(function(k){return function(){return OE0(n,k.qJ,w)}}(c));
return P}).then(function(){})},dnD=function(n,q){var w=n.N.objectStore("EntityAssociationStore");
return w.index("byParentEntityKey").getAll(IDBKeyRange.only(q)).then(function(X){var P=[];X=g.a(X);for(var R=X.next();!R.done;R=X.next())R=R.value,P.push(w.index("byChildEntityKey").getAll(R.childEntityKey));return g.UY.all(P)}).then(function(X){var P=[];
X=g.a(X);for(var R=X.next();!R.done;R=X.next())R=R.value,R.length===1&&P.push(R[0].childEntityKey);return P})},Bi=function(){},gpt=function(){this.N={};
this.N[0]=new Bi;if(!g.OU("aes_pes_encoder_killswitch")){var n=this.N;try{var q=g.Ah();var w=cjz(q);var X=new b6(new g.RX(w),new g.c$(w))}catch(P){throw n=P instanceof Error?new o3("KEY_CREATION_FAILED",{originalMessage:P.message}):new o3("KEY_CREATION_FAILED"),g.pC(n),n;}n[1]=X}},jRG=function(n,q){q=q===void 0?0:q;
n=n.N[q];if(!n)throw q=new o3("INVALID_ENCODER_VERSION",{oT:q}),g.pC(q),q;return n},QG=function(n,q){g.A.call(this);
this.token=n;this.N=q;this.observers=[];n=new g.W0.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.Ah());n.onmessage=this.X.bind(this);this.channel=n},Z8=function(n,q,w){var X,P,R,c;
return g.b(function(k){if(k.X==1)return g.l(k,Wpz(n.token),2);if(k.X!=3)return X=k.N,g.l(k,g.pW(X,["EntityStore","EntityAssociationStore"],q,function(r){P=new rjv(r,n.N);return w(P)}),3);
R=k.N;P&&(c=P.C,Object.keys(c).length>0&&(n.channel.postMessage(c),mnh(n,c)));return k.return(R)})},Jp=function(n,q,w){return Z8(n,{mode:"readwrite",
z9:!0},function(X){return S1(X,q,w)})},yjv=function(n,q){return Z8(n,{mode:"readwrite",
z9:!0},function(w){return fPG(w,q,"offlineOrchestrationActionWrapperEntity")})},aPw=function(n,q){return Z8(n,{mode:"readwrite",
z9:!0},function(w){return u6(w,q)})},VXi=function(n){return Z8(n,{mode:"readwrite",
z9:!0},function(q){return HEv(q,"videoPlaybackPositionEntity")})},z8=function(n,q,w){return Z8(n,{mode:"readonly",
z9:!0},function(X){return Ap(X,q,w)})},Wi=function(n,q,w){return Z8(n,{mode:"readonly",
z9:!0},function(X){return YP(X,q,w)})},mnh=function(n,q){n=g.a(n.observers);
for(var w=n.next();!w.done;w=n.next())w=w.value,w(q)},pyj=function(){var n,q,w;
return g.b(function(X){if(X.X==1)return g.Vy(X,2),g.l(X,g.ug(),4);if(X.X!=2){n=X.N;if(!n||!g.YN()||typeof g.W0.BroadcastChannel==="undefined")return X.return();q=new gpt;return X.return(new QG(n,q))}w=g.$u(X);w instanceof Error&&g.pC(w);return X.return()})},Nz=function(){THL||(THL=pyj());
return THL},FAt=function(n){var q;
n=(q=n.options)==null?void 0:q.persistenceOption;return n==="ENTITY_PERSISTENCE_OPTION_PERSIST"||n==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},$nf=function(n){var q;
return g.b(function(w){return w.X==1?g.l(w,Nz(),2):(q=w.N)?g.l(w,Z8(q,"readwrite",function(X){for(var P={},R=g.a(n),c=R.next(),k={};!c.done;k={dw:void 0,DI:void 0},c=R.next())k.dw=c.value,k.dw.entityKey&&FAt(k.dw)&&(k.DI=g.cJ(k.dw.payload),c=void 0,k.dw.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(c=function(r){return function(){return S1(X,r.dw.payload[r.DI],r.DI)}}(k)),k.dw.type==="ENTITY_MUTATION_TYPE_DELETE"&&(c=function(r){return function(){return u6(X,r.dw.entityKey)}}(k)),k.dw.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(c=function(r){return function(){return Unh(X,r.dw.entityKey,r.dw.payload[r.DI],r.DI)}}(k)),c&&(P[k.dw.entityKey]=P[k.dw.entityKey]?P[k.dw.entityKey].then(c):c()));
return g.UY.all(Object.values(P))}),0):w.return()})},vpv=function(n){var q;
return g.b(function(w){if(w.X==1){q=n.mutations;if(!q||q.length<=0)return w.return();if(g.mB){var X={type:"ENTITY_LOADED"};q!==void 0&&(X.payload=q);g.mB.dispatch(X)}return g.l(w,$nf(q),2)}q.length=0;g.yy(w)})},LAG=function(n){return n!==void 0},MXD=function(n){var q=g.Zj();
q=Object.assign({},q);n=Object.assign({},n);for(var w in q)n[w]?(q[w]!==4&&(q[w]=n[w]),delete n[w]):q[w]!==2&&(q[w]=4);Object.assign(q,n);g.CT6(q);JSON.stringify(q);return q},xnv=function(n){var q,w;
return g.b(function(X){if(X.X==1)return g.l(X,g.ug(),2);if(X.X!=3)return(q=X.N)?g.l(X,g.WI(q),3):X.return();w=X.N;return X.return(g.pW(w,["index","media","captions"],{mode:"readwrite",z9:!0},function(P){var R=IDBKeyRange.bound(n+"|",n+"~");P=[P.objectStore("index").delete(R),P.objectStore("media").delete(R),P.objectStore("captions").delete(R)];return g.UY.all(P).then(function(){})}))})},DnG=function(){var n,q;
return g.b(function(w){if(w.X==1)return g.l(w,g.ug(),2);if(w.X!=3){n=w.N;if(!n)throw g.ig("rvdfd");return g.l(w,g.WI(n),3)}q=w.N;return w.return(g.pW(q,["index","media"],{mode:"readwrite",z9:!0},function(X){var P={};return g.LW(X.objectStore("index"),{},function(R){var c=R.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),k=g.UY.resolve(void 0);if(c){var r=c[1];c=c[2];P[r]=P[r]||{};var e;P[r][c]=g.YuY((e=R.getValue())==null?void 0:e.fmts)}else k=R.delete().then(function(){});
return g.UY.all([g.MU(R),k]).then(function(f){return g.a(f).next().value})}).then(function(){for(var R={},c=g.a(Object.keys(P)),k=c.next();!k.done;k=c.next()){k=k.value;
var r=P[k].v;R[k]=P[k].a&&r?1:2}var e=MXD(R);return g.L7O(X.objectStore("media"),{},function(f){var O=f.cursor.key.match(g.BzO);O&&R[O[1]]||X.objectStore("media").delete(f.cursor.key);return g.m40(f)}).then(function(){return e})})}))})},hqh=function(n,q){var w,X;
return g.b(function(P){if(P.X==1)return g.l(P,g.ug(),2);if(P.X!=3){w=P.N;if(!w)throw g.ig("wct");return g.l(P,g.WI(w),3)}X=P.N;return g.l(P,g.pW(X,["captions"],{mode:"readwrite",z9:!0},function(R){var c=[];R=R.objectStore("captions");for(var k=0;k<q.length;k++){var r=g.Tn(R,q[k],n+"|"+q[k].metadata.vss_id);c.push(r)}return g.UY.all(c)}),0)})},lP5=function(n){var q,w,X;
return g.b(function(P){if(P.X==1)return q=IDBKeyRange.bound(n+"|",n+"~"),g.l(P,g.ug(),2);if(P.X!=3){w=P.N;if(!w)throw g.ig("gactfv");return g.l(P,g.WI(w),3)}X=P.N;return P.return(X.getAll("captions",q))})},GHj=function(n){return g.b(function(q){g.zB(n,0);
return q.return(xnv(n))})},CHh=function(n){return{context:g.S6(),
videoIds:n}},EpG=function(n){return{context:g.S6(),
playlistIds:n}},opB=function(n){return{context:g.S6(),
offlinePlaylistSyncChecks:n}},bEL=function(){this.N=new Map},Yzl=function(){AjG||(AjG=new bEL);
return AjG},KAl=function(n,q){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:n},metadata:q,statusCode:void 0,csn:void 0,can:void 0}},SzG=function(n,q,w){if(!w){var X=X===void 0?!1:X;
w=n.N.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!w||X)w=g.Os(16),n.N.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",w)}n={flowNonce:w,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:q.eventType};q.metadata&&(n.flowMetadata=q.metadata);q.statusCode!==void 0&&(n.flowEventStatus=q.statusCode);q.csn&&(n.csn=q.csn);q.can&&(n.can=q.can);g.Xc("flowEvent",n,void 0)},ue5=function(n){var q,w,X,P,R,c,k,r,e,f,O,H,U,t,V,T,x,M,h,E,S,nO,J,c0,ku,Is,e3,wx,v0,ls,ql,o5,g0,E6,WG,HG,SB,wR,L,El;
return g.b(function(DL){if(DL.X==1)return g.l(DL,Z8(n,{mode:"readonly",z9:!0},function(XY){return YP(XY,"playbackData").then(function(Tf){var p=Tf.map(function(bz){return bz.transfer}).filter(function(bz){return!!bz}),qs=Tf.map(function(bz){return bz.offlineVideoPolicy}).filter(function(bz){return!!bz}),uQ=Tf.filter(function(bz){return!!bz.key}).map(function(bz){return g.uP(g.Sy(bz.key).entityId,"downloadStatusEntity")});
p=YP(XY,"transfer",p);qs=YP(XY,"offlineVideoPolicy",qs);uQ=YP(XY,"downloadStatusEntity",uQ);var IP=p.then(function(bz){bz=bz.reduce(function(us,Ns){(Ns==null?0:Ns.offlineVideoStreams)&&us.push.apply(us,g.D(Ns.offlineVideoStreams));return us},[]).filter(function(us){return!!us});
return YP(XY,"offlineVideoStreams",bz)});
return g.UY.all([p,qs,IP,uQ]).then(function(bz){var us=g.a(bz);bz=us.next().value;var Ns=us.next().value;var no=us.next().value;us=us.next().value;return[Tf,bz,Ns,no,us]})})}),2);
if(DL.X!=3)return q=DL.N,g.l(DL,Z8(n,{mode:"readonly",z9:!0},function(XY){return YP(XY,"mainDownloadsListEntity").then(function(Tf){var p,qs;return(qs=(p=Tf[0])==null?void 0:p.downloads)!=null?qs:[]})}),3);
w=DL.N;X=g.a(q);P=X.next().value;R=X.next().value;c=X.next().value;k=X.next().value;r=X.next().value;e=P;f=R;O=c;H=k;U=r;t={};V={};T={};x={};M={};h=[];E=g.a(f);for(S=E.next();!S.done;S=E.next())(nO=S.value)&&(t[nO.key]=nO);J=g.a(O);for(c0=J.next();!c0.done;c0=J.next())(ku=c0.value)&&(V[ku.key]=ku);Is=g.a(U);for(e3=Is.next();!e3.done;e3=Is.next())(wx=e3.value)&&(T[wx.key]=wx);v0=g.a(H);for(ls=v0.next();!ls.done;ls=v0.next())(ql=ls.value)&&(x[ql.key]=ql);o5=g.a(w);for(g0=o5.next();!g0.done;g0=o5.next())E6=
g0.value,WG=void 0,M[(WG=E6.videoItem)!=null?WG:""]=!0,E6.videoItem&&(SB=HG=void 0,wR=(SB=(HG=g.Sy(E6.videoItem))==null?void 0:HG.entityId)!=null?SB:"",h.push({externalVideoId:wR}));L=e.filter(function(XY){if(!XY||!XY.key||!XY.offlineVideoPolicy)return!1;XY=g.Sy(XY.key).entityId;XY=g.uP(XY,"downloadStatusEntity");var Tf;return!(XY&&((Tf=T[XY])==null?void 0:Tf.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
El=L.map(function(XY){var Tf=t[XY.transfer],p=[];if(Tf==null?0:Tf.offlineVideoStreams)for(var qs=g.a(Tf.offlineVideoStreams),uQ=qs.next();!uQ.done;uQ=qs.next())(uQ=x[uQ.value])&&p.push(uQ);qs=V[XY.offlineVideoPolicy];uQ=M;var IP=XY==null?void 0:XY.playerResponseTimestamp,bz=g.Sy(qs.key).entityId;XY=g.uP(bz,"mainVideoEntity");if(qs.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var us="OFFLINE_VIDEO_STATE_DISABLED";qs.expirationTimestamp&&Number(qs.expirationTimestamp)<Date.now()/1E3&&(us="OFFLINE_VIDEO_STATE_EXPIRED")}else if(qs.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")us="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(Tf==null?void 0:Tf.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":us="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":us="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":us="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":us="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":us="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":us="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:us="OFFLINE_VIDEO_STATE_UNKNOWN"}if(us==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(Tf==null?void 0:Tf.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":us="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":us="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":us=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}bz={id:bz,videoState:us};if(Tf==null?0:Tf.cotn)bz.cotn=Tf.cotn;if(Tf==null?0:Tf.maximumDownloadQuality)bz.selectedVideoQuality=Tf==null?void 0:Tf.maximumDownloadQuality;if(Tf==null?0:Tf.lastProgressTimeMs)bz.lastProgressTimeMs=Tf.lastProgressTimeMs;IP&&(bz.playerResponseSavedTimeMs=String(Number(IP)*1E3));Tf=String;IP=0;p=g.a(p);for(us=p.next();!us.done;us=p.next())if(us=us.value,us.streamsProgress){us=g.a(us.streamsProgress);for(var Ns=us.next();!Ns.done;Ns=us.next()){var no=
void 0;IP+=Number((no=Ns.value.numBytesDownloaded)!=null?no:0)}}bz.downloadedBytes=Tf(IP);bz.selectedOfflineMode=uQ[XY]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";qs.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(bz.offlinePlaybackDisabledReason=qs.offlinePlaybackDisabledReason);return bz});
return DL.return({offlineVideos:El,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:h}}})})},BHh=function(){this.locks=navigator.locks},QRG=function(){try{var n=g.w0("ytglobal.locks_");
if(n)return n;var q;if(q=navigator){var w=navigator;q="locks"in w&&!!w.locks}if(q)return g.W0.localStorage&&g.W0.localStorage.getItem("noop"),n=new BHh,g.nj("ytglobal.locks_",n),n}catch(X){}},nn=function(){},ZEL=function(){},Jji=function(n){if(n.includes(":"))throw Error("Invalid user cache name: "+n);
return n+":"+g.Ah("CacheStorage get")},zqt=function(){return g.b(function(n){if(qS!==void 0)return n.return(qS);
qS=new Promise(function(q){var w;return g.b(function(X){switch(X.X){case 1:return g.Vy(X,2),g.l(X,wJ.open("test-only"),4);case 4:return g.l(X,wJ.delete("test-only"),5);case 5:g.FY(X,3);break;case 2:if(w=g.$u(X),w instanceof Error&&w.name==="SecurityError")return q(!1),X.return();case 3:q("caches"in window),g.yy(X)}})});
return n.return(qS)})},NH5=function(){return g.b(function(n){if(n.X==1)return g.l(n,zqt(),2);
if(!n.N)return n.return(void 0);WAf||(WAf=new ZEL);return n.return(WAf)})},Xt=function(n,q,w){g.TQ(new g.b4("Woffle: "+n,w?{cotn:w}:""));
q instanceof Error&&g.TQ(q)},nDv=function(n){var q;
return g.b(function(w){if(w.X==1)return g.l(w,ue5(n),2);q=w.N;g.Xc("offlineStateSnapshot",q);g.yy(w)})},Pd=function(n){g.A.call(this);
var q=this;this.api=n;this.Wb={uiT:function(){return q.N},
BDT:function(){return q.X}};
typeof g.W0.BroadcastChannel!=="undefined"&&(this.N=new g.W0.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.Ah()),this.N.onmessage=this.C.bind(this),this.X=new g.W0.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.Ah()),this.X.onmessage=this.W.bind(this))},RH=function(n,q){n.api.Uq("onOfflineOperationFailure",q);
var w;(w=n.N)==null||w.postMessage(q)},qgt=function(n,q,w){var X=this;
this.V=n;this.L=q;this.visibility=w;this.K=this.G=this.D=this.C=this.N=!1;this.W=new g.YF(function(){X.OO()});
this.Wb={UH:function(){return X.X},
OO:function(){X.OO()},
NHH:function(){return X.W}};
this.visibility.subscribe("visibilitystatechange",function(){X.d$()})},wRG=function(n){if(!n.C&&!n.N){var q=QRG();
if(q){n.C=!0;var w=g.Ah("OfflineLockManager");q.request("woffle_orchestration_leader:"+w,{},function(){var X,P;return g.b(function(R){switch(R.X){case 1:return g.Vy(R,2),n.X=new g.cR,n.N=!0,n.C=!1,g.l(R,n.V(),4);case 4:return g.l(R,n.X.promise,5);case 5:g.FY(R,0);break;case 2:X=g.$u(R),n.OO(),X instanceof Error&&(P=X,P.args=[{name:"WoLockManagerError",yl:X.name}],g.pC(P)),g.yy(R)}})})}}},XRD=function(n){n.N&&(n.K=!0,cd(n))},PtD=function(n,q){n.N&&(n.D=q,cd(n))},R85=function(n,q){n.N&&(n.G=q,cd(n))},
cd=function(n){n.G&&n.D&&n.K&&n.visibility.isBackground()?g.K9(n.W,6E4):n.W.stop()},IH=function(n){var q;
n.offlineDeleteReason=(q=n.offlineDeleteReason)!=null?q:"OFFLINE_DELETE_REASON_UNKNOWN";var w;n.offlineModeType=(w=n.offlineModeType)!=null?w:"OFFLINE_NOW";g.Xc("offlineDeleteEvent",n)},k7=function(n,q){var w=q.videoId;
var X=q.Lq;q=q.offlineModeType;n.encryptedVideoId=w;n.cotn=X==null?void 0:X.cotn;n.offlineabilityFormatType=X==null?void 0:X.maximumDownloadQuality;var P;n.isRefresh=(P=X==null?void 0:X.isRefresh)!=null?P:!1;var R;n.softErrorCount=(R=X==null?void 0:X.transferRetryCount)!=null?R:0;n.offlineModeType=q!=null?q:"OFFLINE_NOW";(n.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&n.statusType==="UNKNOWN_STATUS_TYPE"||!n.transferStatusType&&!n.statusType)&&g.TQ(Error("Woffle unknown transfer status"));
g.Xc("offlineTransferStatusChanged",n)},cs0=function(n){k7({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},n)},IJB=function(n,q,w,X){X={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!X};q&&w&&(q=Math.floor(q/1024).toFixed(),w=Math.floor(w/1024).toFixed(),X.alreadyDownloadedKbytes=q,X.totalFetchedKbytes=q,X.totalContentKbytes=w);k7(X,n)},kuz=function(n){k7({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},n)},rst=function(n){k7({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},n)},j2G=function(n){switch(n){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
rJ=function(n){var q,w,X;
return((X=(q=n.actionMetadata)==null?void 0:(w=q.retryScheduleIntervalsInSeconds)==null?void 0:w.length)!=null?X:0)>0},jU=function(n){return n.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!n.entityKey},sC=function(n){return n.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!n.entityKey},eU=function(n){return n.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!n.entityKey},s2t=function(n){return n.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!n.entityKey},
fn=function(n,q,w,X,P){P=P===void 0?!1:P;
var R,c,k,r,e,f;return g.b(function(O){if(O.X==1)return R=g.uP(n,q),c=g.uP(n,"downloadStatusEntity"),g.l(O,Z8(w,{mode:"readonly",z9:!0},function(H){return g.UY.all([Ap(H,R,q),Ap(H,c,"downloadStatusEntity")])}),2);
k=O.N;r=k.length?k[0]:void 0;if(!r)return O.f5(0);e=e8t;if(f=k.length>1?k[1]:void 0){if(f.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!P)return O.return();f.downloadState=X}else f={key:c,downloadState:X};g.M0(r,e,f);return g.l(O,Z8(w,{mode:"readwrite",z9:!0},function(H){return g.UY.all([S1(H,r,q),S1(H,f,"downloadStatusEntity")])}),0)})},OC=function(n,q){return n.actionType===q.actionType&&n.entityKey===q.entityKey},io=function(n,q){if(n&&n.transferState!=="TRANSFER_STATE_COMPLETE"&&n.transferState!==
"TRANSFER_STATE_FAILED"){var w=g.Sy(n.key).entityId;
k7({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:w,Lq:n,offlineModeType:q})}},Hd=function(n){if(!n||!n.thumbnails)return[];
var q=[];n=g.a(n.thumbnails);for(var w=n.next();!w.done;w=n.next())w=w.value,w.url&&q.push(w.url);return q},fJB=function(n,q,w){w=w===void 0?[]:w;
var X,P,R,c,k,r,e,f,O,H,U,t,V;return g.b(function(T){if(T.X==1)return w.length?g.l(T,Wi(n,q),2):T.return([]);X=T.N;P=new Set;R=g.a(X);for(c=R.next();!c.done;c=R.next())if(k=c.value,r=k.id||k.key)e=g.Sy(r).entityId,P.add(e);f=[];O=g.a(w);for(H=O.next();!H.done;H=O.next())U=H.value,t=U.offlineVideoData,V=void 0,((V=t)==null?0:V.videoId)&&!P.has(t.videoId)&&f.push(U);return T.return(f)})},OLj=function(n,q,w){return new g.jF(n,{cotn:q,
raw_player_response:w,download_media:!0,start:Infinity,disable_watch_next:!0})},iLz=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},UC=function(n,q,w,X,P,R,c,k,r,e,f){this.entityType=n;
this.actionId=q;this.action=w;this.parentActionId=X;this.rootActionId=P===void 0?q:P;this.childActionIds=R;this.prereqActionId=c;this.postreqActionIds=k;this.hasChildActionFailed=e;this.retryScheduleIndex=0;this.N=f||Date.now();this.retryScheduleIndex=r||0},tC=function(n){if(!n.key)throw Error("Entity key is required.");
if(!n.actionProto)throw Error("OfflineOrchestrationAction is required.");var q=g.Sy(n.key),w=g.Sy(n.actionProto.entityKey);return new UC(w.entityType,q.entityId,n.actionProto,n.parentActionId,n.rootActionId,n.childActionIds,n.prereqActionId,n.postreqActionIds,n.retryScheduleIndex,n.hasChildActionFailed,Number(n.enqueueTimeSec)*1E3)},dJ=function(n){return{key:g.uP(n.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:n.action,parentActionId:n.parentActionId,rootActionId:n.rootActionId,childActionIds:n.childActionIds,prereqActionId:n.prereqActionId,postreqActionIds:n.postreqActionIds,retryScheduleIndex:n.retryScheduleIndex,hasChildActionFailed:n.hasChildActionFailed,enqueueTimeSec:(n.N/1E3).toFixed()}},HLt=function(){var n;
return g.b(function(q){return q.X==1?g.l(q,NH5(),2):(n=q.N)?q.return(n.delete("yt-player-local-img")):q.return(!0)})},gJ=function(n){var q,w;
return g.b(function(X){if(X.X==1)return g.l(X,NH5(),2);if(X.X!=3){q=X.N;if(!q)throw Error("Cache API not supported");return n.length?g.l(X,q.open("yt-player-local-img"),3):X.return()}w=X.N;return g.l(X,Promise.all(n.map(function(P){return w.delete(P)})),0)})},ms=function(n){var q,w;
return g.b(function(X){if(X.X==1)return g.l(X,NH5(),2);if(X.X!=3){q=X.N;if(!q)throw Error("Cache API not supported");return n.length?g.l(X,q.open("yt-player-local-img"),3):X.return()}w=X.N;return g.l(X,w.addAll(n),0)})},yV=function(n,q,w,X,P){var R,c,k,r,e,f,O,H,U,t,V,T,x,M,h,E,S,nO,J,c0,ku,Is,e3,wx,v0,ls,ql,o5,g0,E6,WG;
return g.b(function(HG){switch(HG.X){case 1:return R=g.uP(n,"mainVideoEntity"),c=g.uP(n,"ytMainChannelEntity"),k=g.uP(n,"transfer"),r=g.uP(n,"videoDownloadContextEntity"),g.l(HG,Z8(q,{mode:"readonly",z9:!0},function(SB){return g.UY.all([Ap(SB,R,"mainVideoEntity"),Ap(SB,c,"ytMainChannelEntity"),Ap(SB,k,"transfer"),Ap(SB,r,"videoDownloadContextEntity"),YP(SB,"ytMainChannelEntity"),YP(SB,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:e=HG.N;f=g.a(e);O=f.next().value;H=f.next().value;U=f.next().value;t=f.next().value;V=f.next().value;T=f.next().value;x=O;M=H;h=U;E=t;S=V;nO=T;if(!x&&!M){HG.f5(3);break}J=x?Hd(x.thumbnail):[];if(!M){c0=[];HG.f5(4);break}return g.l(HG,ULi(M,S),5);case 5:c0=HG.N;case 4:return ku=c0,g.l(HG,gJ(J.concat(ku)),3);case 3:Is=[];e3=g.uP(n,"downloadStatusEntity");wx=g.a(nO);for(v0=wx.next();!v0.done;v0=wx.next())ls=v0.value,ql=g.Sy(ls.key).entityId,o5=tC(ls),g0=g.Sy(o5.action.entityKey).entityId,ql!==
n&&g0!==n||OC(w,ls.actionProto)||Is.push(ls.key);return g.l(HG,Z8(q,{mode:"readwrite",z9:!0},function(SB){var wR=Is.map(function(L){return u6(SB,L)});
wR.push(u6(SB,R,{qn:!0}));wR.push(u6(SB,e3,{qn:!0}));return g.UY.all(wR)}),7);
case 7:WG=(E6=E)==null?void 0:E6.offlineModeType,P&&(IH(P),P.offlineModeType&&(WG=P.offlineModeType)),io(h,WG),RH(X,{entityKey:R,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.yy(HG)}})},gDz=function(n,q,w,X){var P,R,c,k,r,e,f,O,H,U,t,V,T,x,M,h,E,S,nO,J,c0,ku,Is,e3,wx,v0,ls,ql,o5,g0,E6,WG,HG,SB,wR,L,El,DL,XY,Tf,p,qs,uQ,IP,bz,us,Ns,no,oF,F;
return g.b(function(y){switch(y.X){case 1:return P=g.uP(n,"mainPlaylistEntity"),R=g.uP(n,"ytMainChannelEntity"),g.l(y,Z8(q,{mode:"readonly",z9:!0},function(v){return g.UY.all([Ap(v,P,"mainPlaylistEntity"),Ap(v,R,"ytMainChannelEntity"),YP(v,"mainPlaylistEntity"),YP(v,"mainDownloadsListEntity"),YP(v,"ytMainChannelEntity"),YP(v,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:c=y.N;k=g.a(c);r=k.next().value;e=k.next().value;f=k.next().value;O=k.next().value;H=k.next().value;U=k.next().value;t=r;V=e;T=f;x=O;M=H;h=U;if(!t&&!V){y.f5(3);break}E=t?tmG(t):[];if(!V){S=[];y.f5(4);break}return g.l(y,ULi(V,M),5);case 5:S=y.N;case 4:return nO=S,g.l(y,gJ(E.concat(nO)),3);case 3:J=[];c0=new Map;if(!t){y.f5(7);break}return g.l(y,dLw(t,T,x),8);case 8:J=y.N;ku=g.a(J);for(Is=ku.next();!Is.done;Is=ku.next())e3=Is.value,c0.set(e3,{videoId:e3,playlistId:n,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.l(y,Z8(q,{mode:"readonly",z9:!0},function(v){return g.UY.all([YP(v,"transfer"),YP(v,"videoDownloadContextEntity")])}),9);
case 9:wx=y.N;v0=g.a(wx);ls=v0.next().value;ql=v0.next().value;o5=ls;g0=ql;E6=g.a(o5);for(WG=E6.next();!WG.done;WG=E6.next())HG=WG.value,SB=g.Sy(HG.key).entityId,(wR=c0.get(SB))&&HG&&(wR.cotn=HG.cotn);L=g.a(g0);for(El=L.next();!El.done;El=L.next())DL=El.value,XY=g.Sy(DL.key).entityId,(Tf=c0.get(XY))&&DL&&(Tf.offlineModeType=DL.offlineModeType);case 7:p=[];qs=g.a(h);for(uQ=qs.next();!uQ.done;uQ=qs.next())IP=uQ.value,bz=g.Sy(IP.key).entityId,us=tC(IP),bz!==n&&us.rootActionId!==n||OC(w,IP.actionProto)||
p.push(IP.key);Ns=g.uP(n,"mainPlaylistEntity");return g.l(y,Z8(q,{mode:"readwrite",z9:!0},function(v){var G=p.map(function(Y){return u6(v,Y)});
G.push(u6(v,Ns,{qn:!0}));return g.UY.all(G)}),10);
case 10:if(!t){y.f5(0);break}J.reverse();if(!J){y.f5(0);break}no=g.a(J);oF=no.next();case 13:if(oF.done){y.f5(0);break}F=oF.value;return g.l(y,yV(F,q,w,X,c0.get(F)),14);case 14:oF=no.next(),y.f5(13)}})},ysz=function(n,q,w,X){var P,R,c,k,r,e,f,O,H;
return g.b(function(U){if(U.X==1)return P=g.uP("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),R=new Map,g.l(U,Z8(n,{mode:"readwrite",z9:!0},function(t){var V=YP(t,"transfer"),T=YP(t,"offlineOrchestrationActionWrapperEntity"),x=YP(t,"videoDownloadContextEntity"),M=Ap(t,P,"mainDownloadsListEntity");return g.UY.all([V,T,x,M]).then(function(h){h=g.a(h);var E=h.next().value;var S=h.next().value;var nO=h.next().value;var J=h.next().value;h=mLi.map(function(ku){return HEv(t,ku)});
S=g.a(S);for(var c0=S.next();!c0.done;c0=S.next())c0=c0.value,OC(q,c0.actionProto)||h.push(u6(t,c0.key,{qn:!0}));J&&(J.downloads=[],h.push(S1(t,J,"mainDownloadsListEntity")));if(nO)for(nO=g.a(nO),J=nO.next();!J.done;J=nO.next())J=J.value,S=g.Sy(J.key).entityId,S=g.uP(S,"transfer"),R.set(S,J.offlineModeType);return g.UY.all(h).then(function(){return E})})}),2);
c=U.N;k=g.a(c);for(r=k.next();!r.done;r=k.next())e=r.value,io(e,R.get(e.key)),f=g.Sy(e.key).entityId,O={videoId:f,offlineDeleteReason:X,cotn:e.cotn,offlineModeType:R.get(e.key)},IH(O),H=g.uP(f,"mainVideoEntity"),RH(w,{entityKey:H,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.l(U,HLt(),0)})},tmG=function(n,q){var w=[];
if(n.thumbnailStyleData){n=g.a(n.thumbnailStyleData);for(var X=n.next();!X.done;X=n.next()){var P=void 0,R=void 0,c=void 0;w=w.concat(Hd((P=X.value)==null?void 0:(R=P.value)==null?void 0:(c=R.collageThumbnail)==null?void 0:c.coverThumbnail))}}q=Hd(q);return w.concat(q)},dLw=function(n,q,w){var X,P,R,c,k,r,e,f,O,H,U,t,V,T,x,M,h,E,S,nO,J,c0,ku;
return g.b(function(Is){X=[];P=new Set;if(w.length)for(R=g.a(w),c=R.next();!c.done;c=R.next())if(k=c.value,r=void 0,(r=k.downloads)==null?0:r.length)for(e=g.a(k.downloads),f=e.next();!f.done;f=e.next())O=f.value,O.videoItem&&(H=g.Sy(O.videoItem).entityId,P.add(H));if(n.videos){U=g.a(n.videos);for(t=U.next();!t.done;t=U.next())V=t.value,T=JSON.parse(g.Sy(V).entityId),T.videoId&&!P.has(T.videoId)&&X.push(T.videoId);x=g.a(q);for(M=x.next();!M.done;M=x.next())if(h=M.value,h.key!==n.key&&(E=h.videos))for(S=
g.a(E),nO=S.next();!nO.done;nO=S.next())J=nO.value,c0=JSON.parse(g.Sy(J).entityId),c0.videoId&&(ku=X.indexOf(c0.videoId),ku!==-1&&X.splice(ku,1))}return Is.return(X)})},ULi=function(n,q){var w,X,P,R,c,k,r,e;
return g.b(function(f){w=Hd(n.avatar);X=g.a(q);for(P=X.next();!P.done;P=X.next())if(R=P.value,R.id!==n.id)for(c=g.a(Hd(R.avatar)),k=c.next();!k.done;k=c.next())r=k.value,e=w.indexOf(r),e!==-1&&w.splice(e,1);return f.return(w)})},aJt=function(n){var q;
return g.b(function(w){q=g.u(n.frameworkUpdates,aH);return n.frameworkUpdates&&q?g.l(w,vpv(q),0):w.return()})},pRj=function(n){var q;
if((q=n.onResponseReceivedActions)!=null&&q.length){var w;n=(w=g.u(g.u(n.onResponseReceivedActions[0],Vmj),g.xEt))==null?void 0:w.actions;if(n!=null&&n.length)return n}},T7f=function(n){var q,w,X;
return g.b(function(P){if(P.X==1)return n?g.l(P,z8(n,g.Al,"mainDownloadsListEntity"),2):P.return([]);q=P.N;return((w=q)==null?0:(X=w.downloads)==null?0:X.length)?P.return(q.downloads.map(function(R){var c;return(c=R.videoItem)!=null?c:""})):P.return([])})},$L5=function(n,q){var w;
return g.b(function(X){return X.X==1?g.l(X,Fyh(n,q),2):(w=X.N)?g.l(X,Z8(n,{mode:"readwrite",z9:!0},function(P){var R=[S1(P,w.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];w.mainDownloadsListEntity&&R.push(S1(P,w.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.UY.all(R)}),0):X.f5(0)})},Fyh=function(n,q){var w,X,P,R,c,k,r,e,f,O,H,U,t,V,T,x,M,h;
return g.b(function(E){if(E.X==1)return w=g.uP("main_downloads_library_id","mainDownloadsLibraryEntity"),X=g.uP("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.l(E,Z8(n,{mode:"readonly",z9:!0},function(S){return g.UY.all([Ap(S,w,"mainDownloadsLibraryEntity"),Ap(S,X,"mainDownloadsListEntity")])}),2);
P=E.N;R=g.a(P);c=R.next().value;k=R.next().value;r=c;e=k;r||(r={id:w});f=g.a(q);for(O=f.next();!O.done;O=f.next())if(H=O.value,H===g.Al){if(r.smartDownloadsList)return E.return();r.smartDownloadsList=H}else if(U=g.Sy(H).entityType,t={},U==="mainPlaylistEntity"?t.playlistItem=H:U==="mainVideoEntity"&&(t.videoItem=H),!g.fV(t)){V=void 0;if((V=e)==null?0:V.downloads){T=!1;x=g.a(e.downloads);for(M=x.next();!M.done;M=x.next())if(h=M.value,h.playlistItem===H||h.videoItem===H){T=!0;break}T||e.downloads.push(t)}else e=
{id:X,downloads:[t]};r.downloadsList=X}return E.return({mainDownloadsLibraryEntity:r,mainDownloadsListEntity:e})})},vDL=function(n,q){var w,X,P,R,c,k,r,e,f,O,H,U,t,V,T;
return g.b(function(x){if(x.X==1)return w=g.uP("main_downloads_library_id","mainDownloadsLibraryEntity"),X=g.uP("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.l(x,Z8(n,{mode:"readonly",z9:!0},function(M){return g.UY.all([Ap(M,w,"mainDownloadsLibraryEntity"),Ap(M,X,"mainDownloadsListEntity"),Ap(M,g.Al,"mainDownloadsListEntity")])}),2);
P=x.N;R=g.a(P);c=R.next().value;k=R.next().value;r=R.next().value;e=c;f=k;O=r;if(!e)return x.f5(0);if(q===g.Al&&((H=O)==null?0:H.downloads))O.downloads=[];else if((U=f)==null?0:U.downloads)for(t=g.Sy(q).entityType,V=0;V<f.downloads.length;V++)if(T=f.downloads[V],t==="mainVideoEntity"&&T.videoItem===q){f.downloads.splice(V,1);break}else if(t==="mainPlaylistEntity"&&T.playlistItem===q){f.downloads.splice(V,1);break}return g.l(x,Z8(n,{mode:"readwrite",z9:!0},function(M){var h=[S1(M,e,"mainDownloadsLibraryEntity")];
f&&h.push(S1(M,f,"mainDownloadsListEntity"));O&&h.push(S1(M,O,"mainDownloadsListEntity"));return g.UY.all(h)}),0)})},VV=function(n,q){var w,X,P,R,c,k,r,e,f,O,H;
return g.b(function(U){if(U.X==1)return w=g.uP(q,"transfer"),X=g.uP(q,"videoDownloadContextEntity"),g.l(U,Z8(n,{mode:"readonly",z9:!0},function(t){return g.UY.all([Ap(t,w,"transfer"),Ap(t,X,"videoDownloadContextEntity")])}),2);
P=U.N;R=g.a(P);c=R.next().value;k=R.next().value;r=c;e=k;H={videoId:q,cotn:(f=r)==null?void 0:f.cotn,offlineModeType:(O=e)==null?void 0:O.offlineModeType};return U.return(H)})},pn=function(n,q,w,X,P){var R,c,k,r,e,f,O,H,U,t,V,T,x,M,h,E,S,nO,J,c0;
return g.b(function(ku){switch(ku.X){case 1:return R=g.uP(n,"musicTrack"),c=g.uP(n,"transfer"),g.l(ku,Z8(q,{mode:"readonly",z9:!0},function(Is){return g.UY.all([Ap(Is,R,"musicTrack"),Ap(Is,c,"transfer"),YP(Is,"musicTrack"),YP(Is,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:k=ku.N;r=g.a(k);e=r.next().value;f=r.next().value;O=r.next().value;H=r.next().value;U=e;t=f;V=O;T=H;if(!U){ku.f5(3);break}return g.l(ku,Lyw(U,V),4);case 4:return x=ku.N,g.l(ku,gJ(x),3);case 3:M=[];h=g.a(T);for(E=h.next();!E.done;E=h.next())S=E.value,nO=g.Sy(S.key).entityId,J=tC(S),c0=g.Sy(J.action.entityKey).entityId,nO!==n&&c0!==n||OC(w,S.actionProto)||M.push(S.key);return g.l(ku,Z8(q,{mode:"readwrite",z9:!0},function(Is){var e3=M.map(function(wx){return u6(Is,wx)});
e3.push(u6(Is,R,{qn:!0}));return g.UY.all(e3)}),6);
case 6:io(t),P&&IH(P),RH(X,{entityKey:R,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.yy(ku)}})},TA=function(n,q,w,X,P){var R,c,k,r,e,f,O,H,U,t,V,T,x,M,h,E,S,nO,J,c0,ku,Is,e3,wx,v0,ls,ql,o5,g0,E6,WG,HG,SB,wR,L,El;
return g.b(function(DL){switch(DL.X){case 1:return R=g.uP(n,q),c=g.uP("music_downloads_library_id","musicDownloadsLibraryEntity"),g.l(DL,Z8(w,{mode:"readonly",z9:!0},function(XY){return g.UY.all([Ap(XY,R,q),Ap(XY,c,"musicDownloadsLibraryEntity"),YP(XY,q),YP(XY,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:k=DL.N;r=g.a(k);e=r.next().value;f=r.next().value;O=r.next().value;H=r.next().value;U=e;t=f;V=O;T=H;if(!U){DL.f5(3);break}return g.l(DL,Lyw(U,V),4);case 4:return x=DL.N,g.l(DL,gJ(x),3);case 3:M=[];h=new Map;if(!U){DL.f5(6);break}return g.l(DL,Mm5(U,V,t),7);case 7:M=DL.N;E=g.a(M);for(S=E.next();!S.done;S=E.next())nO=S.value,J=g.Sy(nO).entityId,h.set(J,{videoId:J,playlistId:n,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.l(DL,Wi(w,"transfer"),8);case 8:for(c0=DL.N,
ku=g.a(c0),Is=ku.next();!Is.done;Is=ku.next())e3=Is.value,wx=g.Sy(e3.key).entityId,(v0=h.get(wx))&&e3&&(v0.cotn=e3.cotn);case 6:ls=[];ql=g.a(T);for(o5=ql.next();!o5.done;o5=ql.next())g0=o5.value,E6=g.Sy(g0.key).entityId,WG=tC(g0),E6!==n&&WG.rootActionId!==n||OC(X,g0.actionProto)||ls.push(g0.key);HG=g.uP(n,q);return g.l(DL,Z8(w,{mode:"readwrite",z9:!0},function(XY){var Tf=ls.map(function(p){return u6(XY,p)});
Tf.push(u6(XY,HG,{qn:!0}));return g.UY.all(Tf)}),9);
case 9:if(!U){DL.f5(0);break}M.reverse();if(!M.length){DL.f5(0);break}SB=g.a(M);wR=SB.next();case 12:if(wR.done){DL.f5(0);break}L=wR.value;El=g.Sy(L).entityId;if(!El){DL.f5(13);break}return g.l(DL,pn(El,w,X,P,h.get(El)),13);case 13:wR=SB.next(),DL.f5(12)}})},Ft=function(n,q,w){var X,P,R,c,k,r,e;
return g.b(function(f){if(f.X==1)return g.l(f,Z8(n,{mode:"readwrite",z9:!0},function(O){var H=YP(O,"transfer"),U=YP(O,"offlineOrchestrationActionWrapperEntity");return g.UY.all([H,U]).then(function(t){t=g.a(t);var V=t.next().value;var T=t.next().value;t=xLj.map(function(E){return HEv(O,E)});
T=g.a(T);for(var x=T.next();!x.done;x=T.next()){x=x.value;var M=g.Sy(x.actionProto.entityKey).entityType==="musicTrack",h=x.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";OC(q,x.actionProto)||M&&(!M||h)||t.push(u6(O,x.key,{qn:!0}))}return g.UY.all(t).then(function(){return V})})}),2);
X=f.N;P=g.a(X);for(R=P.next();!R.done;R=P.next())c=R.value,io(c),k=g.Sy(c.key).entityId,r={videoId:k,offlineDeleteReason:void 0,cotn:c.cotn},IH(r),e=g.uP(k,"musicTrack"),RH(w,{entityKey:e,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.l(f,HLt(),0)})},DLf=function(n){for(var q,w=g.a(n.additionalMetadatas),X=w.next();!X.done;X=w.next())X=X.value,X.offlineMusicVideoData&&(q=X.offlineMusicVideoData);
var P,R,c,k,r;return{id:g.uP(n.videoId,"musicTrack"),videoId:n.videoId,title:n.title,thumbnailDetails:n.thumbnail,lengthMs:String(Number(n.lengthSeconds)*1E3),albumTitle:(P=q)==null?void 0:P.releaseTitle,musicVideoType:(R=q)==null?void 0:R.musicVideoType,contentRating:{explicitType:(c=q)==null?void 0:c.explicitType},artistNames:((k=q)==null?void 0:k.byline)||((r=q)==null?void 0:r.channelName),downloadMetadata:g.uP(n.videoId,"musicTrackDownloadMetadataEntity")}},Mm5=function(n,q,w){var X,P,R,c,k,r,
e,f,O,H,U,t,V,T,x,M,h,E;
return g.b(function(S){X=[];P=new Set;if((R=w)==null?0:(c=R.downloadedTracks)==null?0:c.length)for(k=g.a(w.downloadedTracks),r=k.next();!r.done;r=k.next())e=r.value,P.add(e);if(n.tracks){f=g.a(n.tracks);for(O=f.next();!O.done;O=f.next())H=O.value,P.has(H)||X.push(H);U=g.a(q);for(t=U.next();!t.done;t=U.next())if(V=t.value,V.id!==n.id&&(T=V.tracks))for(x=g.a(T),M=x.next();!M.done;M=x.next())h=M.value,E=X.indexOf(h),E!==-1&&X.splice(E,1)}return S.return(X)})},Lyw=function(n,q){var w,X,P,R,c,k,r,e;
return g.b(function(f){w=Hd(n.thumbnailDetails);X=g.a(q);for(P=X.next();!P.done;P=X.next())if(R=P.value,R.id!==n.id)for(c=g.a(Hd(R.thumbnailDetails)),k=c.next();!k.done;k=c.next())r=k.value,e=w.indexOf(r),e!==-1&&w.splice(e,1);return f.return(w)})},h8G=function(n,q){var w,X,P,R,c,k,r,e,f;
return g.b(function(O){if(O.X==1)return w=g.uP("music_downloads_library_id","musicDownloadsLibraryEntity"),g.l(O,z8(n,w,"musicDownloadsLibraryEntity"),2);(X=O.N)||(X={id:w});P=g.Sy(q).entityType;P==="musicTrack"?(R=X.downloadedTracks)!=null&&R.includes(q)||(X.downloadedTracks=((c=X.downloadedTracks)!=null?c:[]).concat(q)):P==="musicPlaylist"?(k=X.downloadedPlaylists)!=null&&k.includes(q)||(X.downloadedPlaylists=((r=X.downloadedPlaylists)!=null?r:[]).concat(q)):P!=="musicAlbumRelease"||(e=X.downloadedAlbumReleases)!=
null&&e.includes(q)||(X.downloadedAlbumReleases=((f=X.downloadedAlbumReleases)!=null?f:[]).concat(q));return g.l(O,Jp(n,X,"musicDownloadsLibraryEntity"),0)})},lJi=function(n,q){var w,X,P,R,c,k,r;
return g.b(function(e){if(e.X==1)return w=g.uP("music_downloads_library_id","musicDownloadsLibraryEntity"),g.l(e,z8(n,w,"musicDownloadsLibraryEntity"),2);X=e.N;if(!X)return e.f5(0);P=g.Sy(q).entityType;P==="musicTrack"?R=X.downloadedTracks:P==="musicPlaylist"&&(R=X.downloadedPlaylists);if((c=R)==null?0:c.length)for(k=0;k<R.length;k++)if(r=R[k],r===q){R.splice(k,1);break}return g.l(e,Jp(n,X,"musicDownloadsLibraryEntity"),0)})},GuG=function(n){var q=n.videos;
n=[];var w=[];if(q){q=g.a(q);for(var X=q.next();!X.done;X=q.next()){var P=X.value.offlineVideoData.videoId;X=g.uP(P,"musicTrack");P=g.uP(P,"musicTrackDownloadMetadataEntity");n.push(X);w.push(P)}}return{bl:n,S1:w}},$7=function(n,q,w){q={track:DLf(q)};
w&&(q.playlistId=w);if(n=g.u(n.actionMetadata,Ctv))q.maximumDownloadQuality=n.maximumDownloadQuality;return{musicTrackEntityActionMetadata:q}},oDf=function(n){var q,w,X,P,R,c,k,r;
return g.b(function(e){switch(e.X){case 1:return q=g.AZ(),w=CHh(n),X=g.QO(EDv),g.Vy(e,2),R={z7:!0},g.l(e,g.Lk(q,w,X,void 0,R),4);case 4:P=e.N;g.FY(e,3);break;case 2:c=g.$u(e);if(c instanceof g.E2)throw k="GetOffline network manager error: "+c.message,Xt(k,c),Error(k);Xt("GetOffline fetch request error",c);throw Error("GetOffline fetch request error");case 3:r=vd(P);if(!P)throw Xt("Network request failed"),Error("Network request failed");if(r!==void 0)Ln(r);else if(!P.videos||!P.videos.length)throw Xt("No data"),
Error("No data");return e.return(P.videos.map(function(f){return f.offlineVideoData}))}})},bLD=function(n){var q,w,X,P,R,c,k,r;
return g.b(function(e){switch(e.X){case 1:return q=g.AZ(),w=EpG(n),X=g.QO(EDv),g.Vy(e,2),R={z7:!0},g.l(e,g.Lk(q,w,X,void 0,R),4);case 4:P=e.N;g.FY(e,3);break;case 2:c=g.$u(e);if(c instanceof g.E2)throw k="GetOffline network manager error for playlist: "+c.message,Xt(k,c),Error(k);Xt("GetOffline fetch request error for playlist",c);throw Error("GetOffline fetch request error for playlist");case 3:r=vd(P);if(!P)throw Xt("Network request failed for playlist"),Error("Network request failed for playlist");
if(r!==void 0)Ln(r,"playlist");else if(!P.playlists||!P.playlists.length)throw Xt("No data for playlist"),Error("No data for playlist");return e.return(P.playlists.map(function(f){return f.offlinePlaylistData}))}})},Ygv=function(n,q,w,X){var P,R,c,k,r,e,f,O,H,U,t,V,T,x,M,h,E,S,nO,J,c0,ku,Is,e3,wx,v0,ls,ql,o5,g0;
return g.b(function(E6){switch(E6.X){case 1:return g.l(E6,Nz(),2);case 2:P=E6.N;if(!P)return E6.return([]);R=[];if((c=X)==null?0:c.length){R=X;E6.f5(3);break}return g.l(E6,Wi(P,"mainPlaylistEntity"),4);case 4:R=E6.N;case 3:if(!R.length)return E6.return([]);k=[];r=Date.now()/1E3;e=g.a(R);f=e.next();case 5:if(f.done)return k.length?g.l(E6,AsB(k),10):E6.return([]);O=f.value;if(!O.downloadState){H=void 0;E6.f5(8);break}return g.l(E6,z8(P,O.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:H=
E6.N;case 8:U=H;t=void 0;T=(V=(t=O)==null?void 0:t.entityMetadata)&&V.nextAutoRefreshIntervalSeconds?Number(V.nextAutoRefreshIntervalSeconds):NaN;x=Number.isNaN(T)?n:T;h=M=void 0;E=((M=U)==null?0:M.lastSyncedTimestampMillis)?Number((h=U)==null?void 0:h.lastSyncedTimestampMillis)/1E3:0;nO=S=void 0;J=((S=U)==null?0:S.addedTimestampMillis)?Number((nO=U)==null?void 0:nO.addedTimestampMillis)/1E3:0;if(w||!V||E+x<=r){c0=[];ku=void 0;if((ku=O.videos)==null?0:ku.length)for(Is=g.a(O.videos),e3=Is.next();!e3.done;e3=
Is.next())wx=e3.value,v0=JSON.parse(g.Sy(wx).entityId),v0.videoId&&c0.push(v0.videoId);ls="0";V&&(ql=void 0,ls=String(Number((ql=V.offlineLastModifiedTimestampSeconds)!=null?ql:0).toFixed()));o5={playlistId:O.playlistId,videoIds:c0,offlineLastModifiedTimestamp:ls,autoSync:q,offlineDateAddedTimestamp:String(J.toFixed())};k.push(o5)}f=e.next();E6.f5(5);break;case 10:return g0=E6.N,E6.return(g0)}})},Ky0=function(){var n,q,w,X,P;
return g.b(function(R){if(R.X==1)return g.l(R,Nz(),2);if(R.X!=3)return(n=R.N)?g.l(R,Wi(n,"refresh"),3):R.return(!1);q=R.N;if((w=q[0])==null||!w.refreshTime)return R.return(!1);X=Number(q[0].refreshTime);P=Date.now()/1E3;return R.return(isFinite(X)&&P>=X)})},uDz=function(n,q){var w,X,P;
return g.b(function(R){switch(R.X){case 1:return g.Vy(R,2),g.l(R,Sgi(n,q),4);case 4:return X=R.N,g.l(R,aJt(X),5);case 5:w=pRj(X);g.FY(R,3);break;case 2:P=g.$u(R),Xt("getAndProcessSmartDownloadsResponse request or processing error",P);case 3:return R.return(w)}})},B7f=function(n,q,w,X){var P,R,c,k,r,e,f,O,H,U,t,V,T,x,M,h,E,S,nO,J,c0,ku,Is,e3,wx,v0,ls,ql,o5,g0;
return g.b(function(E6){switch(E6.X){case 1:return g.l(E6,Nz(),2);case 2:P=E6.N;if(!P)return E6.return([]);R=[];if((c=X)==null?0:c.length){R=X;E6.f5(3);break}return g.l(E6,Wi(P,"musicPlaylist"),4);case 4:R=E6.N;case 3:if(!R.length)return E6.return([]);k=[];r=Date.now()/1E3;e=g.a(R);f=e.next();case 5:if(f.done)return k.length?g.l(E6,AsB(k),10):E6.return([]);O=f.value;H=void 0;t=(U=(H=O)==null?void 0:H.entityMetadata)&&U.nextAutoRefreshIntervalSeconds?Number(U.nextAutoRefreshIntervalSeconds):NaN;V=
Number.isNaN(t)?n:t;x=T=0;M="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!O.downloadMetadata){E6.f5(8);break}return g.l(E6,z8(P,O.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:h=E6.N,S=E=void 0,T=Number((S=(E=h)==null?void 0:E.addedTimestampMillis)!=null?S:"0")/1E3,J=nO=void 0,x=Number((J=(nO=h)==null?void 0:nO.lastModifiedTimestampMillis)!=null?J:"0")/1E3,ku=c0=void 0,M=(ku=(c0=h)==null?void 0:c0.syncState)!=null?ku:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:Is=void 0;if(w||M!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!U||Number((Is=U.lastSyncedTimestampSeconds)!=null?Is:0)+V<=r){e3=[];wx=void 0;if((wx=O.tracks)==null?0:wx.length)for(v0=g.a(O.tracks),ls=v0.next();!ls.done;ls=v0.next())ql=ls.value,e3.push(g.Sy(ql).entityId);o5={playlistId:O.playlistId,videoIds:e3,offlineLastModifiedTimestamp:String(x.toFixed()),autoSync:q,offlineDateAddedTimestamp:String(T.toFixed())};k.push(o5)}f=e.next();E6.f5(5);break;case 10:return g0=E6.N,E6.return(g0)}})},Sgi=function(n,q){var w,X,P,R,c,k,r,e,f,O;
return g.b(function(H){switch(H.X){case 1:return w=g.AZ(),g.l(H,Nz(),2);case 2:X=H.N;if(!X){H.f5(3);break}return g.l(H,ue5(X),4);case 4:P=H.N;case 3:var U=P;R={context:g.S6(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:n},offlineClientState:U,clientStateRequestData:{preferredFormatType:q}}}};c=g.QO(Q2w);g.Vy(H,5);r={z7:!0};return g.l(H,g.Lk(w,R,c,void 0,r),7);case 7:k=H.N;g.FY(H,6);break;case 5:e=g.$u(H);if(e instanceof g.E2)throw f=
"DPS network manager error for smart downloads: "+e.message,Xt(f,e),Error(f);Xt("DPS fetch request error for smart downloads",e);throw Error("DPS fetch request error for smart downloads");case 6:O=vd(k);if(k)O!==void 0&&Ln(O,"smart downloads");else throw Xt("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return H.return(k)}})},Jsv=function(n,q){var w,X,P,R,c,k,r,e;
return g.b(function(f){switch(f.X){case 1:return w=g.AZ(),X={context:g.S6(),videoPlaybackPositionEntities:n,lastSyncTimestampUsec:q},P=g.QO(ZL0),g.Vy(f,2),c={z7:!0},g.l(f,g.Lk(w,X,P,void 0,c),4);case 4:R=f.N;g.FY(f,3);break;case 2:k=g.$u(f);if(k instanceof g.E2)throw r="VPPS network manager error: "+k.message,Xt(r,k),Error(r);Xt("VPPS fetch request error",k);throw Error("VPPS fetch request error");case 3:e=vd(R);if(R)e!==void 0&&Ln(e,"position sync");else throw Xt("Network request failed for position sync"),
Error("Network request failed for position sync");return f.return(R)}})},Wyv=function(n,q,w){var X,P,R,c,k,r,e,f;
return g.b(function(O){switch(O.X){case 1:X=g.AZ();var H=w.refreshData,U=w.isEnqueuedForExpiredStreamUrlRefetch,t=w.u_,V=w.offlineSourceData,T=w.mediaCapabilities,x={entityKey:n};H&&(x.refreshData=H);U&&(x.isExpiredStreamUrlRefetch=U);t&&(x.downloadParameters=t);V&&(x.offlineSourceData=V);H={context:g.dw(q),signatureTimestamp:20279,videos:[x]};T&&(H.mediaCapabilities=T);P=H;R=g.QO(z8i);g.Vy(O,2);k={z7:!0};return g.l(O,g.Lk(X,P,R,void 0,k),4);case 4:c=O.N;g.FY(O,3);break;case 2:r=g.$u(O);if(r instanceof
g.E2)throw e="GetPDE network manager error: "+r.message,Xt(e,r),Error(e);Xt("GetPDE fetch request error",r);throw Error("GetPDE fetch request error");case 3:f=vd(c);if(c)f!==void 0&&Ln(f,"PDE");else throw Xt("Network request failed for PDE"),Error("Network request failed for PDE");return O.return(c)}})},vd=function(n){var q;
return(q=n.errorMetadata)==null?void 0:q.status},Ln=function(n,q){q=q?" for "+q:"";
if(n===0)throw n="Empty response body"+q,Xt(n),Error(n);n="Response with error"+q;Xt(n);throw Error(n);},AsB=function(n){var q,w,X,P,R,c,k,r;
return g.b(function(e){switch(e.X){case 1:return q=g.AZ(),w=opB(n),X=g.QO(N7D),g.Vy(e,2),R={z7:!0},g.l(e,g.Lk(q,w,X,void 0,R),4);case 4:P=e.N;g.FY(e,3);break;case 2:c=g.$u(e);if(c instanceof g.E2)throw k="offlinePlaylistSyncCheck network manager error: "+c.message,Xt(k,c),Error(k);Xt("offlinePlaylistSyncCheck fetch request error",c);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:r=vd(P);if(!P)throw Xt("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(r!==void 0)Ln(r,"playlist sync");else if(!P.offlinePlaylistSyncCheckDatas||!P.offlinePlaylistSyncCheckDatas.length)throw Xt("No data for playlist sync"),Error("No data for playlist sync");return e.return(P.offlinePlaylistSyncCheckDatas.map(function(f){return f.offlinePlaylistSyncCheckData}))}})},MS=function(n){this.N=n},nFD=function(n,q){var w,X,P,R,c,k;
return g.b(function(r){switch(r.X){case 1:w=new Map,X=g.a(q),P=X.next();case 2:if(P.done){r.f5(4);break}R=P.value;c=w;k=c.set;return g.l(r,n.X(R),5);case 5:k.call(c,R,r.N);P=X.next();r.f5(2);break;case 4:return r.return(w)}})},x7=function(n,q,w,X,P,R){q=g.uP(q,w);
X=Object.assign({},R,{priority:X,retryScheduleIntervalsInSeconds:P});return{actionType:n,entityKey:q,actionMetadata:X}},Dl=function(n,q,w,X,P,R){this.status=n;
this.N=q;this.W=w;this.X=X;this.C=P;this.downloadState=R},qfD=function(n,q,w){this.N=n;
this.NP=q;this.C=w},PFh=function(n,q){var w,X,P,R,c,k,r,e,f;
return g.b(function(O){switch(O.X){case 1:return w=q.entityKey,P=(X=g.u(q.actionMetadata,hC))==null?void 0:X.isEnqueuedForExpiredStreamUrlRefetch,g.Vy(O,2),R=void 0,g.l(O,wtf(n,q),4);case 4:R=O.N;g.Vy(O,5);var H=(H=g.u(q.actionMetadata,hC))?{maximumDownloadQuality:H.maximumDownloadQuality}:void 0;return g.l(O,Wyv(w,n.NP,{isEnqueuedForExpiredStreamUrlRefetch:P,u_:H,offlineSourceData:R}),7);case 7:c=O.N;g.FY(O,6,2);break;case 5:return g.$u(O,2),k=rJ(q)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Xt("PDE handleAdd error"),O.return(lo(q,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",k,"DOWNLOAD_STATE_FAILED"));case 6:return g.l(O,XtB(n,c,q),8);case 8:return O.return(lo(q,!0,c.orchestrationActions));case 2:return r=g.$u(O),e="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",r instanceof g.jI&&r.type==="QUOTA_EXCEEDED"&&(e="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
f="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Xt("PDE handleAdd error"),O.return(lo(q,!1,void 0,e,f,"DOWNLOAD_STATE_FAILED"))}})},IKi=function(n,q){var w,X,P,R,c,k,r,e,f,O,H,U,t,V,T,x,M,h,E,S,nO,J,c0,ku;
return g.b(function(Is){switch(Is.X){case 1:return w=q.entityKey,X=g.Sy(w).entityId,g.l(Is,Z8(n.N,{mode:"readonly",z9:!0},function(e3){var wx=Ap(e3,w,"playbackData"),v0=Ap(e3,g.uP(X,"offlineVideoPolicy"),"offlineVideoPolicy");e3=Ap(e3,g.uP(X,"transfer"),"transfer");return g.UY.all([wx,v0,e3])}),2);
case 2:P=Is.N;R=g.a(P);c=R.next().value;k=R.next().value;r=R.next().value;e=c;f=k;O=r;if(!e||!f)return Is.return(lo(q,!0));H=[];V=((t=e)==null?0:t.playerResponseJson)?JSON.parse(e.playerResponseJson):null;if(!(O&&V&&n.NP.Z("html5_refresh_deprecated_downloads"))){Is.f5(3);break}U=RkG(n,V,O);return g.l(Is,cdz(n,O),4);case 4:H=Is.N;case 3:T={lastPlayerResponseTimestampSeconds:e.playerResponseTimestamp,offlineToken:f.offlineToken,formatIds:H};x={};if((M=O)==null?0:M.maximumDownloadQuality)x.maximumDownloadQuality=
O.maximumDownloadQuality;g.Vy(Is,5);h=void 0;return g.l(Is,wtf(n,q),7);case 7:return h=Is.N,g.Vy(Is,8),g.l(Is,Wyv(w,n.NP,{refreshData:T,u_:x,offlineSourceData:h,mediaCapabilities:U}),10);case 10:E=Is.N;g.FY(Is,9,5);break;case 8:return g.$u(Is,5),S=rJ(q)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",Xt("PDE handleRefresh error"),Is.return(lo(q,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",S,
"DOWNLOAD_STATE_FAILED"));case 9:return g.l(Is,XtB(n,E,q),11);case 11:return Is.return(lo(q,!0,E.orchestrationActions));case 5:return nO=g.$u(Is),J="PDE handleRefresh error",nO instanceof Error&&(J="PDE handleRefresh error: "+nO.message),c0="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",ku="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",nO instanceof g.jI&&nO.type==="QUOTA_EXCEEDED"&&(c0="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",ku="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Xt(J),Is.return(lo(q,!1,void 0,c0,ku,"DOWNLOAD_STATE_FAILED"))}})},wtf=function(n,q){var w,X,P,R;
return g.b(function(c){if(c.X==1)return w=g.Sy(q.entityKey).entityId,X=g.uP(w,"videoDownloadContextEntity"),g.l(c,z8(n.N,X,"videoDownloadContextEntity"),2);P=c.N;return(R=P)!=null&&R.offlineModeType?c.return({offlineModeType:P.offlineModeType}):c.return(void 0)})},XtB=function(n,q,w){var X,P,R,c,k;
return g.b(function(r){if(r.X==1){if(!q.frameworkUpdates||!g.u(q.frameworkUpdates,aH))return r.return();if(!(g.u(q.frameworkUpdates,aH).mutations&&g.u(q.frameworkUpdates,aH).mutations.length>0&&g.u(q.frameworkUpdates,aH).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return r.f5(2);X=g.Sy(g.u(q.frameworkUpdates,aH).mutations[0].entityKey).entityId;return g.l(r,VV(n.N,X),3)}if(r.X!=2){P=r.N;R=g.u(w.actionMetadata,hC);if(k=(c=R)==null?void 0:c.playlistId)P.playlistId=k;P.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.iE(n.NP)?g.l(r,yV(X,n.N,w,n.C,P),2):g.LX(n.NP)?g.l(r,pn(X,n.N,w,n.C),2):r.f5(2)}return g.l(r,vpv(g.u(q.frameworkUpdates,aH)),0)})},lo=function(n,q,w,X,P,R){return new Dl(q?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",rJ(n),w,X,P,R)},RkG=function(n,q,w){q=OLj(n.NP,w.cotn,q);
w=g.$I(q);return g.izz(q,w,n.NP)},cdz=function(n,q){var w,X,P,R,c,k,r,e,f,O,H;
return g.b(function(U){if(U.X==1)return w=[],g.l(U,Z8(n.N,{mode:"readonly",z9:!0},function(t){var V=[],T=q.offlineVideoStreams;if(T){T=g.a(T);for(var x=T.next();!x.done;x=T.next())V.push(Ap(t,x.value,"offlineVideoStreams"))}return g.UY.all(V)}),2);
if(X=U.N)for(P=g.a(X),R=P.next();!R.done;R=P.next())if(c=R.value,k=void 0,(k=c)==null?0:k.streamsProgress)for(r=c.streamsProgress,e=0;e<r.length;e++)f=r[e],O=JSON.parse(f.formatStreamBytes),H={itag:O.itag,lmt:O.lastModified,xtags:O.xtags},w.push(H);return U.return(w)})},kKz=function(n,q){this.N=n;
this.NP=q},rd0=function(n,q){var w,X,P,R,c,k,r,e,f,O,H,U;
return g.b(function(t){switch(t.X){case 1:return w=rJ(q),g.l(t,Wi(n.N,"videoPlaybackPositionEntity"),2);case 2:X=t.N;if(X.length===0)return t.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));g.Vy(t,3);return g.l(t,E1.getInstance(),5);case 5:P=t.N;if(!P)throw Error("prefStorage is undefined");return g.l(t,P.get("psi"),6);case 6:return R=t.N,r=(k=(c=R)==null?void 0:c.xK)!=null?k:"0",g.l(t,Jsv(X,r),7);case 7:return e=t.N,f={isPaused:e.watchHistoryPaused,xK:e.syncTimestampUsec},g.l(t,P.set("psi",
f),8);case 8:if(f.isPaused){t.f5(9);break}O=g.u(e.frameworkUpdates,aH);if(!e.frameworkUpdates||!O){t.f5(9);break}return g.l(t,vpv(O),9);case 9:g.FY(t,4);break;case 3:return H=g.$u(t),U="PPE handleRefresh error: "+(H instanceof Error?H.message:"unknown error"),Xt(U),t.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return t.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
w))}})},sWf=function(n,q){var w,X,P,R,c,k,r,e;
return g.b(function(f){switch(f.X){case 1:return w=rJ(q),X=g.Sy(q.entityKey).entityId,g.Vy(f,2),g.l(f,E1.getInstance(),4);case 4:P=f.N;if(!P)throw Error("prefStorage is undefined");return g.l(f,P.get("psi"),5);case 5:R=f.N;c=g.u(q.actionMetadata,jWD);if(((k=R)==null?void 0:k.isPaused)!==!1||(r=c)==null||!r.lastPlaybackPositionSeconds){f.f5(6);break}e={key:g.uP(X,"videoPlaybackPositionEntity"),videoId:X,lastPlaybackPositionSeconds:c.lastPlaybackPositionSeconds};return g.l(f,Jp(n.N,e,"videoPlaybackPositionEntity"),
6);case 6:g.FY(f,3);break;case 2:return g.$u(f),f.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return f.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w))}})},ekj=function(n,q){var w,X,P;
return g.b(function(R){switch(R.X){case 1:w=rJ(q);g.Vy(R,2);X=g.Sy(q.entityKey).entityId;if(X==="!*$_ALL_ENTITIES_!*$")return g.l(R,VXi(n.N),5);P=g.uP(X,"videoPlaybackPositionEntity");return g.l(R,aPw(n.N,P),5);case 5:g.FY(R,3);break;case 2:return g.$u(R),R.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return R.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
w))}})},fKl=function(n,q){this.api=n;
this.N=q;this.logger=new g.il("woffle");this.X=!1;this.Wb={OY:this.OY};this.logger.debug("Initialized OfflineMediaManager")},O9v=function(n){return g.b(function(q){return q.return(GHj(n))})},i9z=function(n){var q;
return g.b(function(w){if(w.X==1)return g.l(w,g.K4O(n),2);q=w.N;return w.return(q.filter(function(X){return!!X.url}).map(function(X){return X.url}))})},GA=function(n,q){var w=g.JK(q);
if(w===1||w===0)return Promise.resolve();(w=H95(n,q))&&w.stopVideo();n.C=0;return O9v(q)},Cn=function(n,q,w,X){w=w===void 0?!1:w;
X=X===void 0?!0:X;var P=typeof q==="string"?q:q.videoDetails.videoId;g.JK(P)===2&&((q=H95(n,P))?q.stopVideo():n.logger.info(function(){return"Corresponding player for "+P+" not found. Pausing anyway"}),g.zB(P,2),n.C=2,w?U4z(n.N):X&&tqj(n.N))},H95=function(n,q){var w;
return((w=n.player)==null?void 0:w.getVideoData().videoId)===q?n.player:null},d4h=function(n,q,w){q.getPlayerResponse();
g.zB(q.videoId,2);n.C=2;n.X=!1;var X;(X=n.player)==null||X.dispose();n.player=n.api.jy(q);q={};n.player.yd((q.localmediachange=n.j0,q.signatureexpired=n.b$,q.statechange=n.Veq,q),n);var P=n.OY(w);n.player.Ux(g.gn(P,P,!0,"m"),!1);n.logger.debug(function(){return"Starting headless playback with quality: "+P});
n.player.K8(!1)},gFL=function(n,q){this.N=n;
this.NP=q},ydf=function(n,q){var w,X;
return g.b(function(P){switch(P.X){case 1:return w=rJ(q),g.l(P,z8(n.N,q.entityKey,"transfer"),2);case 2:if(X=P.N)return P.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));g.Vy(P,3);return g.l(P,m4G(n,q),5);case 5:g.FY(P,4);break;case 3:return g.$u(P),P.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return P.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
w))}})},aKB=function(n,q){var w,X;
return g.b(function(P){switch(P.X){case 1:return w=rJ(q),g.l(P,z8(n.N,q.entityKey,"transfer"),2);case 2:X=P.N;if(!X||X.transferState!=="TRANSFER_STATE_COMPLETE")return P.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));g.Vy(P,3);return g.l(P,m4G(n,q,!0),5);case 5:g.FY(P,4);break;case 3:return g.$u(P),P.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return P.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w))}})},VqG=function(n,q){var w,X,P,R,c,k,r,e,f,O;
return g.b(function(H){switch(H.X){case 1:return w=rJ(q),X=g.Sy(q.entityKey).entityId,g.l(H,Z8(n.N,{mode:"readonly",z9:!0},function(U){var t=Ap(U,q.entityKey,"transfer");U=Ap(U,g.uP(X,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.UY.all([t,U])}),2);
case 2:P=H.N;R=g.a(P);c=R.next().value;k=R.next().value;r=c;e=k;if(!r||r.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return H.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));g.Vy(H,3);r.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.l(H,Jp(n.N,r,"transfer"),5);case 5:f=g.Sy(r.key).entityId;kuz({videoId:f,Lq:r,offlineModeType:(O=e)==null?void 0:O.offlineModeType});g.FY(H,4);break;case 3:return g.$u(H),H.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return H.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w))}})},m4G=function(n,q,w){w=w===void 0?!1:w;
var X,P,R,c,k,r,e,f,O,H,U,t,V,T,x;return g.b(function(M){switch(M.X){case 1:return X=g.u(q.actionMetadata,pti),P=g.Sy(q.entityKey).entityId,R=g.uP(P,"downloadStatusEntity"),g.l(M,Z8(n.N,{mode:"readonly",z9:!0},function(h){var E=Ap(h,R,"downloadStatusEntity");h=Ap(h,g.uP(P,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.UY.all([E,h])}),2);
case 2:return c=M.N,k=g.a(c),r=k.next().value,e=k.next().value,f=r,O=e,H="TRANSFER_STATE_TRANSFER_IN_QUEUE",((U=f)==null?void 0:U.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(H="TRANSFER_STATE_PAUSED_BY_USER"),T={key:q.entityKey,transferState:H,cotn:g.Os(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(t=X)==null?void 0:t.maximumDownloadQuality,preferredAudioTrack:(V=X)==null?void 0:V.preferredAudioTrack,transferRetryCount:0,isRefresh:w,hasLoggedFirstStarted:!1},g.l(M,Z8(n.N,
{mode:"readwrite",z9:!0},function(h){var E=[];w&&E.push(u6(h,g.uP(P,"offlineVideoStreams")));E.push(S1(h,T,"transfer"));return g.UY.all(E)}),3);
case 3:if(!w){M.f5(4);break}return g.l(M,O9v(P),4);case 4:cs0({videoId:P,Lq:T,offlineModeType:(x=O)==null?void 0:x.offlineModeType}),g.yy(M)}})},F7l=function(n,q,w,X){if(!n.action.entityKey)throw Error("entityKey is missing.");
var P=g.Sy(n.action.entityKey);P={entityType:P.ma,entityId:P.entityId,offlineOrchestrationActionType:n.action.actionType,orchestrationAction:{orchestrationActionId:n.actionId}};q&&(P.offlineOrchestrationActionResult=q.status,P.isRetryable=w?!1:q.N,q.C&&(P.offlineOrchestrationFailureReason=Tii(q.C,P.isRetryable)));var R,c;if((R=n.action.actionMetadata)==null?0:(c=R.offlineLoggingData)==null?0:c.offlineModeType)P.offlineModeType=n.action.actionMetadata.offlineLoggingData.offlineModeType;X&&(P.additionalOrchestrationActions=
X.map(function(k){return{orchestrationActionId:k.actionId}}));
return P},Tii=function(n,q){return n!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||q?n==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&q?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":n:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},$4l=function(n,q){var w={offlineOrchestrationContext:F7l(n)};
q=KAl(q,w);SzG(Yzl(),q,n.rootActionId)},vFG=function(n,q,w,X){X=X===void 0?[]:X;
q={offlineOrchestrationContext:F7l(n,q,w,X)};q=KAl(3,q);SzG(Yzl(),q,n.rootActionId)},L7w=function(){this.actions=[]},MqG=function(n,q){q=g.a(q);
for(var w=q.next();!w.done;w=q.next())w=w.value,$4l(w,1),n.actions.push(w);n.actions.sort(n.N)},x4v=function(n,q){if(q)for(var w=0;w<n.actions.length;w++)if(q==="!*$_ALL_ENTITIES_!*$"&&n.actions[w].actionId!==q||q!=="!*$_ALL_ENTITIES_!*$"&&n.actions[w].rootActionId===q&&n.actions[w].actionId!==q)n.actions.splice(w,1),w--},D4w=function(n,q){n=g.a(n.actions);
for(var w=n.next();!w.done;w=n.next())if(w.value.actionId===q)return!0;return!1},EC=function(n,q,w,X,P){g.A.call(this);
var R=this;this.X=n;this.vW=q;this.qP=w;this.G=X;this.NP=P;this.N=new L7w;this.D=new g.CH;this.C=new g.YF(function(){R.retry()});
this.V=NaN;this.K=!1;this.Wb={yTh:function(){return R.N},
SI:function(){return R.D},
Pzi:function(){return R.C},
retry:function(){return R.retry()}};
g.K(this,this.C);this.L=this.X.observe(this.PW.bind(this))},GKj=function(n,q,w,X,P){var R;
return g.b(function(c){if(c.X==1)return R=new EC(n,q,w,X,P),g.l(c,hki(R),2);lK0(R);return c.return(R)})},lK0=function(n){var q=n.N.actions[0];
return n.W?((q==null?void 0:q.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&n.W[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(n.K=!0),Promise.resolve()):CFG(n)},CFG=function(n){var q,w,X,P,R,c,k,r,e,f,O,H,U,t,V,T,x;
return g.b(function(M){switch(M.X){case 1:if(n.W)throw Error("Already processing an action");if(n.zp())return M.return();q=n.N.actions.shift();PtD(n.qP,!q);if(q===void 0)return M.return();q.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&q.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&x4v(n.N,q.actionId);w="";q.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&q.rootActionId===q.actionId&&(w=q.actionId);X=[q];n.W=X;if(P=n.vW[q.entityType]){M.f5(2);break}n.W=
void 0;return g.l(M,CFG(n),3);case 3:return M.return();case 2:R=g.a(X);for(c=R.next();!c.done;c=R.next())k=c.value,$4l(k,2);g.Vy(M,4,5);return g.l(M,nFD(P,X.map(function(h){return h.action})),7);
case 7:r=M.N,e=g.a(X),f=e.next();case 8:if(f.done){M.f5(10);break}O=f.value;H=r.get(O.action);return g.l(M,EFf(n,O,H),9);case 9:f=e.next();M.f5(8);break;case 10:x4v(n.N,w);case 5:g.Dm(M);n.W=void 0;g.hO(M,6);break;case 4:return U=g.$u(M),Xt("Orchestration error",U),g.Vy(M,12),g.l(M,oFG(n,X),14);case 14:g.FY(M,5);break;case 12:t=g.$u(M);Xt("Orchestration retry error",t);V=g.a(X);for(T=V.next();!T.done;T=V.next())x=T.value,x.retryScheduleIndex<3&&MqG(n.N,[x]);M.f5(5);break;case 6:return g.l(M,CFG(n),
0)}})},EFf=function(n,q,w){var X,P,R,c,k,r,e,f,O,H,U,t;
return g.b(function(V){switch(V.X){case 1:X=q.retryScheduleIndex+2===3;if(w.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){V.f5(2);break}if(w.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){V.f5(0);break}vFG(q,w,X);if(w.N&&q.retryScheduleIndex+1<3)return g.l(V,oFG(n,[q]),0);R=((P=w)==null?0:P.X)?w.X:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";c={entityKey:q.action.entityKey,failureReason:R};k=void 0;g.iE(n.NP)?k="mainVideoDownloadStateEntity":g.LX(n.NP)&&(k="musicTrackDownloadMetadataEntity");
if(!k||!w.downloadState){V.f5(7);break}r=g.Sy(q.action.entityKey).entityId;return g.l(V,fn(r,k,n.X,w.downloadState),7);case 7:RH(n.G,c);if(w.downloadState==="DOWNLOAD_STATE_FAILED"&&n.NP.Z("html5_auto_retry_failed_pde_actions")){V.f5(0);break}Xt("Orchestration result is not retryable, deleting action");return g.l(V,aPw(n.X,dJ(q).key),0);case 2:e=void 0;try{e=(f=w.W)==null?void 0:f.map(function(T){return n.createAction(T,q)})}catch(T){return vFG(q,w,X),O={entityKey:q.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},RH(n.G,O),Xt("Orchestration subactions creation error",T),V.return()}vFG(q,w,X,e);if(!e){V.f5(12);break}H=e.map(function(T){return dJ(T)});
U=0;case 13:if(!(U<e.length)||n.K){V.f5(15);break}return g.l(V,Z8(n.X,{mode:"readwrite",z9:!0},function(T){var x=[];x.push(fPG(T,H.slice(U,U+10),"offlineOrchestrationActionWrapperEntity"));return g.UY.all(x)}),16);
case 16:U+=10;V.f5(13);break;case 15:if(n.K)return n.K=!1,V.return();case 12:return t=dJ(q),g.l(V,aPw(n.X,t.key),17);case 17:$4l(q,4),g.yy(V)}})},K7l=function(n,q){var w,X,P,R,c,k,r,e,f,O,H,U;
return g.b(function(t){w=[];X=Infinity;P=4E3;R=g.a(q);for(c=R.next();!c.done;c=R.next())k=c.value,r=Number(k.enqueueTimeSec),e=b9i(r),f=k.retryScheduleIndex,O=f!=null&&f>0,e>0&&O?(X=Math.min(X,r),P=Math.min(e,P)):w.push(k);isFinite(X)&&(!n.C.isActive()||X<n.V)&&(n.V=X,n.C.start(P));n.D.ML()||(H=w.length,w=w.filter(function(V){var T;V=((T=V.actionProto)==null?void 0:T.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!AdB.includes(V)}),U=w.length<H,!n.C.isActive()&&U&&n.C.start(1));
w.length>0&&Yfw(n,w);return g.l(t,lK0(n),0)})},u6D=function(n){var q,w,X,P,R,c,k;
return g.b(function(r){if(r.X==1)return g.l(r,Sfv(n),2);q=r.N;w=[];X=g.a(q);for(P=X.next();!P.done;P=X.next())R=P.value,c=g.Sy(R.key),k=c.entityId,D4w(n.N,k)||w.push(R);return g.l(r,K7l(n,w),0)})},b9i=function(n){n=n*1E3-Date.now();
return n>4E3?4E3:n},oFG=function(n,q){var w,X,P;
return g.b(function(R){w=g.a(q);for(X=w.next();!X.done;X=w.next()){P=X.value;var c=void 0,k=void 0,r=((k=P.action)==null?void 0:(c=k.actionMetadata)==null?void 0:c.retryScheduleIntervalsInSeconds)||[1,2,4];c=1;P.retryScheduleIndex<r.length&&(c=r[P.retryScheduleIndex]);P.N=c*1E3+Date.now();P.retryScheduleIndex++}return g.l(R,Bi0(n,q),0)})},hki=function(n){var q;
return g.b(function(w){if(w.X==1)return g.l(w,Wi(n.X,"offlineOrchestrationActionWrapperEntity"),2);q=w.N;return g.l(w,K7l(n,q),0)})},Yfw=function(n,q){q.length!==0&&q.forEach(function(w){w=tC(w);
w.retryScheduleIndex<3&&MqG(n.N,[w])})},Sfv=function(n,q){var w;
return g.b(function(X){if(X.X==1)return g.l(X,Wi(n.X,"offlineOrchestrationActionWrapperEntity",q),2);w=X.N;return X.return(w.filter(LAG))})},Bi0=function(n,q){if(q.length===0)return Promise.resolve([]);
q=q.map(function(w){return dJ(w)});
return yjv(n.X,q)},QWG=function(n){this.Oq=n;
this.N=void 0},Z9D=function(n,q){var w,X,P,R;
return g.b(function(c){w=q.videoId;X=!0;if(q.captionTracks.length)P=Iqv(q),n.N=new g.DD(n.Oq,q,P);else if(q.bx)R=g.nfs(q),n.N=new g.lh(n.Oq,q.bx,w,R,q.xd,q.eventId),X=q.xd;else return c.return();return c.return(new Promise(function(k){var r;(r=n.N)==null||r.C3({rp:function(){return g.b(function(e){if(e.X==1)return g.l(e,n.rp(w,X),2);k();g.yy(e)})},
lq:function(){}})}))})},Jdf=function(n){var q;
return g.b(function(w){if(w.X==1)return g.l(w,lP5(n),2);q=w.N;return w.return(!!q&&q.length>0)})},oH=function(n){g.A.call(this);
this.N=n;this.X=this.N.observe(this.C.bind(this))},zkB=function(n,q){var w,X,P,R,c,k,r;
return g.b(function(e){switch(e.X){case 1:if(q.length===0)return e.return([]);w=q.map(function(f){return g.uP(f,"transfer")});
return g.l(e,Wi(n.N,"transfer",w),2);case 2:X=e.N;P=X.filter(LAG).map(function(f){return g.Sy(f.key).entityId});
R=q.filter(function(f){return P.indexOf(f)===-1});
if(R.length===0)return e.return([]);c=g.a(R);k=c.next();case 3:if(k.done){e.f5(5);break}r=k.value;return g.l(e,O9v(r),4);case 4:k=c.next();e.f5(3);break;case 5:return e.return(R)}})},nHz=function(n,q,w,X,P,R){var c,k,r;
return g.b(function(e){c="STREAM_TYPE_UNKNOWN";w.video&&w.audio?(c="STREAM_TYPE_AUDIO_AND_VIDEO",Xt("unexpected stream type")):w.video&&!w.audio?c="STREAM_TYPE_VIDEO":!w.video&&w.audio&&(c="STREAM_TYPE_AUDIO");k=g.uP(q,"offlineVideoStreams");r={numBytesDownloaded:P.toFixed(),numTotalBytes:R.toFixed(),streamType:c,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(X),itag:c==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(w.itag):void 0};return g.l(e,Z8(n,{mode:"readwrite",z9:!0},
function(f){var O=Ap(f,k,"offlineVideoStreams"),H=Ap(f,g.uP(q,"transfer"),"transfer");return g.UY.all([O,H]).then(function(U){U=g.a(U);var t=U.next().value;U=U.next().value;if(!U)return u6(f,k).then(function(){});
var V=W7B(t);t=NiD(t,X,r,k);var T=S1(f,t,"offlineVideoStreams");W7B(t)>V&&(U.lastProgressTimeMs=Date.now().toString());V=[T];U.offlineVideoStreams||(U.offlineVideoStreams=[]);U.offlineVideoStreams.indexOf(k)===-1&&(U.offlineVideoStreams.push(k),V.push(S1(f,U,"transfer")));return g.UY.all(V)})}),0)})},qhD=function(n,q){var w,X,P,R,c;
return g.b(function(k){if(k.X==1)return w=g.uP(q,"offlineVideoStreams"),g.l(k,z8(n,w,"offlineVideoStreams"),2);X=k.N;if(!X||!X.streamsProgress)return k.return();P=g.a(X.streamsProgress);for(R=P.next();!R.done;R=P.next())c=R.value,c.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",c.numTotalBytes!==c.numBytesDownloaded&&(c.numBytesDownloaded=c.numTotalBytes);return g.l(k,Jp(n,X,"offlineVideoStreams"),0)})},NiD=function(n,q,w,X){if(n&&n.streamsProgress){X=n;
a:{q=q.itag+";"+q.xtags;for(var P=n.streamsProgress,R=0;R<P.length;R++){var c=JSON.parse(P[R].formatStreamBytes);if(c.itag+";"+c.xtags===q){P[R]=w;w=P;break a}}P.push(w);w=P}X.streamsProgress=w}else n={key:X,streamsProgress:[w]};return n},W7B=function(n){if(n==null?0:n.streamsProgress){var q=0;
n=n.streamsProgress;for(var w=0;w<n.length;w++){var X=n[w];isNaN(Number(X.numBytesDownloaded))?Xt("stream progress bytes number invalid"):q+=Number(X.numBytesDownloaded)}return q}return 0},wNi=function(n,q,w,X){g.A.call(this);
var P=this;this.X=n;this.api=q;this.Ff=w;this.PW=X;this.D=new g.CH;this.W=new g.YF(function(){P.N&&P.N.transferState==="TRANSFER_STATE_TRANSFERRING"&&P.D.ML()&&((P.N.transferRetryCount||0)<3?Cn(P.G,P.K,!1,!1):GA(P.G,P.K.videoDetails.videoId),P.YY("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.qP=this.HW=0;this.L=this.V=!1;this.IH=g.Jv(this.api.B().experiments,"html5_transfer_processing_logs_interval");this.D0=new g.Um(this);this.Wb={fHp:function(){return P.W},
V3T:function(){return P.PW},
SI:function(){return P.D}};
this.vW=this.X.observe(this.qm.bind(this));this.G=new fKl(q,this);this.oH=new QWG(q);this.WW=new oH(this.X);this.n5=this.D.listen("publicytnetworkstatus-online",this.K9.bind(this));this.Tp=this.D.listen("publicytnetworkstatus-offline",this.JzH.bind(this));this.L=this.api.B().Z("html5_less_transfer_processing_logs");g.K(this,this.D0);this.D0.j(q,"offlinetransferpause",this.tPe);if(g.iE(this.api.B()))this.C="mainVideoDownloadStateEntity";else if(g.LX(this.api.B())||g.UN(this.api.B()))this.C="musicTrackDownloadMetadataEntity"},
XNw=function(n){return g.b(function(q){if(q.X==1)q=g.l(q,DnG(),2);
else{var w=n.WW;var X=g.Zj();X=Object.keys(X);w=zkB(w,X);q=g.l(q,w,0)}return q})},AC=function(n,q){q=q===void 0?!1:q;
var w;return g.b(function(X){if(X.X==1){if(n.N)throw Error("Already downloading a video");n.qP=0;n.V=!1;return g.l(X,PUw(n),2)}return X.X!=4?(w=X.N,R85(n.Ff,!w),w&&n.D.ML()?q?g.l(X,new Promise(function(P){g.rN(P,1E3)}),4):X.f5(4):(!w&&n.N&&bo(n),X.f5(0))):g.l(X,RDv(n,w),0)})},coG=function(n){return g.b(function(q){if(q.X==1)return n.K?g.l(q,GA(n.G,n.K.videoDetails.videoId),3):q.f5(0);
bo(n);g.yy(q)})},IMi=function(n,q){var w,X,P;
return g.b(function(R){switch(R.X){case 1:return g.Vy(R,2),(w=!!q.captionTracks.length||!!q.bx)?g.l(R,Jdf(q.videoId),4):R.return();case 4:return(X=R.N)?R.return():g.l(R,Z9D(n.oH,q),5);case 5:g.FY(R,0);break;case 2:P=g.$u(R),Xt("Caption downloading error",P,q.cotn),g.yy(R)}})},RDv=function(n,q){var w,X,P,R,c,k;
return g.b(function(r){switch(r.X){case 1:if(n.V)return r.return();n.V=!0;n.N=q;w=g.Sy(n.N.key);X=w.entityId;P=void 0;if(n.N.transferState==="TRANSFER_STATE_TRANSFERRING")return g.l(r,Y7(n,X),7);if(n.N.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||n.N.transferRetryCount||n.N.hasLoggedFirstStarted){r.f5(3);break}return g.l(r,Y7(n,X),5);case 5:return P=r.N,n.N.hasLoggedFirstStarted=!0,g.l(r,klf(n),6);case 6:IJB({videoId:X,Lq:n.N,offlineModeType:P},void 0,void 0,!0);r.f5(3);break;case 7:P=r.N,
k7({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:X,Lq:n.N,offlineModeType:P});case 3:return g.l(r,ro0(n),8);case 8:return R=null,g.Vy(r,9),g.l(r,jUB(n,q),11);case 11:R=r.N;n.K=R;g.FY(r,10);break;case 9:return c=g.$u(r),Xt("error getting player response",c,q.cotn),g.l(r,n.YY("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return r.return();case 10:return k=OLj(n.api.B(),q.cotn,R),g.l(r,IMi(n,k),13);case 13:return g.l(r,i9z(k.videoId),
14);case 14:k.jK=r.N,d4h(n.G,k,q.maximumDownloadQuality),n.W.start(108E5),g.yy(r)}})},PUw=function(n){var q,w;
return g.b(function(X){if(X.X==1)return g.l(X,Wi(n.X,"transfer"),2);q=X.N;w=q.filter(sUD).sort(eDf);return w.length===0?X.return():X.return(w[0])})},ro0=function(n){var q,w,X;
return g.b(function(P){if(P.X==1){if(!n.N)return Kn(n,"onTransferStart"),P.return();n.W.start(108E5);return g.l(P,SU(n,"TRANSFER_STATE_TRANSFERRING"),2)}q=n.N;return(X=((w=q)==null?0:w.key)?g.Sy(q.key).entityId:"")&&n.C?g.l(P,fn(X,n.C,n.X,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):P.f5(0)})},U4z=function(n){var q,w,X,P;
g.b(function(R){switch(R.X){case 1:if(!n.N){Kn(n,"onTransferPausedByUser");R.f5(2);break}q=n.N;n.W.stop();return g.l(R,SU(n,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:X=((w=q)==null?0:w.key)?g.Sy(q.key).entityId:"";if(!X||!n.C){R.f5(4);break}return g.l(R,fn(X,n.C,n.X,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.l(R,Y7(n,X),6);case 6:P=R.N,rst({videoId:X,Lq:q,offlineModeType:P});case 2:bo(n),AC(n),g.yy(R)}})},tqj=function(n){var q,w,X;
g.b(function(P){if(P.X==1){if(!n.N)return Kn(n,"onTransferPausedByNetwork"),P.return();n.W.stop();return g.l(P,SU(n,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(P.X!=3)return q=n.N,(X=((w=q)==null?0:w.key)?g.Sy(q.key).entityId:"")&&n.C?g.l(P,fn(X,n.C,n.X,"DOWNLOAD_STATE_PAUSED"),3):P.f5(3);bo(n);g.yy(P)})},fML=function(n){var q,w,X,P,R;
g.b(function(c){switch(c.X){case 1:if(!n.N)return Kn(n,"onTransferComplete"),c.return();q=n.N;n.W.stop();if(!q||!n.K){c.f5(2);break}w=OLj(n.api.B(),q.cotn,n.K);return g.l(c,IMi(n,w),2);case 2:return g.l(c,SU(n,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:P=((X=q)==null?0:X.key)?g.Sy(q.key).entityId:"";if(!P||!n.C){c.f5(5);break}return g.l(c,fn(P,n.C,n.X,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.l(c,qhD(n.X,P),7);case 7:return g.l(c,Y7(n,P),8);case 8:R=c.N,k7({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:P,Lq:q,offlineModeType:R}),bo(n),AC(n),g.yy(c)}})},Ocf=function(n,q,w){var X,P;
g.b(function(R){switch(R.X){case 1:if(!n.N)return Kn(n,"onTransferProgress: "+q),R.return();if(n.N.transferState==="TRANSFER_STATE_TRANSFERRING"){R.f5(2);break}return g.l(R,ro0(n),2);case 2:X=Date.now();if(!(X-n.HW>1E3)){R.f5(4);break}n.HW=X;return g.l(R,nHz(n.X,w.videoId,w.X,w.cJ,w.bytesDownloaded,w.N),5);case 5:if(n.L&&!(n.L&&X-n.qP>n.IH)){R.f5(4);break}n.qP=X;return g.l(R,Y7(n,q),7);case 7:P=R.N,IJB({videoId:q,Lq:n.N,offlineModeType:P},w.bytesDownloaded,w.N);case 4:n.W.start(108E5),g.yy(R)}})},
ic0=function(n){var q=(n.N.transferRetryCount||0)<3;
q&&(n=n.N,n.transferRetryCount=(n.transferRetryCount||0)+1);return q},Hcj=function(n,q){q=q===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":q;
var w,X,P,R;return g.b(function(c){if(c.X==1)return n.N||Kn(n,"setTransferToFailed: "+q),w="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q==="TRANSFER_FAILURE_REASON_NETWORK"?w="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":q==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(w="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.l(c,SU(n,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",q),2);if(c.X!=3)return RH(n.PW,{entityKey:(X=n.N)==null?void 0:X.key,failureReason:w}),
P=n.N?g.Sy(n.N.key).entityId:"",g.l(c,Y7(n,P),3);R=c.N;var k={videoId:P,Lq:n.N,offlineModeType:R},r=q,e={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};r&&(e.transferFailureReason=r,e.failureReason=j2G(r));k7(e,k);g.yy(c)})},SU=function(n,q,w,X){var P;
return g.b(function(R){if(R.X==1){if(!n.N)return Kn(n,"saveTransferState: "+q),R.return();n.N.transferState=q;n.N.failureReason=X;g.Vy(R,2);return g.l(R,klf(n,function(c){return w?YP(c,"offlineVideoStreams",n.N.offlineVideoStreams).then(function(k){for(var r=g.a(k),e=r.next();!e.done;e=r.next())if((e=e.value)&&e.streamsProgress){e=g.a(e.streamsProgress);for(var f=e.next();!f.done;f=e.next())f.value.streamState=w}return fPG(c,k.filter(function(O){return!!O}),"offlineVideoStreams")}):g.UY.resolve(void 0)}),
4)}if(R.X!=2)return g.FY(R,0);
P=g.$u(R);return P instanceof g.jI&&P.type==="QUOTA_EXCEEDED"?g.l(R,n.YY("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):R.f5(0)})},klf=function(n,q){var w;
return g.b(function(X){if(!n.N)return X.return();w=n.N;return g.l(X,Z8(n.X,{mode:"readwrite",z9:!0},function(P){var R=[S1(P,w,"transfer")];q&&R.push(q(P));return g.UY.all(R)}),0)})},bo=function(n){n.N=void 0;
n.K=void 0;n.W.stop()},jUB=function(n,q){var w,X,P,R,c;
return g.b(function(k){if(k.X==1)return w=g.Sy(q.key),X=w.entityId,P=g.uP(X,"playbackData"),g.l(k,z8(n.X,P,"playbackData"),2);R=k.N;if((c=R)==null?0:c.playerResponseJson)return k.return(JSON.parse(R.playerResponseJson));throw Error("No PlayerResponse found");})},Kn=function(n,q){n.api.p5("woffle",{mcte:q});
Xt("missing current transfer entity.")},Y7=function(n,q){var w,X,P;
return g.b(function(R){if(R.X==1)return g.l(R,z8(n.X,g.uP(q,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);w=R.N;return R.return((P=(X=w)==null?void 0:X.offlineModeType)!=null?P:void 0)})},sUD=function(n){return UXG[n.transferState]!==void 0},eDf=function(n,q){var w=UXG[n.transferState],X=UXG[q.transferState];
return w!==X?w-X:Number(n.enqueuedTimestampMs)-Number(q.enqueuedTimestampMs)},uo=function(n,q){var w=this;
this.NP=n;this.api=q;this.D=new g.CH;this.K=new g.cR;this.Wb={UH:function(){return w.C.Wb.UH()},
SI:function(){return w.D},
Izp:function(){return w.C},
jl:function(){return w.jl()},
mB:function(){return w.mB()},
Nq:function(){return w.Nq()},
a$:function(){return w.a$()},
XW:function(){return w.XW()},
cn:function(X){return w.cn(X)}};
this.C=new qgt(function(){return teG(w)},function(){w.Nq()},this.api.nO(),this.api.Z.bind(this.api));
this.N=new Pd(this.api);wRG(this.C)},teG=function(n){return g.b(function(q){n.api.Uq("onOrchestrationBecameLeader");
return g.l(q,n.mB(),0)})},gHj=function(n){var q,w;
return g.b(function(X){if(X.X==1)return g.l(X,Nz(),2);if(X.X!=3){q=X.N;if(!q)return Xt("PES is undefined"),X.return();n.X=new wNi(q,n.api,n.C,n.N);w=n.w7(q);return g.l(X,GKj(q,w,n.C,n.N,n.NP),3)}n.G=X.N;return g.l(X,dXG(n),0)})},dXG=function(n){var q;
return g.b(function(w){switch(w.X){case 1:if(!n.X)return Xt("transferManager is undefined"),w.return();if(n.X.N){w.f5(2);break}return g.l(w,AC(n.X),2);case 2:if(!n.NP.Z("woffle_enable_main_downloads_library")){w.f5(4);break}return g.l(w,n.bv(),4);case 4:if(!n.NP.Z("html5_offline_playback_position_sync")){w.f5(6);break}return g.l(w,n.hd(),7);case 7:return g.l(w,n.cn(864E5),6);case 6:return g.l(w,n.refreshAllStaleEntities(43200,!0),9);case 9:return g.l(w,n.kZ(),10);case 10:if(!n.NP.Z("html5_retry_downloads_for_expiration")){w.f5(11);
break}return g.l(w,n.XW(),11);case 11:return n.V=g.jz(function(){n.refreshAllStaleEntities(43200,!0);n.kZ()},9E5),g.u4(g.Qs(),function(){return n.a$()}),g.l(w,Nz(),13);
case 13:return q=w.N,g.l(w,nDv(q),14);case 14:XRD(n.C),g.yy(w)}})},mXf=function(){var n,q,w,X,P,R;
return g.b(function(c){switch(c.X){case 1:return g.l(c,Nz(),2);case 2:n=c.N;if(!n)return c.return([]);q=Date.now()/1E3;return g.l(c,Wi(n,"offlineVideoPolicy"),3);case 3:w=c.N,X=g.a(w),P=X.next();case 4:if(P.done){c.f5(6);break}R=P.value;if(!(R.expirationTimestamp&&Number(R.expirationTimestamp)<q)){c.f5(5);break}R.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";R.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.l(c,Jp(n,R,"offlineVideoPolicy"),5);
case 5:P=X.next();c.f5(4);break;case 6:return c.return(w.map(function(k){return k.key}))}})},Bd=function(n,q,w,X,P){var R,c,k;
return g.b(function(r){if(r.X==1)return g.l(r,Nz(),2);R=r.N;if(!R)return r.return([]);c=q.map(function(e){var f=g.uP(e,w);f={actionType:X,entityKey:f,actionMetadata:Object.assign({},iLz(),P)};X!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(f.actionMetadata.priority=0);e=new UC(w,e,f);return dJ(e)});
k=yjv(R,c);wRG(n.C);return r.return(k)})},yoj=function(n,q,w,X){var P,R,c,k,r,e,f,O;
return g.b(function(H){switch(H.X){case 1:P=[],R=g.a(q),c=R.next();case 2:if(c.done){H.f5(4);break}k=c.value;if(k.upToDate||w&&!k.shouldAutoSyncMetadata||!k.playlistId){H.f5(3);break}r={};switch(X){case "mainPlaylistEntity":e={nextAutoRefreshIntervalSeconds:k.checkInSeconds,autoSync:w};r={mainPlaylistEntityActionMetadata:e};break;case "musicPlaylist":f={autoSync:w},r={musicPlaylistEntityActionMetadata:f}}return g.l(H,Bd(n,[k.playlistId],X,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",r),6);case 6:(O=
H.N)&&P.push.apply(P,g.D(O));case 3:c=R.next();H.f5(2);break;case 4:return H.return(P)}})},aMB=function(n,q){var w;
return g.b(function(X){return q.length?(w=iLz(),g.M0(w,hC,{isEnqueuedForExpiredStreamUrlRefetch:!0}),n.api.p5("qrd",{v:q.length}),X.return(Bd(n,q,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",w))):X.return([])})},Vet=function(n,q,w){this.N=n;
this.NP=q;this.C=w},FqG=function(n,q){var w,X,P,R,c,k,r,e,f,O,H,U,t,V,T,x,M;
return g.b(function(h){switch(h.X){case 1:return w=rJ(q),X=g.Sy(q.entityKey),P=X.entityId,R=[],g.Vy(h,2),g.l(h,pNj(n,P),4);case 4:R=h.N;if(!(n.NP.Z("woffle_enable_main_downloads_library")&&((c=R)==null?0:c.length))){h.f5(5);break}return g.l(h,$L5(n.N,[q.entityKey]),5);case 5:g.FY(h,3);break;case 2:return k=g.$u(h),r="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",k instanceof g.jI&&k.type==="QUOTA_EXCEEDED"?(r="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
e="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):Xt("Playlist add error"),h.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,r,e));case 3:f=[];if(!n.NP.Z("html5_offline_prevent_redownload_downloaded_video")){h.f5(7);break}return g.l(h,fJB(n.N,"mainVideoEntity",R),8);case 8:R=h.N;case 7:if((O=R)==null?0:O.length)for(H=g.a(R),U=H.next();!U.done;U=H.next())if(t=U.value,V=t.offlineVideoData,T=void 0,(T=V)==null?0:T.videoId)x=void 0,M=Number(((x=q.actionMetadata)==null?void 0:x.priority)||
0)+1,f.push(x7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",V.videoId,"mainVideoEntity",M,QV,Tef(q,V,P)));return h.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,f))}})},vHf=function(n,q){var w,X,P,R,c,k,r,e,f,O,H,U,t,V,T,x,M,h,E,S,nO,J,c0,ku,Is,e3,wx,v0,ls,ql,o5,g0,E6,WG,HG,SB,wR,L,El,DL,XY,Tf,p,qs,uQ,IP,bz,us,Ns,no,oF,F,y,v,G,Y,fO,B,W,C,xu,KO,rx,jB,LO,as,wr,Fh,Cj,TT,ax,Ms,hw,pj;
return g.b(function(rR){switch(rR.X){case 1:return w=rJ(q),X=q.entityKey,P=g.Sy(X).entityId,R=[],c=!1,P==="!*$_ALL_ENTITIES_!*$"?(c=!0,g.l(rR,Wi(n.N,"mainPlaylistEntity"),5)):g.l(rR,z8(n.N,X,"mainPlaylistEntity"),4);case 4:(k=rR.N)&&R.push(k);rR.f5(3);break;case 5:R=rR.N;case 3:if((r=R)==null||!r.length)return rR.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));e=g.u(q.actionMetadata,$XL);O=(f=e)==null?void 0:f.nextAutoRefreshIntervalSeconds;U=(H=e)==null?void 0:H.autoSync;t=[];T=V=
!0;x=!1;if(!c&&U===!1){rR.f5(6);break}g.Vy(rR,7);return g.l(rR,Ygv(0,!!U,!0,R),9);case 9:t=rR.N;g.FY(rR,8);break;case 7:M=g.$u(rR);if(!(M instanceof Error&&M.message==="No data")){M instanceof Error&&M.message==="Empty response body"&&Xt(M.message);rR.f5(8);break}return P==="!*$_ALL_ENTITIES_!*$"?g.l(rR,ysz(n.N,q,n.C,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.l(rR,gDz(P,n.N,q,n.C),8);case 8:if(!t.length||!c&&t[0].playlistId!==P)return rR.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
w));case 6:if(c){h=[];E=g.a(t);for(S=E.next();!S.done;S=E.next())nO=S.value,nO.upToDate||U&&!nO.shouldAutoSyncMetadata||!nO.playlistId||(J={nextAutoRefreshIntervalSeconds:nO.checkInSeconds,autoSync:U},h.push(x7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",nO.playlistId,"mainPlaylistEntity",0,QV,{mainPlaylistEntityActionMetadata:J})));return rR.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,h))}t.length&&(c0=t[0],x=!!c0.upToDate,U&&(V=(ku=c0.shouldAutoSyncMetadata)!=null?ku:!0,T=(Is=
c0.shouldAutoSyncVideos)!=null?Is:!0,c0.checkInSeconds&&(O=c0.checkInSeconds)));if(x||!V)return rR.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));e3=[];wx=R[0];if(!wx.downloadState){v0=void 0;rR.f5(15);break}return g.l(rR,z8(n.N,wx.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:v0=rR.N;case 15:return ls=v0,o5=((ql=ls)==null?0:ql.addedTimestampMillis)?String(ls.addedTimestampMillis):void 0,g.Vy(rR,17),g.l(rR,pNj(n,P,o5,O),19);case 19:e3=rR.N;g.FY(rR,18);break;case 17:g0=
g.$u(rR);if(!(g0 instanceof Error&&g0.message==="No data for playlist")){if(g0 instanceof Error&&g0.message==="Empty response body for playlist")Xt(g0.message);else return E6="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",WG="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",g0 instanceof g.jI&&g0.type==="QUOTA_EXCEEDED"&&(E6="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",WG="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),rR.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
w,void 0,E6,WG));rR.f5(18);break}return g.l(rR,gDz(P,n.N,q,n.C),18);case 18:if(!T)return rR.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));HG=[];SB=new Map;if((wR=e3)==null?0:wR.length)for(L=g.a(e3),El=L.next();!El.done;El=L.next())DL=El.value,XY=DL.offlineVideoData,Tf=void 0,((Tf=XY)==null?0:Tf.videoId)&&SB.set(XY.videoId,XY);p=new Map;qs=[];if((uQ=wx)==null?0:(IP=uQ.videos)==null?0:IP.length)for(bz=g.a(wx.videos),us=bz.next();!us.done;us=bz.next())if(Ns=us.value,no=JSON.parse(g.Sy(Ns).entityId),
oF=no.videoId)SB.has(oF)?(p.set(oF,SB.get(oF)),SB.delete(oF)):qs.push(oF);y=Number(((F=q.actionMetadata)==null?void 0:F.priority)||0)+1;v=g.a(SB.entries());for(G=v.next();!G.done;G=v.next())Y=G.value,fO=g.a(Y),B=fO.next().value,W=fO.next().value,C=B,xu=W,HG.push(x7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",C,"mainVideoEntity",y,QV,Tef(q,xu,P)));KO=g.a(p.entries());for(rx=KO.next();!rx.done;rx=KO.next())jB=rx.value,LO=g.a(jB),as=LO.next().value,wr=LO.next().value,Fh=as,Cj=wr,HG.push(x7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
Fh,"mainVideoEntity",y,QV,Tef(q,Cj,P)));TT=g.a(qs);for(ax=TT.next();!ax.done;ax=TT.next())Ms=ax.value,hw={playlistId:P},pj={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:hw},HG.push(x7("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Ms,"mainVideoEntity",0,QV,pj));return rR.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,HG))}})},Lq5=function(n,q){var w,X,P,R;
return g.b(function(c){switch(c.X){case 1:return w=rJ(q),g.Vy(c,2),X=g.Sy(q.entityKey).entityId,X==="!*$_ALL_ENTITIES_!*$"?g.l(c,ysz(n.N,q,n.C,(P=q.actionMetadata)==null?void 0:(R=P.offlineLoggingData)==null?void 0:R.offlineDeleteReason),5):g.l(c,gDz(X,n.N,q,n.C),6);case 6:if(!n.NP.Z("woffle_enable_main_downloads_library")){c.f5(5);break}return g.l(c,vDL(n.N,q.entityKey),5);case 5:g.FY(c,3);break;case 2:return g.$u(c),c.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return c.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w))}})},pNj=function(n,q,w,X){var P,R,c,k,r,e,f;
return g.b(function(O){switch(O.X){case 1:return g.l(O,bLD([q]),2);case 2:return P=O.N,g.l(O,MeB(n,P[0],w,X),3);case 3:return R=O.N,c=R.mainPlaylistEntity,k=R.une,e=tmG(c,(r=k)==null?void 0:r.avatar),g.Vy(O,4),g.l(O,ms(e),6);case 6:g.FY(O,5);break;case 4:f=g.$u(O),f instanceof Error&&f.message==="Failed to fetch"&&Xt(f.message);case 5:return O.return(P[0].videos)}})},MeB=function(n,q,w,X){var P,R,c,k,r,e,f,O,H,U,t,V,T,x,M,h,E;
return g.b(function(S){switch(S.X){case 1:P=Date.now().toString();w||(w=P);R=q.videos;c=q.playlistId;k=[];r=[];if(R)for(e=g.a(R),f=e.next();!f.done;f=e.next()){O=f.value;H=O.offlineVideoData;if(!H||!H.videoId)throw Xt("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");U=H.videoId;t={videoId:U,playlistId:c};V={id:g.uP(JSON.stringify(t),"mainPlaylistVideoEntity"),video:g.uP(U,"mainVideoEntity")};k.push(V);r.push(V.id)}x={key:g.uP(c,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:w,lastSyncedTimestampMillis:P};M={key:g.uP(c,"mainPlaylistEntity"),playlistId:c,videos:r,title:q.title,thumbnailStyleData:xX5(q),visibility:DXi(q),downloadState:x.key};q.channel&&(h=q.channel.offlineChannelData,T=hDL(g.uP(c,"ytMainChannelEntity"),h),M.channelOwner=T.id);((E=M)==null?0:E.entityMetadata)?(M.entityMetadata.offlineLastModifiedTimestampSeconds=q.lastModifiedTimestamp,X&&(M.entityMetadata.nextAutoRefreshIntervalSeconds=String(X))):M&&(M.entityMetadata={nextAutoRefreshIntervalSeconds:X?
String(X):void 0,offlineLastModifiedTimestampSeconds:q.lastModifiedTimestamp});g.Vy(S,2);return g.l(S,Z8(n.N,{mode:"readwrite",z9:!0},function(nO){var J=S1(nO,M,"mainPlaylistEntity"),c0=S1(nO,x,"mainPlaylistDownloadStateEntity");J=[J,c0];c0=g.a(k);for(var ku=c0.next();!ku.done;ku=c0.next())J.push(S1(nO,ku.value,"mainPlaylistVideoEntity"));T&&J.push(S1(nO,T,"ytMainChannelEntity"));return g.UY.all(J)}),4);
case 4:g.FY(S,3);break;case 2:throw g.$u(S),Xt("PES failure for playlist"),Error("PES failure for playlist");case 3:return S.return({mainPlaylistEntity:M,une:T,cDq:k})}})},hDL=function(n,q){return{id:n,
channelId:q.channelId,title:q.title,avatar:q.thumbnail}},xX5=function(n){var q=[],w=n.videos;
w&&w.length>0&&q.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:w[0].offlineVideoData.thumbnail}}});if((n=n.additionalMetadadatas)&&n.length>0)for(n=g.a(n),w=n.next();!w.done;w=n.next()){var X=w.value.offlineBundleItemPlaylistData,P=void 0;w=(P=X)==null?void 0:P.style;P=void 0;X={collageThumbnail:{coverThumbnail:(P=X)==null?void 0:P.coverThumbnail}};switch(w){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":q.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:X});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":q.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:X});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":q.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:X});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":q.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:X})}}return q},DXi=function(n){switch(n.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},Tef=function(n,q,w){q={offlineVideoData:q,
playlistId:w};if(n=g.u(n.actionMetadata,$XL))q.maximumDownloadQuality=n.maximumDownloadQuality;return{mainVideoEntityActionMetadata:q}},lMB=function(n,q,w){this.N=n;
this.NP=q;this.C=w},EHh=function(n,q){var w,X,P,R,c,k,r,e,f,O,H,U,t;
return g.b(function(V){switch(V.X){case 1:return w=rJ(q),X=g.Sy(q.entityKey),P=X.entityId,R=g.u(q.actionMetadata,Zl),k=!((c=R)==null?0:c.playlistId),g.Vy(V,2),g.l(V,Glj(n,P,void 0,(r=R)==null?void 0:r.offlineVideoData,k),4);case 4:g.FY(V,3);break;case 2:return e=g.$u(V),f="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",e instanceof g.jI&&e.type==="QUOTA_EXCEEDED"&&(f="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
V.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,f,O));case 3:H=1;H=Number(((U=q.actionMetadata)==null?void 0:U.priority)||0)+1;var T=(T=g.u(q.actionMetadata,Zl))?{playbackDataActionMetadata:{maximumDownloadQuality:T.maximumDownloadQuality}}:void 0;t=x7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",P,"playbackData",H,CUi,T);return V.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,[t]))}})},oHG=function(n,q){var w,X,P,R,c,k,r,e,f,O,H,U,t,V,T,x,M;
return g.b(function(h){switch(h.X){case 1:return w=rJ(q),X=g.Sy(q.entityKey),P=X.entityId,g.l(h,z8(n.N,q.entityKey,"mainVideoEntity"),2);case 2:R=h.N;if(!R){c=void 0;h.f5(3);break}return g.l(h,z8(n.N,R.downloadState,"mainVideoDownloadStateEntity"),4);case 4:c=h.N;case 3:k=c;if(!R||!k)return h.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));g.Vy(h,5);return g.l(h,Glj(n,P,k.addedTimestampMillis,(e=g.u(q.actionMetadata,Zl))==null?void 0:e.offlineVideoData),7);case 7:f=1;f=Number(((O=
q.actionMetadata)==null?void 0:O.priority)||0)+1;r=x7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",P,"playbackData",f,CUi);g.FY(h,6);break;case 5:H=g.$u(h);if(!(H instanceof Error&&H.message==="No data")){if(H instanceof Error&&H.message==="Empty response body")Xt(H.message);else return U="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",t="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",H instanceof g.jI&&H.type==="QUOTA_EXCEEDED"&&(U="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
t="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),h.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,U,t));h.f5(6);break}return g.l(h,VV(n.N,P),9);case 9:V=h.N;T=g.u(q.actionMetadata,Zl);if(M=(x=T)==null?void 0:x.playlistId)V.playlistId=M;V.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.l(h,yV(P,n.N,q,n.C,V),6);case 6:return h.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,r?[r]:void 0))}})},bcD=function(n,q){var w,X,P,R,c,k,r,e,f,O;
return g.b(function(H){switch(H.X){case 1:return w=rJ(q),g.Vy(H,2),X=g.Sy(q.entityKey).entityId,X==="!*$_ALL_ENTITIES_!*$"?g.l(H,ysz(n.N,q,n.C,(f=q.actionMetadata)==null?void 0:(O=f.offlineLoggingData)==null?void 0:O.offlineDeleteReason),5):g.l(H,VV(n.N,X),6);case 6:P=H.N;R=g.u(q.actionMetadata,Zl);if(k=(c=R)==null?void 0:c.playlistId)P.playlistId=k;P.offlineDeleteReason=(r=q.actionMetadata)==null?void 0:(e=r.offlineLoggingData)==null?void 0:e.offlineDeleteReason;return g.l(H,yV(X,n.N,q,n.C,P),7);
case 7:if(!n.NP.Z("woffle_enable_main_downloads_library")){H.f5(5);break}return g.l(H,vDL(n.N,q.entityKey),5);case 5:g.FY(H,3);break;case 2:return g.$u(H),H.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w))}})},Glj=function(n,q,w,X,P){var R,c,k,r,e,f;
return g.b(function(O){switch(O.X){case 1:if(R=X){O.f5(2);break}return g.l(O,oDf([q]),3);case 3:c=O.N,R=c[0];case 2:return g.l(O,Aoj(n,R,w,P),4);case 4:k=O.N;r=k.mainVideoEntity;e=k.channelEntity;g.Vy(O,5);var H=Hd(r.thumbnail),U=Hd(e.avatar);return g.l(O,ms(H.concat(U)),7);case 7:g.FY(O,0);break;case 5:f=g.$u(O),f instanceof Error&&f.message==="Failed to fetch"&&Xt(f.message),g.yy(O)}})},Aoj=function(n,q,w,X){var P,R,c,k,r,e,f,O,H,U,t,V,T;
return g.b(function(x){switch(x.X){case 1:w||(w=Date.now().toString());R=(P=q.channel)==null?void 0:P.offlineChannelData;c={id:g.uP(q.videoId,"ytMainChannelEntity"),channelId:R.channelId,title:R.title,avatar:R.thumbnail};k={key:g.uP(q.videoId,"mainVideoDownloadStateEntity"),playbackData:g.uP(q.videoId,"playbackData"),addedTimestampMillis:w,videoDownloadContextEntity:g.uP(q.videoId,"videoDownloadContextEntity")};r={key:g.uP(q.videoId,"videoPlaybackPositionEntity"),videoId:q.videoId,lastPlaybackPositionSeconds:"0"};
n.NP.Z("html5_offline_playback_position_sync")&&(e={playbackPosition:r.key});f=g.uP(q.videoId,"mainVideoEntity");O={key:f,videoId:q.videoId,title:q.title,thumbnail:q.thumbnail,localizedStrings:{viewCount:q.shortViewCountText},userState:e,lengthSeconds:q.lengthSeconds?Number(q.lengthSeconds):void 0,publishedTimestampMillis:q.publishedTimestamp?(Number(q.publishedTimestamp)*1E3).toString():void 0,formattedDescription:q.description,owner:c.id,downloadState:k.key};if(!n.NP.Z("woffle_enable_main_downloads_library")||
!X){x.f5(2);break}return g.l(x,Fyh(n.N,[f]),3);case 3:if(t=x.N)H=t.mainDownloadsLibraryEntity,U=t.mainDownloadsListEntity;case 2:return T=e8t,V={key:g.uP(q.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.M0(k,T,V),g.l(x,Z8(n.N,{mode:"readwrite",z9:!0},function(M){var h=S1(M,c,"ytMainChannelEntity"),E=S1(M,k,"mainVideoDownloadStateEntity"),S=S1(M,O,"mainVideoEntity");h=[h,E,S];n.NP.Z("html5_offline_playback_position_sync")&&(E=S1(M,r,"videoPlaybackPositionEntity"),
h.push(E));H&&(E=S1(M,H,"mainDownloadsLibraryEntity"),h.push(E));U&&(E=S1(M,U,"mainDownloadsListEntity"),h.push(E));V&&(M=S1(M,V,"downloadStatusEntity"),h.push(M));return g.UY.all(h)}),4);
case 4:return x.return({mainVideoEntity:O,channelEntity:c})}})},Yhl=function(n,q,w){this.N=n;
this.NP=q;this.C=w},ShB=function(n,q){var w,X,P,R,c,k,r,e,f,O,H,U,t,V,T,x,M,h,E,S,nO,J,c0,ku,Is,e3,wx;
return g.b(function(v0){switch(v0.X){case 1:return w=rJ(q),X=[],g.l(v0,E1.getInstance(),2);case 2:P=v0.N;if(!P){v0.f5(3);break}return g.l(v0,P.get("sdois"),4);case 4:return R=v0.N,g.l(v0,(k=P)==null?void 0:k.get("lmqf"),5);case 5:c=v0.N;case 3:g.Vy(v0,6);if(R===void 0)throw Error("prefStorage or opt-in state is undefined");r=[];if(R){v0.f5(8);break}return g.l(v0,T7f(n.N),9);case 9:r=v0.N,r.reverse();case 8:if(!r.length){v0.f5(10);break}e=g.a(r);f=e.next();case 11:if(f.done){v0.f5(10);break}O=f.value;
if(!O){v0.f5(12);break}H=g.Sy(O).entityId;return g.l(v0,VV(n.N,H),14);case 14:return U=v0.N,U.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.l(v0,yV(H,n.N,{entityKey:O,actionType:q.actionType},n.C,U),12);case 12:f=e.next();v0.f5(11);break;case 10:return g.l(v0,Sgi(R,(t=c)!=null?t:"SD"),16);case 16:return V=v0.N,g.l(v0,aJt(V),17);case 17:T=pRj(V);if(!n.NP.Z("woffle_enable_main_downloads_library")){v0.f5(18);break}if(R){v0.f5(19);break}return g.l(v0,vDL(n.N,g.Al),19);case 19:return g.l(v0,
$L5(n.N,[g.Al]),18);case 18:if((x=T)==null?0:x.length)for(M=g.a(T),h=M.next();!h.done;h=M.next())if(S=E=h.value,nO=S.actionType,J=S.entityKey,c0=S.actionMetadata,nO&&J&&c0&&!g.u(c0,Kq0)){nO==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(c0.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(ku=g.u(E.actionMetadata,Zl))ku.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",E.actionMetadata=Object.assign({},E.actionMetadata,{mainVideoEntityActionMetadata:ku});X.push(E)}g.FY(v0,
7);break;case 6:return Is=g.$u(v0),e3="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",wx="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Is instanceof g.jI&&Is.type==="QUOTA_EXCEEDED"&&(e3="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",wx="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),v0.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,e3,wx));case 7:return v0.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,X))}})},uW0=function(){uo.apply(this,
arguments);
this.L="mainVideoEntity"},BeD=function(n,q,w){q=q===void 0?43200:q;
w=w===void 0?!0:w;var X=X===void 0?!1:X;var P,R,c;return g.b(function(k){switch(k.X){case 1:if(!n.D.ML())return k.return([]);P=[];g.Vy(k,2);return g.l(k,Ygv(q,w,X),4);case 4:P=k.N;g.FY(k,3);break;case 2:R=g.$u(k),R instanceof Error&&R.message==="No data"||R instanceof Error&&R.message==="Empty response body"&&Xt(R.message);case 3:return c=yoj(n,P,w,"mainPlaylistEntity"),k.return(c)}})},QUG=function(n,q,w,X){X=X===void 0?!1:X;
var P,R,c,k,r,e,f,O,H,U,t,V,T,x,M;return g.b(function(h){switch(h.X){case 1:return P=[],g.l(h,Ky0(),2);case 2:return(R=h.N)||X?g.l(h,uDz(q,w),3):h.return([]);case 3:c=h.N;if((k=c)==null||!k.length)return h.return([]);r={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};e=g.a(c);f=e.next();case 4:if(f.done){h.f5(6);break}H=O=f.value;U=H.actionType;t=H.entityKey;V=H.actionMetadata;if(!(U&&t&&V)||g.u(V,Kq0)){h.f5(5);break}U==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(V.offlineLoggingData=
r);T=g.Sy(t);x=T.entityId;return g.l(h,Bd(n,[x],"mainVideoEntity",U,V),8);case 8:M=h.N,P=P.concat(M);case 5:f=e.next();h.f5(4);break;case 6:return h.return(P)}})},Zc0=function(n,q){this.N=n;
this.C=q},zDG=function(n,q){var w,X,P,R,c,k,r,e,f,O,H,U,t,V,T,x;
return g.b(function(M){switch(M.X){case 1:return w=rJ(q),X=g.Sy(q.entityKey),P=X.entityId,R=[],g.Vy(M,2),g.l(M,JoL(n,P),4);case 4:R=M.N;if((c=R)==null||!c.length){M.f5(5);break}return g.l(M,h8G(n.N,q.entityKey),5);case 5:g.FY(M,3);break;case 2:return k=g.$u(M),r="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",k instanceof g.jI&&k.type==="QUOTA_EXCEEDED"&&(r="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
M.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,r,e));case 3:return f=[],g.l(M,fJB(n.N,"musicTrack",R),7);case 7:R=M.N;if(R.length)for(O=g.a(R),H=O.next();!H.done;H=O.next())if(U=H.value,t=U.offlineVideoData,V=void 0,(V=t)==null?0:V.videoId)T=void 0,x=Number(((T=q.actionMetadata)==null?void 0:T.priority)||0)+1,f.push(x7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",t.videoId,"musicTrack",x,JC,$7(q,t,P)));return M.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,f))}})},
Wqz=function(n,q){var w,X,P,R,c,k,r,e,f,O,H,U,t,V,T,x,M,h,E,S,nO,J,c0,ku,Is,e3,wx,v0,ls,ql,o5,g0,E6,WG,HG,SB,wR,L,El,DL,XY,Tf,p,qs,uQ,IP,bz,us,Ns,no,oF,F,y,v,G,Y,fO,B,W;
return g.b(function(C){switch(C.X){case 1:return w=rJ(q),X=q.entityKey,P=g.Sy(X).entityId,R=[],c=!1,P==="!*$_ALL_ENTITIES_!*$"?(c=!0,g.l(C,Wi(n.N,"musicAlbumRelease"),5)):g.l(C,z8(n.N,X,"musicAlbumRelease"),4);case 4:(k=C.N)&&R.push(k);C.f5(3);break;case 5:R=C.N;case 3:if((r=R)==null||!r.length)return C.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));if(c){e=[];f=g.a(R);for(O=f.next();!O.done;O=f.next())H=O.value,U=g.Sy(H.id).entityId,e.push(x7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
U,"musicAlbumRelease",0,JC));return C.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,e))}t=[];V=R[0];T=void 0;if(!V.downloadMetadata){C.f5(6);break}return g.l(C,z8(n.N,V.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:x=C.N,T=Number((h=(M=x)==null?void 0:M.addedTimestampMillis)!=null?h:"0")/1E3;case 6:return g.Vy(C,8),g.l(C,JoL(n,P,(E=T)==null?void 0:E.toString()),10);case 10:t=C.N;g.FY(C,9);break;case 8:S=g.$u(C);if(!(S instanceof Error&&S.message==="No data")){if(S instanceof
Error&&S.message==="Empty response body")Xt(S.message);else return nO="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",S instanceof g.jI&&S.type==="QUOTA_EXCEEDED"&&(nO="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",J="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),C.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,nO,J));C.f5(9);break}return g.l(C,TA(P,"musicAlbumRelease",n.N,q,n.C),9);case 9:c0=[];ku=
new Map;if((Is=t)==null?0:Is.length)for(e3=g.a(t),wx=e3.next();!wx.done;wx=e3.next())v0=wx.value,ls=v0.offlineVideoData,ql=void 0,((ql=ls)==null?0:ql.videoId)&&ku.set(ls.videoId,ls);o5=new Map;g0=[];if((E6=V)==null?0:(WG=E6.tracks)==null?0:WG.length)for(HG=g.a(V.tracks),SB=HG.next();!SB.done;SB=HG.next())if(wR=SB.value,L=g.Sy(wR).entityId)ku.has(L)?(o5.set(L,ku.get(L)),ku.delete(L)):g0.push(L);DL=Number(((El=q.actionMetadata)==null?void 0:El.priority)||0)+1;XY=g.a(ku.entries());for(Tf=XY.next();!Tf.done;Tf=
XY.next())p=Tf.value,qs=g.a(p),uQ=qs.next().value,IP=qs.next().value,bz=uQ,us=IP,c0.push(x7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",bz,"musicTrack",DL,JC,$7(q,us)));Ns=g.a(o5.entries());for(no=Ns.next();!no.done;no=Ns.next())oF=no.value,F=g.a(oF),y=F.next().value,v=F.next().value,G=y,Y=v,c0.push(x7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",G,"musicTrack",DL,JC,$7(q,Y)));fO=g.a(g0);for(B=fO.next();!B.done;B=fO.next())W=B.value,c0.push(x7("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",W,"musicTrack",
0,JC));return C.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,c0))}})},Nei=function(n,q){var w,X;
return g.b(function(P){switch(P.X){case 1:return w=rJ(q),g.Vy(P,2),X=g.Sy(q.entityKey).entityId,X==="!*$_ALL_ENTITIES_!*$"?g.l(P,Ft(n.N,q,n.C),5):g.l(P,TA(X,"musicAlbumRelease",n.N,q,n.C),6);case 6:return g.l(P,lJi(n.N,q.entityKey),5);case 5:g.FY(P,3);break;case 2:return g.$u(P),P.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return P.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
w))}})},JoL=function(n,q,w){var X,P,R;
return g.b(function(c){switch(c.X){case 1:return g.l(c,bLD([q]),2);case 2:return X=c.N,g.l(c,nvi(n,X[0],w),3);case 3:return P=c.N,R=Hd(P.thumbnailDetails),g.l(c,ms(R),4);case 4:return c.return(X[0].videos)}})},nvi=function(n,q,w){var X,P,R,c,k,r,e,f,O,H,U,t,V,T;
return g.b(function(x){if(x.X==1){X=q.additionalMetadadatas;P=void 0;if(X&&X.length>0)for(R=g.a(X),c=R.next();!c.done;c=R.next())if(k=c.value,k.offlineMusicPlaylistData){P=k.offlineMusicPlaylistData;break}r=q.playlistId;e=GuG(q);f=e.bl;O=e.S1;H=w?(Number(w)*1E3).toString():Date.now().toString();U=q.lastModifiedTimestamp?(Number(q.lastModifiedTimestamp)*1E3).toString():"0";t={id:g.uP(r,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:O,lastModifiedTimestampMillis:U,addedTimestampMillis:H,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};V={id:g.uP(r,"musicAlbumRelease"),title:q.title,audioPlaylistId:r,trackCount:q.totalVideoCount,tracks:f,downloadMetadata:t.id};P&&(V.thumbnailDetails=(T=P.albumHqThumbnail)!=null?T:P.albumArtistThumbnail,V.artistDisplayName=P.albumArtistDisplayName,V.releaseDate=P.albumReleaseDate,V.contentRating={explicitType:P.albumReleaseExplicitType},V.releaseType=P.albumReleaseType);return g.l(x,Z8(n.N,{mode:"readwrite",z9:!0},function(M){var h=S1(M,V,"musicAlbumRelease");
M=S1(M,t,"musicAlbumReleaseDownloadMetadataEntity");return g.UY.all([h,M])}),2)}return x.return(V)})},qqG=function(n,q){this.N=n;
this.C=q},XAG=function(n,q){var w,X,P,R,c,k,r,e,f,O,H,U,t,V,T,x;
return g.b(function(M){switch(M.X){case 1:return w=rJ(q),X=g.Sy(q.entityKey),P=X.entityId,R=[],g.Vy(M,2),g.l(M,wAl(n,P),4);case 4:R=M.N;if((c=R)==null||!c.length){M.f5(5);break}return g.l(M,h8G(n.N,q.entityKey),5);case 5:g.FY(M,3);break;case 2:return k=g.$u(M),r="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",k instanceof g.jI&&k.type==="QUOTA_EXCEEDED"&&(r="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",e="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
M.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,r,e));case 3:return f=[],g.l(M,fJB(n.N,"musicTrack",R),7);case 7:R=M.N;if(R.length)for(O=g.a(R),H=O.next();!H.done;H=O.next())if(U=H.value,t=U.offlineVideoData,V=void 0,(V=t)==null?0:V.videoId)T=void 0,x=Number(((T=q.actionMetadata)==null?void 0:T.priority)||0)+1,f.push(x7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",t.videoId,"musicTrack",x,zA,$7(q,t,P)));return M.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,f))}})},
PpL=function(n,q){var w,X,P,R,c,k,r,e,f,O,H,U,t,V,T,x,M,h,E,S,nO,J,c0,ku,Is,e3,wx,v0,ls,ql,o5,g0,E6,WG,HG,SB,wR,L,El,DL,XY,Tf,p,qs,uQ,IP,bz,us,Ns,no,oF,F,y,v,G,Y,fO,B,W,C,xu,KO,rx,jB,LO,as,wr,Fh,Cj,TT,ax;
return g.b(function(Ms){switch(Ms.X){case 1:return w=rJ(q),X=q.entityKey,P=g.Sy(X).entityId,R=[],c=!1,P==="!*$_ALL_ENTITIES_!*$"?(c=!0,g.l(Ms,Wi(n.N,"musicPlaylist"),5)):g.l(Ms,z8(n.N,X,"musicPlaylist"),4);case 4:(k=Ms.N)&&R.push(k);Ms.f5(3);break;case 5:R=Ms.N;case 3:if((r=R)==null||!r.length)return Ms.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));e=g.u(q.actionMetadata,Ctv);O=(f=e)==null?void 0:f.autoSync;H=[];t=U=!0;V=!1;T=void 0;if(!c&&O===!1){Ms.f5(6);break}g.Vy(Ms,7);return g.l(Ms,
B7f(0,!!O,!0,R),9);case 9:H=Ms.N;g.FY(Ms,8);break;case 7:x=g.$u(Ms);if(!(x instanceof Error&&x.message==="No data")){x instanceof Error&&x.message==="Empty response body"&&Xt(x.message);Ms.f5(8);break}return P==="!*$_ALL_ENTITIES_!*$"?g.l(Ms,Ft(n.N,q,n.C),8):g.l(Ms,TA(P,"musicPlaylist",n.N,q,n.C),8);case 8:if(!H.length||!c&&H[0].playlistId!==P)return Ms.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));case 6:if(c){M=[];h=g.a(H);for(E=h.next();!E.done;E=h.next())S=E.value,S.upToDate||
O&&!S.shouldAutoSyncMetadata||!S.playlistId||(nO={autoSync:O},M.push(x7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",S.playlistId,"musicPlaylist",0,zA,{musicPlaylistEntityActionMetadata:nO})));return Ms.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,M))}H.length&&(J=H[0],V=!!J.upToDate,O&&(U=(c0=J.shouldAutoSyncMetadata)!=null?c0:!0,t=(ku=J.shouldAutoSyncVideos)!=null?ku:!0,J.checkInSeconds&&(T=J.checkInSeconds)));if(V||!U)return Ms.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
w));Is=[];e3=R[0];wx=void 0;if(!e3.downloadMetadata){Ms.f5(15);break}return g.l(Ms,z8(n.N,e3.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:v0=Ms.N,wx=Number((ql=(ls=v0)==null?void 0:ls.addedTimestampMillis)!=null?ql:"0")/1E3;case 15:return g.Vy(Ms,17),g.l(Ms,wAl(n,P,(o5=wx)==null?void 0:o5.toString(),T),19);case 19:Is=Ms.N;g.FY(Ms,18);break;case 17:g0=g.$u(Ms);if(!(g0 instanceof Error&&g0.message==="No data")){if(g0 instanceof Error&&g0.message==="Empty response body")Xt(g0.message);
else return E6="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",WG="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",g0 instanceof g.jI&&g0.type==="QUOTA_EXCEEDED"&&(E6="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",WG="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Ms.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,E6,WG));Ms.f5(18);break}return g.l(Ms,TA(P,"musicPlaylist",n.N,q,n.C),18);case 18:if(!t)return Ms.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
w));HG=[];SB=new Map;if((wR=Is)==null?0:wR.length)for(L=g.a(Is),El=L.next();!El.done;El=L.next())DL=El.value,XY=DL.offlineVideoData,Tf=void 0,((Tf=XY)==null?0:Tf.videoId)&&SB.set(XY.videoId,XY);p=new Map;qs=[];if((uQ=e3)==null?0:(IP=uQ.tracks)==null?0:IP.length)for(bz=g.a(e3.tracks),us=bz.next();!us.done;us=bz.next())if(Ns=us.value,no=g.Sy(Ns).entityId)SB.has(no)?(p.set(no,SB.get(no)),SB.delete(no)):qs.push(no);F=Number(((oF=q.actionMetadata)==null?void 0:oF.priority)||0)+1;y=g.a(SB.entries());for(v=
y.next();!v.done;v=y.next())G=v.value,Y=g.a(G),fO=Y.next().value,B=Y.next().value,W=fO,C=B,HG.push(x7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",W,"musicTrack",F,zA,$7(q,C)));xu=g.a(p.entries());for(KO=xu.next();!KO.done;KO=xu.next())rx=KO.value,jB=g.a(rx),LO=jB.next().value,as=jB.next().value,wr=LO,Fh=as,HG.push(x7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",wr,"musicTrack",F,zA,$7(q,Fh)));Cj=g.a(qs);for(TT=Cj.next();!TT.done;TT=Cj.next())ax=TT.value,HG.push(x7("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
ax,"musicTrack",0,zA));return Ms.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,HG))}})},Rcw=function(n,q){var w,X;
return g.b(function(P){switch(P.X){case 1:return w=rJ(q),g.Vy(P,2),X=g.Sy(q.entityKey).entityId,X==="!*$_ALL_ENTITIES_!*$"?g.l(P,Ft(n.N,q,n.C),5):g.l(P,TA(X,"musicPlaylist",n.N,q,n.C),6);case 6:return g.l(P,lJi(n.N,q.entityKey),5);case 5:g.FY(P,3);break;case 2:return g.$u(P),P.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return P.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
w))}})},wAl=function(n,q,w,X){var P,R,c;
return g.b(function(k){switch(k.X){case 1:return g.l(k,bLD([q]),2);case 2:return P=k.N,g.l(k,c3h(n,P[0],w,X),3);case 3:return R=k.N,c=Hd(R.thumbnailDetails),g.l(k,ms(c),4);case 4:return k.return(P[0].videos)}})},c3h=function(n,q,w,X){var P,R,c,k,r,e,f,O,H;
return g.b(function(U){return U.X==1?(P=q.playlistId,R=GuG(q),c=R.bl,k=R.S1,r=w?(Number(w)*1E3).toString():Date.now().toString(),e=q.lastModifiedTimestamp?(Number(q.lastModifiedTimestamp)*1E3).toString():"0",f={id:g.uP(P,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:k,lastModifiedTimestampMillis:e,addedTimestampMillis:r,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},O={id:g.uP(P,"musicPlaylist"),title:q.title,playlistId:P,thumbnailDetails:q.thumbnail,visibility:IOt(q),trackCount:q.totalVideoCount,
tracks:c,downloadMetadata:f.id},X&&(((H=O)==null?0:H.entityMetadata)?O.entityMetadata.nextAutoRefreshIntervalSeconds=String(X):O&&(O.entityMetadata={nextAutoRefreshIntervalSeconds:String(X)})),g.l(U,Z8(n.N,{mode:"readwrite",z9:!0},function(t){var V=S1(t,O,"musicPlaylist");t=S1(t,f,"musicPlaylistDownloadMetadataEntity");return g.UY.all([V,t])}),2)):U.return(O)})},IOt=function(n){switch(n.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},kVh=function(n,q){this.N=n;
this.C=q},ecv=function(n,q){var w,X,P,R,c,k,r,e,f,O,H,U,t;
return g.b(function(V){switch(V.X){case 1:return w=rJ(q),X=g.Sy(q.entityKey),P=X.entityId,R=g.u(q.actionMetadata,r3G),g.Vy(V,2),g.l(V,jwv(n,P,void 0,(c=R)==null?void 0:c.track,(k=R)==null?void 0:k.albumRelease),4);case 4:if((r=R)==null?0:r.playlistId){V.f5(5);break}return g.l(V,h8G(n.N,q.entityKey),5);case 5:g.FY(V,3);break;case 2:return e=g.$u(V),f="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",e instanceof g.jI&&e.type==="QUOTA_EXCEEDED"&&
(f="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),V.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,f,O));case 3:U=Number(((H=q.actionMetadata)==null?void 0:H.priority)||0)+1;var T=(T=g.u(q.actionMetadata,r3G))?{playbackDataActionMetadata:{maximumDownloadQuality:T.maximumDownloadQuality}}:void 0;t=x7("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",P,"playbackData",U,swl,T);return V.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
w,[t]))}})},fOi=function(n,q){var w,X,P,R,c,k,r,e,f,O,H,U,t,V,T;
return g.b(function(x){switch(x.X){case 1:return w=rJ(q),X=g.Sy(q.entityKey),P=X.entityId,g.l(x,z8(n.N,q.entityKey,"musicTrack"),2);case 2:R=x.N;if(!R){c=void 0;x.f5(3);break}return g.l(x,z8(n.N,R.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:c=x.N;case 3:k=c;if(!R||!k)return x.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w));e=g.u(q.actionMetadata,r3G);g.Vy(x,5);return g.l(x,jwv(n,P,k.addedTimestampMillis,(f=e)==null?void 0:f.track,(O=e)==null?void 0:O.albumRelease),
7);case 7:U=Number(((H=q.actionMetadata)==null?void 0:H.priority)||0)+1;r=x7("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",P,"playbackData",U,swl);g.FY(x,6);break;case 5:t=g.$u(x);if(!(t instanceof Error&&t.message==="No data")){if(t instanceof Error&&t.message==="Empty response body")Xt(t.message);else return V="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",t instanceof g.jI&&t.type==="QUOTA_EXCEEDED"&&(V="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
T="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),x.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,V,T));x.f5(6);break}return g.l(x,pn(P,n.N,q,n.C),6);case 6:return x.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",w,r?[r]:void 0))}})},Oiz=function(n,q){var w,X;
return g.b(function(P){switch(P.X){case 1:return w=rJ(q),g.Vy(P,2),X=g.Sy(q.entityKey).entityId,X==="!*$_ALL_ENTITIES_!*$"?g.l(P,Ft(n.N,q,n.C),5):g.l(P,pn(X,n.N,q,n.C),6);case 6:return g.l(P,lJi(n.N,q.entityKey),5);case 5:g.FY(P,3);break;case 2:return g.$u(P),P.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",w,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return P.return(new Dl("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
w))}})},jwv=function(n,q,w,X,P){var R,c,k,r,e,f;
return g.b(function(O){switch(O.X){case 1:if(R=X){O.f5(2);break}return g.l(O,oDf([q]),3);case 3:c=O.N,k=c[0],R=DLf(k);case 2:return g.l(O,iiz(n,R,q,P,w),4);case 4:r=O.N;e=r.musicTrackEntity;f=r.eF;var H=Hd(e.thumbnailDetails),U=[];f&&(U=Hd(f.thumbnailDetails));return g.l(O,ms(H.concat(U)),0)}})},iiz=function(n,q,w,X,P){var R;
return g.b(function(c){return c.X==1?(P||(P=Date.now().toString()),R={id:g.uP(w,"musicTrackDownloadMetadataEntity"),playbackData:g.uP(w,"playbackData"),addedTimestampMillis:P,videoDownloadContextEntity:g.uP(w,"videoDownloadContextEntity")},X&&(q.albumRelease=X.id),g.l(c,Z8(n.N,{mode:"readwrite",z9:!0},function(k){var r=[],e=S1(k,R,"musicTrackDownloadMetadataEntity");r.push(e);e=S1(k,q,"musicTrack");r.push(e);X&&(k=S1(k,X,"musicAlbumRelease"),r.push(k));return g.UY.all(r)}),2)):c.X!=3?g.l(c,fn(w,"musicTrackDownloadMetadataEntity",
n.N,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):c.return({musicTrackEntity:q,
eF:X})})},Wd=function(){uo.apply(this,arguments);
this.L="musicTrack"},Hit=function(n,q,w){q=q===void 0?43200:q;
w=w===void 0?!0:w;var X=X===void 0?!1:X;var P,R;return g.b(function(c){switch(c.X){case 1:if(!n.D.ML())return c.return([]);P=[];g.Vy(c,2);return g.l(c,B7f(q,w,X),4);case 4:P=c.N;g.FY(c,3);break;case 2:g.$u(c);case 3:return R=yoj(n,P,w,"musicPlaylist"),c.return(R)}})},UNh=function(){g.Lq.apply(this,arguments);
var n=this;this.events=new g.Um(this);this.NP=this.player.B();this.Wb={oyf:function(){return n.N},
OM:function(){return n.OM()},
X4:function(q){return n.X4(q)}}},tYw=function(n){var q;
n=g.u((q=n.getWatchNextResponse())==null?void 0:q.currentVideoEndpoint,g.tH);if(n==null?0:n.playlistId)var w=n.playlistId;return w},dNh=function(n,q){var w,X,P,R;
return g.b(function(c){if(c.X==1){w=q.clientPlaybackNonce;X={cpn:w,offlineSourceVisualElement:g.Ok(q.n5||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};q.X&&(X.videoFmt=Number(q.X.itag));q.W&&(X.audioFmt=Number(q.W.itag));if((P=tYw(q))&&q.videoId){var k=q.videoId;k=P!=="PPSV"?Promise.resolve(!1):n.N.vT(k);c=g.l(c,k,3)}else c=c.f5(2);return c}c.X!=2&&(R=c.N)&&(X.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");n.X=w;g.Xc("offlinePlaybackStarted",X);g.yy(c)})};
g.bR.prototype.jy=g.Rs(45,function(n){return this.app.jy(n)});
g.yg.prototype.jy=g.Rs(44,function(n){return g.$vm(this,9,n)});
g.m(G8,l6);g.j3.Object.defineProperties(G8.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.N.entityMetadata},
set:function(n){this.N.entityMetadata=n}}});
g.m(rzt,G8);rzt.prototype.X=function(){return[]};
g.m(jMh,G8);jMh.prototype.X=function(){return[]};
g.m(sMi,G8);sMi.prototype.X=function(){return[]};
g.m(eKG,G8);eKG.prototype.X=function(){return[]};
g.m(fqt,G8);fqt.prototype.X=function(){var n=[];this.N.alternateChannel&&n.push(this.N.alternateChannel);this.N.alternateChannelList&&n.push.apply(n,g.D(this.N.alternateChannelList));this.N.oneofChannelEntity&&n.push(this.N.oneofChannelEntity);return[].concat(g.D(new Set(n)))};
g.m(O8G,G8);O8G.prototype.X=function(){var n=[];this.N.entryCollection&&n.push(this.N.entryCollection);return[].concat(g.D(new Set(n)))};
g.m(i8B,l6);i8B.prototype.X=function(){var n=[];this.N.video&&n.push(this.N.video);return[].concat(g.D(new Set(n)))};
g.m(H80,G8);H80.prototype.X=function(){var n=[];this.N.parentPlaylist&&n.push(this.N.parentPlaylist);if(this.N.entries)for(var q=g.a(this.N.entries),w=q.next();!w.done;w=q.next())n.push.apply(n,g.D((new i8B(w.value)).X()));return[].concat(g.D(new Set(n)))};
g.m(UQl,G8);UQl.prototype.X=function(){var n=[];this.N.descriptionEntity&&n.push(this.N.descriptionEntity);this.N.creators&&n.push.apply(n,g.D(this.N.creators));this.N.theBiggestFan&&n.push(this.N.theBiggestFan);return[].concat(g.D(new Set(n)))};
g.m(t5l,G8);t5l.prototype.X=function(){return[]};
g.m(dQG,G8);dQG.prototype.X=function(){return[]};
g.m(g6B,G8);g6B.prototype.X=function(){return[]};
g.m(mQD,G8);mQD.prototype.X=function(){return[]};
g.m(yzf,G8);yzf.prototype.X=function(){return[]};
g.m(aqi,G8);aqi.prototype.X=function(){return[]};
g.m(V5h,G8);V5h.prototype.X=function(){return[]};
g.m(prB,G8);prB.prototype.X=function(){return[]};
g.m(TKt,G8);TKt.prototype.X=function(){return[]};
g.m(Foz,G8);Foz.prototype.X=function(){var n=[];this.N.downloadsList&&n.push(this.N.downloadsList);this.N.smartDownloadsList&&n.push(this.N.smartDownloadsList);this.N.recommendedDownloadsList&&n.push(this.N.recommendedDownloadsList);this.N.refresh&&n.push(this.N.refresh);return[].concat(g.D(new Set(n)))};
g.m($Qz,l6);$Qz.prototype.X=function(){var n=[];this.N.video&&n.push(this.N.video);this.N.playlist&&n.push(this.N.playlist);this.N.videoItem&&n.push(this.N.videoItem);this.N.playlistItem&&n.push(this.N.playlistItem);return[].concat(g.D(new Set(n)))};
g.m(v6D,G8);v6D.prototype.X=function(){var n=[];this.N.refresh&&n.push(this.N.refresh);if(this.N.downloads)for(var q=g.a(this.N.downloads),w=q.next();!w.done;w=q.next())n.push.apply(n,g.D((new $Qz(w.value)).X()));return[].concat(g.D(new Set(n)))};
g.m(LoD,G8);LoD.prototype.X=function(){var n=[];this.N.localImageEntities&&n.push.apply(n,g.D(this.N.localImageEntities));return[].concat(g.D(new Set(n)))};
g.m(M5l,G8);M5l.prototype.X=function(){var n=[];this.N.playbackData&&n.push(this.N.playbackData);this.N.localImageEntities&&n.push.apply(n,g.D(this.N.localImageEntities));this.N.videoDownloadContextEntity&&n.push(this.N.videoDownloadContextEntity);return[].concat(g.D(new Set(n)))};
g.m(xQt,G8);xQt.prototype.X=function(){return[]};
g.m(DQG,G8);DQG.prototype.X=function(){var n=[];this.N.fakeChildren&&n.push.apply(n,g.D(this.N.fakeChildren));return[].concat(g.D(new Set(n)))};
g.m(hK0,G8);hK0.prototype.X=function(){var n=[];this.N.video&&n.push(this.N.video);this.N.playbackData&&n.push(this.N.playbackData);this.N.offlineVideoPolicy&&n.push(this.N.offlineVideoPolicy);return[].concat(g.D(new Set(n)))};
g.m(lqj,G8);lqj.prototype.X=function(){return[]};
g.m(G9t,G8);G9t.prototype.X=function(){var n=[];this.N.channelOwner&&n.push(this.N.channelOwner);this.N.videos&&n.push.apply(n,g.D(this.N.videos));this.N.collaboratorChannels&&n.push.apply(n,g.D(this.N.collaboratorChannels));this.N.downloadState&&n.push(this.N.downloadState);this.N.refresh&&n.push(this.N.refresh);return[].concat(g.D(new Set(n)))};
g.m(CAf,G8);CAf.prototype.X=function(){var n=[];this.N.video&&n.push(this.N.video);this.N.channelContributor&&n.push(this.N.channelContributor);return[].concat(g.D(new Set(n)))};
g.m(E6w,l6);E6w.prototype.X=function(){var n=[];this.N.localImageEntities&&n.push.apply(n,g.D(this.N.localImageEntities));this.N.videoDownloadContextEntity&&n.push(this.N.videoDownloadContextEntity);return[].concat(g.D(new Set(n)))};
g.m(o6t,l6);o6t.prototype.X=function(){var n=[];this.N.recommendedVideoMetadata&&n.push.apply(n,g.D((new E6w(this.N.recommendedVideoMetadata)).X()));return[].concat(g.D(new Set(n)))};
g.m(b8f,l6);b8f.prototype.X=function(){var n=[];this.N.playbackPosition&&n.push(this.N.playbackPosition);return[].concat(g.D(new Set(n)))};
g.m(AzD,G8);AzD.prototype.X=function(){var n=[];this.N.owner&&n.push(this.N.owner);this.N.downloadState&&n.push(this.N.downloadState);this.N.userState&&n.push.apply(n,g.D((new b8f(this.N.userState)).X()));this.N.additionalMetadata&&n.push.apply(n,g.D((new o6t(this.N.additionalMetadata)).X()));return[].concat(g.D(new Set(n)))};
g.m(YnG,G8);YnG.prototype.X=function(){var n=[];this.N.userChannelDetails&&n.push(this.N.userChannelDetails);return[].concat(g.D(new Set(n)))};
g.m(KoB,G8);KoB.prototype.X=function(){var n=[];this.N.channelOwner&&n.push(this.N.channelOwner);this.N.playbackPosition&&n.push(this.N.playbackPosition);this.N.localImageEntities&&n.push.apply(n,g.D(this.N.localImageEntities));this.N.downloadStatus&&n.push(this.N.downloadStatus);return[].concat(g.D(new Set(n)))};
g.m(Snv,G8);Snv.prototype.X=function(){return[]};
g.m(ux5,G8);ux5.prototype.X=function(){return[]};
g.m(BK5,G8);BK5.prototype.X=function(){return[]};
g.m(QMB,G8);QMB.prototype.X=function(){return[]};
g.m(Z8L,G8);Z8L.prototype.X=function(){return[]};
g.m(Jz5,G8);Jz5.prototype.X=function(){return[]};
g.m(zKf,G8);zKf.prototype.X=function(){return[]};
g.m(Woh,G8);Woh.prototype.X=function(){return[]};
g.m(NKz,G8);NKz.prototype.X=function(){return[]};
g.m(nLw,G8);nLw.prototype.X=function(){return[]};
g.m(qAj,G8);qAj.prototype.X=function(){return[]};
g.m(wfi,G8);wfi.prototype.X=function(){return[]};
g.m(XfD,G8);XfD.prototype.X=function(){var n=[];this.N.trackDownloadMetadatas&&n.push.apply(n,g.D(this.N.trackDownloadMetadatas));return[].concat(g.D(new Set(n)))};
g.m(PI5,G8);
PI5.prototype.X=function(){var n=[];this.N.downloadedTracks&&n.push.apply(n,g.D(this.N.downloadedTracks));this.N.smartDownloadedTracks&&n.push.apply(n,g.D(this.N.smartDownloadedTracks));this.N.downloadedEpisodes&&n.push.apply(n,g.D(this.N.downloadedEpisodes));this.N.downloadedAlbumReleases&&n.push.apply(n,g.D(this.N.downloadedAlbumReleases));this.N.smartDownloadedAlbumReleases&&n.push.apply(n,g.D(this.N.smartDownloadedAlbumReleases));this.N.downloadedPlaylists&&n.push.apply(n,g.D(this.N.downloadedPlaylists));this.N.smartDownloadedPlaylists&&
n.push.apply(n,g.D(this.N.smartDownloadedPlaylists));this.N.metadataOnlyTracks&&n.push.apply(n,g.D(this.N.metadataOnlyTracks));return[].concat(g.D(new Set(n)))};
g.m(RaD,G8);RaD.prototype.X=function(){var n=[];this.N.trackDownloadMetadatas&&n.push.apply(n,g.D(this.N.trackDownloadMetadatas));return[].concat(g.D(new Set(n)))};
g.m(cQh,G8);cQh.prototype.X=function(){var n=[];this.N.playbackData&&n.push(this.N.playbackData);this.N.localImageEntities&&n.push.apply(n,g.D(this.N.localImageEntities));this.N.videoDownloadContextEntity&&n.push(this.N.videoDownloadContextEntity);return[].concat(g.D(new Set(n)))};
g.m(Idi,G8);Idi.prototype.X=function(){var n=[];this.N.musicLibraryStatusEntity&&n.push(this.N.musicLibraryStatusEntity);this.N.primaryArtists&&n.push.apply(n,g.D(this.N.primaryArtists));this.N.details&&n.push(this.N.details);this.N.userDetails&&n.push(this.N.userDetails);this.N.tracks&&n.push.apply(n,g.D(this.N.tracks));this.N.share&&n.push(this.N.share);this.N.downloadMetadata&&n.push(this.N.downloadMetadata);this.N.refresh&&n.push(this.N.refresh);return[].concat(g.D(new Set(n)))};
g.m(khD,G8);khD.prototype.X=function(){var n=[];this.N.albumRelease&&n.push(this.N.albumRelease);this.N.tracks&&n.push.apply(n,g.D(this.N.tracks));return[].concat(g.D(new Set(n)))};
g.m(rQB,G8);rQB.prototype.X=function(){var n=[];this.N.albumRelease&&n.push(this.N.albumRelease);return[].concat(g.D(new Set(n)))};
g.m(jYL,G8);jYL.prototype.X=function(){var n=[];this.N.details&&n.push(this.N.details);this.N.userDetails&&n.push(this.N.userDetails);return[].concat(g.D(new Set(n)))};
g.m(sYB,G8);sYB.prototype.X=function(){var n=[];this.N.parentArtist&&n.push(this.N.parentArtist);return[].concat(g.D(new Set(n)))};
g.m(eaB,G8);eaB.prototype.X=function(){var n=[];this.N.parentArtist&&n.push(this.N.parentArtist);return[].concat(g.D(new Set(n)))};
g.m(fdf,G8);fdf.prototype.X=function(){return[]};
g.m(Ovv,G8);Ovv.prototype.X=function(){return[]};
g.m(ivL,l6);ivL.prototype.X=function(){var n=[];this.N.creatorEntity&&n.push(this.N.creatorEntity);return[].concat(g.D(new Set(n)))};
g.m(HvL,G8);
HvL.prototype.X=function(){var n=[];this.N.tracks&&n.push.apply(n,g.D(this.N.tracks));this.N.refresh&&n.push(this.N.refresh);this.N.musicLibraryStatusEntity&&n.push(this.N.musicLibraryStatusEntity);this.N.details&&n.push(this.N.details);this.N.downloadMetadata&&n.push(this.N.downloadMetadata);this.N.sideloadMetadata&&n.push(this.N.sideloadMetadata);this.N.userDetails&&n.push(this.N.userDetails);this.N.entryCollection&&n.push(this.N.entryCollection);this.N.share&&n.push(this.N.share);this.N.podcastShowAdditionalMetadata&&n.push.apply(n,
g.D((new ivL(this.N.podcastShowAdditionalMetadata)).X()));return[].concat(g.D(new Set(n)))};
g.m(UWh,G8);UWh.prototype.X=function(){return[]};
g.m(tEz,G8);
tEz.prototype.X=function(){var n=[];this.N.musicLibraryStatusEntity&&n.push(this.N.musicLibraryStatusEntity);this.N.artists&&n.push.apply(n,g.D(this.N.artists));this.N.audioModeVersion&&n.push(this.N.audioModeVersion);this.N.videoModeVersion&&n.push(this.N.videoModeVersion);this.N.userDetails&&n.push(this.N.userDetails);this.N.details&&n.push(this.N.details);this.N.albumRelease&&n.push(this.N.albumRelease);this.N.share&&n.push(this.N.share);this.N.libraryEdit&&n.push(this.N.libraryEdit);this.N.downloadMetadata&&
n.push(this.N.downloadMetadata);this.N.playbackPosition&&n.push(this.N.playbackPosition);this.N.lyrics&&n.push(this.N.lyrics);return[].concat(g.D(new Set(n)))};
g.m(dWG,G8);dWG.prototype.X=function(){var n=[];this.N.parentTrack&&n.push(this.N.parentTrack);return[].concat(g.D(new Set(n)))};
g.m(gLG,G8);gLG.prototype.X=function(){var n=[];this.N.parentTrack&&n.push(this.N.parentTrack);return[].concat(g.D(new Set(n)))};
g.m(mWv,G8);mWv.prototype.X=function(){return[]};
g.m(yQL,G8);yQL.prototype.X=function(){return[]};
g.m(adL,G8);adL.prototype.X=function(){return[]};
g.m(VEi,G8);VEi.prototype.X=function(){return[]};
g.m(pf5,G8);pf5.prototype.X=function(){var n=[];this.N.transfer&&n.push(this.N.transfer);this.N.adsPlaybackData&&n.push.apply(n,g.D(this.N.adsPlaybackData));this.N.drmLicense&&n.push(this.N.drmLicense);this.N.offlineVideoPolicy&&n.push(this.N.offlineVideoPolicy);this.N.videoDownloadContextEntity&&n.push(this.N.videoDownloadContextEntity);return[].concat(g.D(new Set(n)))};
g.m(Tm0,G8);Tm0.prototype.X=function(){return[]};
g.m(Fph,G8);Fph.prototype.X=function(){var n=[];this.N.offlineVideoStreams&&n.push.apply(n,g.D(this.N.offlineVideoStreams));this.N.captionTrack&&n.push.apply(n,g.D(this.N.captionTrack));return[].concat(g.D(new Set(n)))};
g.m($WL,G8);$WL.prototype.X=function(){return[]};
g.m(vLD,G8);vLD.prototype.X=function(){return[]};
g.m(Lpv,G8);Lpv.prototype.X=function(){return[]};
g.m(MEt,G8);MEt.prototype.X=function(){return[]};
g.m(xWl,G8);xWl.prototype.X=function(){return[]};
g.m(DWf,G8);DWf.prototype.X=function(){return[]};
g.m(hat,G8);hat.prototype.X=function(){return[]};
g.m(ldf,G8);ldf.prototype.X=function(){return[]};
g.m(Ghl,G8);Ghl.prototype.X=function(){return[]};
g.m(CIG,G8);CIG.prototype.X=function(){return[]};
g.m(ELh,G8);ELh.prototype.X=function(){return[]};
g.m(oL5,G8);oL5.prototype.X=function(){return[]};
g.m(bvv,G8);bvv.prototype.X=function(){return[]};
g.m(AQw,G8);AQw.prototype.X=function(){return[]};
g.m(YAL,G8);YAL.prototype.X=function(){return[]};
g.m(Kpw,G8);Kpw.prototype.X=function(){return[]};
g.m(SAL,G8);SAL.prototype.X=function(){return[]};
g.m(uQh,G8);uQh.prototype.X=function(){return[]};
g.m(Bmv,G8);Bmv.prototype.X=function(){return[]};
g.m(QYG,G8);QYG.prototype.X=function(){return[]};
g.m(Zvh,G8);Zvh.prototype.X=function(){return[]};
var Q2w=["browse","music/browse","unplugged/browse"],N7D=["offline/playlist_sync_check"],EDv=["offline"],ZL0=["offline/offline_video_playback_position_sync"],z8i=["offline/get_playback_data_entity"],C3;E1.getInstance=function(){return g.b(function(n){return n.return(new Promise(function(q){g.ug().then(function(w){w?(E1.instance||(E1.instance=new E1(w)),q(E1.instance)):q(void 0)})}))})};
E1.prototype.get=function(n){var q=this,w,X,P;return g.b(function(R){if(R.X==1)return g.l(R,Nmj(q.token),2);if(R.X!=3)return w=R.N,g.l(R,w.get("prefs",n),3);X=R.N;if(!X)return R.return();P=(0,g.m$)();return X.expirationTimestampMs<=P?R.return():R.return(X.value)})};
E1.prototype.set=function(n,q,w){w=w===void 0?31536E3:w;var X=this,P,R,c;return g.b(function(k){if(k.X==1)return P=(0,g.m$)(),R={key:n,value:q,expirationTimestampMs:P+w*1E3},g.l(k,Nmj(X.token),2);c=k.N;return g.l(k,g.Fc(c,"prefs",R),0)})};
E1.prototype.remove=function(n){var q=this,w;return g.b(function(X){if(X.X==1)return g.l(X,Nmj(q.token),2);w=X.N;return g.l(X,w.delete("prefs",n),0)})};
g.m(o3,g.b4);g.m(b6,PHv);b6.prototype.C=function(n,q){q=cjz(q);n=(new TextEncoder).encode(JSON.stringify(n));return this.N.encrypt(n,q)};
b6.prototype.X=function(n,q){if(!(n instanceof Uint8Array))throw npi(1);var w=new TextDecoder;q=cjz(q);n=this.N.decrypt(n,q);return JSON.parse(w.decode(n))};
var IPi={accountLinkStatusEntity:g6B,booleanEntity:sMi,buttonEntity:AQw,captionTrack:mWv,channelHandle:rzt,chipEntity:hat,commerceAcquisitionClientPayloadEntity:Kpw,commerceCartListEntity:SAL,contextNoteFeedEntityPayload:jMh,continuationTokenEntity:lqj,downloadQualityPickerEntity:V5h,downloadsPageRefreshTokenEntity:TKt,downloadsPageViewConfigurationEntity:Snv,downloadStatusEntity:prB,dismissState:ldf,sfvAudioItemCurrentlyPlayingEntity:MEt,emojiFountainDataEntity:oL5,emojiCustomizationSetEntity:ELh,
fakeChannel:fqt,fakePlaylist:O8G,fakePlaylistEntryCollection:H80,fakeVideo:UQl,fakeVideoDescription:t5l,featuredProductsEntity:nLw,flowStateEntity:dQG,iconBadgeEntity:uQh,interstitialInteractionStateEntity:yzf,likeButtonAnimationEntity:ux5,liveChatPollStateEntity:aqi,liveViewerLeaderboardChatEntryPointStateEntity:vLD,liveViewerLeaderboardPointsEntity:Lpv,liveReactionsDataEntity:bvv,logoEntity:mQD,macroMarkerEntity:BK5,mainDownloadsLibraryEntity:Foz,mainDownloadsListEntity:v6D,mainPlaylistDownloadStateEntity:LoD,
mainPlaylistEntity:G9t,mainPlaylistVideoEntity:CAf,mainVideoDownloadStateEntity:M5l,mainVideoEntity:AzD,markersEngagementPanelSyncEntity:QMB,markersVisibilityOverrideEntity:Z8L,musicAlbumReleaseDetail:khD,musicAlbumReleaseDownloadMetadataEntity:XfD,musicAlbumRelease:Idi,musicAlbumReleaseUserDetail:rQB,musicArtistDetail:sYB,musicArtist:jYL,musicArtistUserDetail:eaB,musicDownloadsLibraryEntity:PI5,musicLibraryEdit:fdf,musicLibraryStatusEntity:Ovv,musicPlaylist:HvL,musicPlaylistDownloadMetadataEntity:RaD,
musicShare:UWh,musicTrackDetail:dWG,musicTrackDownloadMetadataEntity:cQh,musicTrack:tEz,musicTrackUserDetail:gLG,offlineOrchestrationActionWrapperEntity:yQL,offlineVideoPolicy:adL,offlineVideoStreams:VEi,offlineabilityEntity:xQt,orchestrationWebSamplingEntity:DQG,pageHeaderEntity:Ghl,pdpStateEntity:Bmv,pinnedProductEntity:qAj,playbackData:pf5,playerStateEntity:Jz5,quantityIncrementerEntity:QYG,refresh:Tm0,saveToPlaylistListEntity:xWl,selectedChipIndexEntityPayload:zKf,settingEntity:DWf,stringEntity:eKG,
suggestedFeedbackChipStateEntity:Woh,transfer:Fph,trendingOfferEntity:wfi,videoDownloadContextEntity:$WL,videoOverviewAsyncDataEntity:Zvh,videoPlaybackPositionEntity:YAL,votingEntity:CIG,ytMainChannelEntity:YnG,youchatPendingResponseEntity:NKz,ytMainDownloadedVideoEntity:hK0,ytMainVideoEntity:KoB};g.m(Bi,PHv);Bi.prototype.C=function(n){return n};
Bi.prototype.X=function(n){if(n instanceof Uint8Array)throw npi(0);return n};
g.m(QG,g.A);QG.prototype.observe=function(n){var q=this;this.observers.push(n);return function(){var w=q.observers.indexOf(n);w>=0&&q.observers.splice(w,1)}};
QG.prototype.X=function(n){mnh(this,n.data)};
QG.prototype.Xf=function(){this.channel.close()};
var THL,Vmj=new g.t3("elementsCommand");var aH=new g.t3("entityBatchUpdate");var e8t=new g.t3("downloadStatusEntity");var $XL=new g.t3("mainPlaylistEntityActionMetadata");var Zl=new g.t3("mainVideoEntityActionMetadata");var Ctv=new g.t3("musicPlaylistEntityActionMetadata");var r3G=new g.t3("musicTrackEntityActionMetadata");var Kq0=new g.t3("localImageEntityActionMetadata");var hC=new g.t3("playbackDataActionMetadata");var pti=new g.t3("transferEntityActionMetadata");var jWD=new g.t3("videoPlaybackPositionEntityActionMetadata");var AjG;new g.cR;new g.cR;BHh.prototype.request=function(n,q,w){q=q===void 0?{}:q;return this.locks.request(n,q,function(X){return w(X)})};var wJ=g.W0.caches,qS,WAf;nn.prototype.open=function(n){return wJ.open(Jji(n))};
nn.prototype.has=function(n){return wJ.has(Jji(n))};
nn.prototype.delete=function(n){return wJ.delete(Jji(n))};
nn.prototype.match=function(n,q){var w=this,X,P,R,c,k,r;return g.b(function(e){switch(e.X){case 1:return g.l(e,w.keys(),2);case 2:X=e.N,P=g.a(X),R=P.next();case 3:if(R.done){e.f5(5);break}c=R.value;return g.l(e,w.open(c),6);case 6:return k=e.N,g.l(e,k.match(n,q),7);case 7:if(r=e.N)return e.return(r);R=P.next();e.f5(3);break;case 5:return e.return()}})};
g.m(ZEL,nn);ZEL.prototype.keys=function(){var n,q,w,X,P,R,c,k,r;return g.b(function(e){if(e.X==1)return n=[],q=g.Ah("CacheStorage keys"),g.l(e,wJ.keys(),2);w=e.N;X=g.a(w);for(P=X.next();!P.done;P=X.next()){R=P.value;var f=R.indexOf(":");c=f===-1?{yl:R}:{yl:R.substring(0,f),datasyncId:R.substring(f+1)};k=c.yl;r=c.datasyncId;r===q&&n.push(k)}return e.return(n)})};g.m(Pd,g.A);Pd.prototype.C=function(n){this.api.Uq("onOfflineOperationFailure",n.data)};
Pd.prototype.W=function(n){this.api.publish("offlinetransferpause",n.data)};
Pd.prototype.Xf=function(){var n;(n=this.N)==null||n.close();var q;(q=this.X)==null||q.close()};qgt.prototype.d$=function(){this.N&&cd(this)};
qgt.prototype.OO=function(){this.X&&this.X.resolve();this.C=this.N=!1;this.L()};var AdB=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var mLi="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var xLj="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.m(qfD,MS);qfD.prototype.X=function(n){return jU(n)?PFh(this,n):sC(n)?IKi(this,n):Promise.reject(Error("Unsupported action type: "+n.actionType))};g.m(kKz,MS);kKz.prototype.X=function(n){return sC(n)?rd0(this,n):s2t(n)?sWf(this,n):eU(n)?ekj(this,n):Promise.reject(Error("Unsupported action type: "+n.actionType))};g.d=fKl.prototype;g.d.Veq=function(n){var q=this,w,X,P,R;return g.b(function(c){if(!g.Z(n.state,128))return c.f5(0);w=n.state.er;var k=(X=w)==null?void 0:X.errorCode,r=(P=w)==null?void 0:P.FE;R=k==="net.connect"&&r===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(k==null?0:k.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.l(c,q.YY(q.player.getVideoData().videoId,R),0)})};
g.d.YY=function(n,q){var w=this;return g.b(function(X){if(X.X==1){if(w.X)return X.return();w.X=!0;return q==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(Cn(w,n,!1,!0),X.f5(0)):g.l(X,GA(w,n),3)}g.zB(n,4);return g.l(X,w.N.YY(q),0)})};
g.d.j0=function(n){n.status===2?(n.status!==this.C&&(ro0(this.N),g.zB(n.videoId,2)),n.p9&&Ocf(this.N,n.videoId,n.p9)):n.status===4?(GA(this,n.videoId),this.YY(n.videoId,n.u8?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):n.status===1&&fML(this.N);this.C=n.status;this.api.Uq("localmediachange",{videoId:n.videoId,status:n.status})};
g.d.b$=function(){var n=this,q;return g.b(function(w){if(w.X==1){if(n.X)return w.return();n.X=!0;q=n.player.getVideoData().videoId;return g.l(w,GA(n,q),2)}return g.l(w,n.N.b$(),0)})};
g.d.OY=function(n){switch(n){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.d.Z=function(n){return this.api.B().Z(n)};g.m(gFL,MS);gFL.prototype.X=function(n){return jU(n)?ydf(this,n):sC(n)?aKB(this,n):s2t(n)?VqG(this,n):Promise.reject(Error("Unsupported action type: "+n.actionType))};L7w.prototype.N=function(n,q){var w=n.action.actionMetadata.priority-q.action.actionMetadata.priority;w===0&&(n.N<q.N?w=-1:n.N>q.N&&(w=1));return w};g.m(EC,g.A);EC.prototype.Xf=function(){this.L&&this.L();g.A.prototype.Xf.call(this)};
EC.prototype.createAction=function(n,q){var w=g.Sy(n.entityKey).entityType,X=g.Os(16);return new UC(w,X,n,q.actionId,q.rootActionId)};
EC.prototype.PW=function(n){var q=this,w,X,P,R,c,k,r,e,f;return g.b(function(O){if(O.X==1){if(q.zp())return O.return();X=(w=n.offlineOrchestrationActionWrapperEntity)!=null?w:new Set;P=[];R=g.a(X);for(c=R.next();!c.done;c=R.next())k=c.value,r=g.Sy(k),e=r.entityId,D4w(q.N,e)||P.push(k);return g.l(O,Sfv(q,P),2)}f=O.N;return g.l(O,K7l(q,f),0)})};
EC.prototype.retry=function(){var n=this;return g.b(function(q){return g.l(q,u6D(n),0)})};QWG.prototype.rp=function(n,q){q=q===void 0?!0:q;var w=this,X,P,R,c,k,r,e,f;return g.b(function(O){switch(O.X){case 1:if(!w.N)return O.return();X=[];P=g.kG(w.N.X,q);R=[];for(c={xn:0};c.xn<P.length;c={xn:c.xn},c.xn++)k=P[c.xn],r=w.N.eH(k,"json3"),e=g.V9(r,{withCredentials:!0,format:"RAW"},3,500).then(function(H){return function(U){U={metadata:g.lE(P[H.xn]),trackData:U.xhr.responseText};R.push(U)}}(c)).Ld(function(H){Xt("Caption fetch error",H)}),X.push(e);
return g.l(O,k9w(X),2);case 2:return g.Vy(O,3),g.l(O,hqh(n,R),5);case 5:g.FY(O,0);break;case 3:f=g.$u(O),Xt("Caption DB transaction error",f),g.yy(O)}})};g.m(oH,g.A);oH.prototype.Xf=function(){this.X&&this.X();g.A.prototype.Xf.call(this)};
oH.prototype.C=function(n){var q=this,w,X,P,R,c,k,r,e;return g.b(function(f){X=(w=n.transfer)!=null?w:new Set;P=[];R=g.a(X);for(c=R.next();!c.done;c=R.next())k=c.value,r=g.Sy(k),e=r.entityId,P.push(e);return P.length===0?f.return():g.l(f,zkB(q,P),0)})};g.m(wNi,g.A);g.d=wNi.prototype;g.d.Xf=function(){this.vW&&this.vW();this.WW.dispose();this.W.dispose();this.n5&&g.Zd(this.D.hv,this.n5);this.Tp&&g.Zd(this.D.hv,this.Tp);g.A.prototype.Xf.call(this)};
g.d.tPe=function(n){var q=this,w,X,P;return g.b(function(R){switch(R.X){case 1:w=g.uP(n,"transfer");if(q.N&&w===q.N.key){Cn(q.G,q.K,!0);q.W.stop();R.f5(0);break}return g.l(R,Z8(q.X,{mode:"readwrite",z9:!0},function(c){return Ap(c,w,"transfer").then(function(k){if(k&&k.transferState!=="TRANSFER_STATE_COMPLETE"&&k.transferState!=="TRANSFER_STATE_FAILED")return k.transferState="TRANSFER_STATE_PAUSED_BY_USER",S1(c,k,"transfer").then(function(){return k})})}),3);
case 3:X=R.N;if(!X){R.f5(0);break}if(!n||!q.C){R.f5(5);break}return g.l(R,fn(n,q.C,q.X,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.l(R,Y7(q,n),7);case 7:P=R.N,rst({videoId:n,Lq:X,offlineModeType:P}),g.yy(R)}})};
g.d.JzH=function(){var n=this;if(this.N&&this.K){Cn(this.G,this.K,!1);var q=this.N,w=(q==null?0:q.key)?g.Sy(q.key).entityId:"";w&&this.C&&(new Promise(function(X,P){fn(w,n.C,n.X,"DOWNLOAD_STATE_PAUSED").catch(function(R){P(R)})})).catch(function(X){Xt("Download state setting error",X)})}this.W.stop()};
g.d.K9=function(){this.N?RDv(this,this.N):AC(this)};
g.d.qm=function(n){var q=this;return g.b(function(w){switch(w.X){case 1:if(!q.N){w.f5(2);break}if(q.N.transferState==="TRANSFER_STATE_COMPLETE"||q.N.transferState==="TRANSFER_STATE_FAILED"||!n.transfer||!n.transfer.has(q.N.key)){w.f5(3);break}return g.l(w,z8(q.X,q.N.key,"transfer"),4);case 4:q.N=w.N;if(q.N){w.f5(3);break}return g.l(w,coG(q),3);case 3:if(q.N)return w.return();case 2:return g.l(w,AC(q),0)}})};
g.d.YY=function(n,q){var w=this,X,P,R,c,k;return g.b(function(r){switch(r.X){case 1:if(!w.N){Kn(w,"onTransferFailure: "+n);r.f5(2);break}X=w.N;R=((P=X)==null?0:P.key)?g.Sy(X.key).entityId:"";a:switch(n){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var e=!1;break a;default:e=!0}return e&&ic0(w)?g.l(r,SU(w,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.l(r,
Hcj(w,n),5);case 5:if(!R||!w.C){r.f5(2);break}return g.l(r,fn(R,w.C,w.X,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.l(r,Y7(w,R),9);case 9:c=r.N;k7({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:R,Lq:X,offlineModeType:c});if(!R||!w.C){r.f5(2);break}return g.l(r,fn(R,w.C,w.X,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:bo(w),k=AC(w,!0),q&&q(k),g.yy(r)}})};
g.d.b$=function(n){var q=this,w,X,P,R,c,k,r,e,f,O,H,U;return g.b(function(t){switch(t.X){case 1:if(!q.N){Kn(q,"onMaybeTransferStreamsExpired");t.f5(2);break}return ic0(q)?g.l(t,SU(q,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.l(t,Hcj(q,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!q.C){t.f5(2);break}w=q.N;P=((X=w)==null?0:X.key)?g.Sy(w.key).entityId:"";if(!P){t.f5(2);break}return g.l(t,fn(P,q.C,q.X,"DOWNLOAD_STATE_FAILED"),2);case 9:return q.N||Kn(q,"onMaybeTransferStreamsExpiredRetryAttempting"),
R=q.N,k=((c=R)==null?0:c.key)?g.Sy(R.key).entityId:"",g.l(t,Y7(q,k),10);case 10:return r=t.N,k7({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:k,Lq:R,offlineModeType:r}),e=iLz(),g.M0(e,hC,{isEnqueuedForExpiredStreamUrlRefetch:!0}),f=g.uP(k,"playbackData"),O={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:f,actionMetadata:e},H=dJ(new UC("playbackData",k,O)),g.l(t,Jp(q.X,H,"offlineOrchestrationActionWrapperEntity"),2);case 2:bo(q),U=AC(q,!0),
n&&n(U),g.yy(t)}})};
var gvt={},UXG=(gvt.TRANSFER_STATE_TRANSFERRING=1,gvt.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,gvt);g.d=uo.prototype;g.d.jl=function(){return this.K.promise};
g.d.mB=function(){if(this.X&&this.G)return this.K.promise;gHj(this).then(this.K.resolve).catch(this.K.reject);return this.K.promise};
g.d.w7=function(n){var q={};return q.playbackData=new qfD(n,this.NP,this.N),q.transfer=new gFL(n,this.NP),q.videoPlaybackPositionEntity=new kKz(n,this.NP),q};
g.d.a$=function(){var n=this;return g.b(function(q){return n.X?g.l(q,XNw(n.X),0):q.f5(0)})};
g.d.Nq=function(){var n=this,q,w;return g.b(function(X){if(X.X==1)return n.X||n.G?g.l(X,n.jl(),2):X.return();n.V!==void 0&&(g.ez(n.V),n.V=void 0);n.W!==void 0&&(g.ez(n.W),n.W=void 0);(q=n.X)==null||q.dispose();n.X=void 0;(w=n.G)==null||w.dispose();n.G=void 0;n.api.Uq("onOrchestrationLostLeader");n.K=new g.cR;g.yy(X)})};
g.d.isOrchestrationLeader=function(){return this.C.N};
g.d.vT=function(){return g.b(function(n){return n.return(!1)})};
g.d.rA=function(n){var q=this.N;q.api.publish("offlinetransferpause",n);var w;(w=q.X)==null||w.postMessage(n)};
g.d.K9=function(n){var q,w;return g.b(function(X){if(X.X==1)return g.l(X,Nz(),2);q=X.N;if(!q)return X.return();w=g.uP(n,"transfer");return g.l(X,Z8(q,{mode:"readwrite",z9:!0},function(P){var R=Ap(P,w,"transfer"),c=Ap(P,g.uP(n,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.UY.all([R,c]).then(function(k){k=g.a(k);var r=k.next().value;var e=k.next().value;return r&&r.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(r.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",S1(P,r,"transfer").then(function(){k7({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:n,Lq:r,offlineModeType:e==null?void 0:e.offlineModeType});return g.UY.resolve(null)})):g.UY.resolve(null)})}),0)})};
g.d.B7=function(n){n=n===void 0?43200:n;var q=this,w,X,P,R,c,k,r,e;return g.b(function(f){if(f.X==1)return q.D.ML()?g.l(f,Nz(),2):f.return(mXf());if(f.X!=3){w=f.N;if(!w)return f.return([]);X=Date.now()/1E3;return g.l(f,Wi(w,"offlineVideoPolicy"),3)}P=f.N;R=[];c=g.a(P);for(k=c.next();!k.done;k=c.next())r=k.value,Number(r.lastUpdatedTimestampSeconds)+n<=X&&(e=g.Sy(r.key).entityId,R.push(e));return R.length?f.return(Bd(q,R,q.L,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):f.return([])})};
g.d.deleteAll=function(){return Bd(this,["!*$_ALL_ENTITIES_!*$"],this.L,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.d.refreshAllStaleEntities=function(n){var q=this;return g.b(function(w){return w.X==1?g.l(w,q.B7(n),2):w.return(w.N)})};
g.d.setUpPositionSyncInterval=function(n){var q=this;this.W!==void 0&&(g.ez(this.W),this.W=void 0);var w=n!=null?n:864E5;this.W=g.jz(function(){q.cn(w)},w)};
g.d.cn=function(n){var q=this,w,X,P,R,c,k;return g.b(function(r){switch(r.X){case 1:return g.Vy(r,2),g.l(r,E1.getInstance(),4);case 4:w=r.N;if(!w)throw Error("prefStorage is undefined");return g.l(r,w.get("psi"),5);case 5:X=r.N;R=((P=X)==null?0:P.xK)?Number(X.xK)/1E3:0;c=Date.now();if(!(R+n<=c)){r.f5(6);break}return g.l(r,Bd(q,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.FY(r,0);break;case 2:k=g.$u(r),Xt("Offline manager error",k),
g.yy(r)}})};
g.d.XW=function(){var n=this,q,w,X,P,R,c,k;return g.b(function(r){if(r.X==1)return g.l(r,Nz(),2);if(r.X!=3)return(q=r.N)?g.l(r,Wi(q,"transfer"),3):r.return([]);w=r.N;X=[];P=g.a(w);for(R=P.next();!R.done;R=P.next())c=R.value,c.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&c.key&&(k=g.Sy(c.key).entityId,X.push(k));return r.return(aMB(n,X))})};
g.d.kZ=function(){return g.b(function(n){return n.return([])})};
g.d.bv=function(){return g.b(function(n){g.yy(n)})};
g.d.hd=function(){return g.b(function(n){g.yy(n)})};g.m(Vet,MS);Vet.prototype.X=function(n){return jU(n)?FqG(this,n):sC(n)?vHf(this,n):eU(n)?Lq5(this,n):Promise.reject(Error("Unsupported action type: "+n.actionType))};
var QV=[10];g.m(lMB,MS);lMB.prototype.X=function(n){return jU(n)?EHh(this,n):sC(n)?oHG(this,n):eU(n)?bcD(this,n):Promise.reject(Error("Unsupported action type: "+n.actionType))};
var CUi=[10];g.m(Yhl,MS);Yhl.prototype.X=function(n){return sC(n)?ShB(this,n):Promise.reject(Error("Unsupported action type: "+n.actionType))};g.m(uW0,uo);g.d=uW0.prototype;g.d.w7=function(n){var q=uo.prototype.w7.call(this,n);q.mainVideoEntity=new lMB(n,this.NP,this.N);q.mainPlaylistEntity=new Vet(n,this.NP,this.N);q.mainDownloadsListEntity=new Yhl(n,this.NP,this.N);return q};
g.d.refreshAllStaleEntities=function(n,q){var w=this,X,P,R,c,k,r,e,f,O,H,U;return g.b(function(t){switch(t.X){case 1:X=[];if(!w.NP.Z("web_player_offline_playlist_auto_refresh")){t.f5(2);break}return g.l(t,BeD(w,n,q),3);case 3:X=t.N;case 2:return g.l(t,E1.getInstance(),4);case 4:return P=t.N,g.l(t,(R=P)==null?void 0:R.get("sdois"),5);case 5:return c=t.N,g.l(t,(k=P)==null?void 0:k.get("lmqf"),6);case 6:r=t.N;if(!c){t.f5(7);break}f=X;O=f.concat;return g.l(t,QUG(w,c,(e=r)!=null?e:"SD",n===0),8);case 8:X=
O.call(f,t.N);case 7:return H=X,U=H.concat,g.l(t,uo.prototype.refreshAllStaleEntities.call(w,n,q),9);case 9:return X=U.call(H,t.N),t.return(X)}})};
g.d.vT=function(n){var q,w,X,P,R,c,k,r;return g.b(function(e){if(e.X==1)return g.l(e,Nz(),2);if(e.X!=3)return(q=e.N)?g.l(e,z8(q,g.Al,"mainDownloadsListEntity"),3):e.return(!1);w=e.N;if((X=w)==null?0:(P=X.downloads)==null?0:P.length)for(R=g.uP(n,"mainVideoEntity"),c=g.a(w.downloads),k=c.next();!k.done;k=c.next())if(r=k.value,r.videoItem===R)return e.return(!0);return e.return(!1)})};
g.d.kZ=function(){var n=this,q,w,X,P,R,c,k,r;return g.b(function(e){if(e.X==1)return g.l(e,Nz(),2);if(e.X!=3)return(q=e.N)?g.l(e,Wi(q,"downloadStatusEntity"),3):e.return([]);w=e.N;X=[];P=g.a(w);for(R=P.next();!R.done;R=P.next())c=R.value,c.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&c.key&&(k=g.Sy(c.key).entityId,X.push(k));return X.length?(r={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},e.return(Bd(n,X,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
r))):e.return([])})};
g.d.hd=function(){var n;return g.b(function(q){return q.X==1?g.l(q,Nz(),2):(n=q.N)?g.l(q,Z8(n,{mode:"readwrite",z9:!0},function(w){return YP(w,"mainVideoEntity").then(function(X){var P=[];X=g.a(X);for(var R=X.next();!R.done;R=X.next()){R=R.value;var c=void 0;(c=R.userState)!=null&&c.playbackPosition||(c=g.Sy(R.key).entityId,c={key:g.uP(c,"videoPlaybackPositionEntity"),videoId:c,lastPlaybackPositionSeconds:"0"},P.push(S1(w,c,"videoPlaybackPositionEntity")),R.userState={playbackPosition:c.key},P.push(S1(w,
R,"mainVideoEntity")))}return g.UY.all(P)})}),0):q.return()})};
g.d.bv=function(){var n,q,w,X,P,R,c,k,r,e,f,O,H,U,t,V,T,x,M,h,E,S,nO,J,c0,ku,Is,e3,wx,v0,ls,ql,o5,g0,E6,WG,HG,SB;return g.b(function(wR){if(wR.X==1)return g.l(wR,Nz(),2);if(wR.X!=3){n=wR.N;if(!n)return wR.return();q=g.uP("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.l(wR,Z8(n,{mode:"readonly",z9:!0},function(L){return g.UY.all([Ap(L,q,"mainDownloadsListEntity"),Ap(L,g.Al,"mainDownloadsListEntity"),YP(L,"mainVideoEntity"),YP(L,"mainPlaylistEntity")])}),3)}w=wR.N;
X=g.a(w);P=X.next().value;R=X.next().value;c=X.next().value;k=X.next().value;r=P;e=R;f=c;O=k;H=new Set;if((U=r)==null?0:(t=U.downloads)==null?0:t.length)for(V=g.a(r.downloads),T=V.next();!T.done;T=V.next())x=T.value,M=void 0,(h=(M=x.videoItem)!=null?M:x.playlistItem)&&H.add(h);if((E=e)==null?0:(S=E.downloads)==null?0:S.length)for(nO=g.a(e.downloads),J=nO.next();!J.done;J=nO.next())c0=J.value,c0.videoItem&&H.add(c0.videoItem);ku=new Set;Is=[];e3=g.a(O);for(wx=e3.next();!wx.done;wx=e3.next()){v0=wx.value;
if(v0.videos)for(ls=g.a(v0.videos),ql=ls.next();!ql.done;ql=ls.next())o5=ql.value,(g0=JSON.parse(g.Sy(o5).entityId).videoId)&&ku.add(g0);v0.key&&!H.has(v0.key)&&Is.push(v0.key)}E6=g.a(f);for(WG=E6.next();!WG.done;WG=E6.next())HG=WG.value,HG.key&&!H.has(HG.key)&&(SB=g.Sy(HG.key).entityId,ku.has(SB)||Is.push(HG.key));return Is.length?g.l(wR,$L5(n,Is),0):wR.f5(0)})};g.m(Zc0,MS);Zc0.prototype.X=function(n){return jU(n)?zDG(this,n):sC(n)?Wqz(this,n):eU(n)?Nei(this,n):Promise.reject(Error("Unsupported action type: "+n.actionType))};
var JC=[10];g.m(qqG,MS);qqG.prototype.X=function(n){return jU(n)?XAG(this,n):sC(n)?PpL(this,n):eU(n)?Rcw(this,n):Promise.reject(Error("Unsupported action type: "+n.actionType))};
var zA=[10];g.m(kVh,MS);kVh.prototype.X=function(n){return jU(n)?ecv(this,n):sC(n)?fOi(this,n):eU(n)?Oiz(this,n):Promise.reject(Error("Unsupported action type: "+n.actionType))};
var swl=[10];g.m(Wd,uo);Wd.prototype.w7=function(n){var q=uo.prototype.w7.call(this,n);q.musicTrack=new kVh(n,this.N);q.musicPlaylist=new qqG(n,this.N);q.musicAlbumRelease=new Zc0(n,this.N);return q};
Wd.prototype.refreshAllStaleEntities=function(n,q){var w=this,X,P,R;return g.b(function(c){if(c.X==1)return g.l(c,Hit(w,n,q),2);if(c.X!=3)return P=X=c.N,R=P.concat,g.l(c,uo.prototype.refreshAllStaleEntities.call(w,n,q),3);X=R.call(P,c.N);return c.return(X)})};g.m(UNh,g.Lq);g.d=UNh.prototype;g.d.create=function(){var n=this;g.K(this,this.events);if(g.iE(this.NP))this.N=new uW0(this.NP,this.player);else if(g.LX(this.NP)||g.UN(this.NP))this.N=new Wd(this.NP,this.player);this.events.j(this.player,"onPlaybackStartExternal",function(){n.OM()});
this.events.j(this.player,"videodatachange",function(){n.OM()});
this.NP.Z("html5_offline_playback_position_sync")&&this.events.j(this.player,"presentingplayerstatechange",this.X4)};
g.d.BO=function(){return!1};
g.d.kF=function(n,q,w,X){var P=this;return g.b(function(R){return P.N?R.return(Bd(P.N,n,q,w,X)):R.return(Promise.reject())})};
g.d.deleteAll=function(){return this.N.deleteAll()};
g.d.B7=function(n){return this.N.B7(n)};
g.d.refreshAllStaleEntities=function(n){return this.N.refreshAllStaleEntities(n)};
g.d.setUpPositionSyncInterval=function(n){this.N.setUpPositionSyncInterval(n)};
g.d.rA=function(n){this.N.rA(n)};
g.d.K9=function(n){return this.N.K9(n)};
g.d.OM=function(){var n=this,q;return g.b(function(w){q=n.player.getVideoData();return g.f0(q)?tYw(q)&&n.X!==q.clientPlaybackNonce?g.l(w,dNh(n,q),0):w.f5(0):w.return()})};
g.d.X4=function(n){var q=this,w,X,P,R,c,k,r;return g.b(function(e){if(e.X==1)return w=q.player.getVideoData(),X=w.KV,g.k0(n,2)||g.k0(n,512)?g.l(e,Nz(),2):e.return();if(e.X!=3){P=e.N;if(!P)return Xt("PES is undefined"),e.return();R=w.videoId;return g.l(e,z8(P,g.uP(R,"mainVideoEntity"),"mainVideoEntity"),3)}c=e.N;if(!c)return e.return();k=Math.floor(X).toString();r={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:k}};return g.l(e,q.kF([R],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
r),0)})};
g.d.isOrchestrationLeader=function(){return this.N.isOrchestrationLeader()};
g.d.updateDownloadState=function(n,q){var w,X,P,R;return g.b(function(c){if(c.X==1)return g.l(c,Nz(),2);w=c.N;if(!w)return Xt("PES is undefined"),c.return();X=g.Sy(n);P=X.entityType;R=X.entityId;return g.l(c,fn(R,P,w,q,!0),0)})};g.vb("offline",UNh);})(_yt_player);
